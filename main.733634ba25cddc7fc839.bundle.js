"use strict";
(self["webpackChunkrogue4720"] = self["webpackChunkrogue4720"] || []).push([["main"],{

/***/ 5426:
/*!*************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./src/style.css ***!
  \*************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/sourceMaps.js */ 7537);
/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/api.js */ 3645);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);
// Imports


var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));
// Module
___CSS_LOADER_EXPORT___.push([module.id, "html, body { \r\n    height: 100%;\r\n    margin: 0;\r\n    background-color: black;\r\n    color: white;\r\n    font-family: monospace;\r\n    font-size: 1rem;\r\n}\r\n\r\n#app {\r\n    display: flex;\r\n    height: 100%;\r\n}\r\n\r\n#canvas-container {\r\n    flex: 10 10 100vw;\r\n    display: flex;\r\n}\r\n\r\ncanvas {\r\n    width: 100%;\r\n}\r\n\r\ngame-panel {\r\n    display: flex;\r\n    flex-direction: column;\r\n    flex: 2 2 25rem;\r\n    overflow-y: auto;\r\n}\r\n\r\n.game-pane {\r\n    display: flex;\r\n    flex-direction: column;\r\n    border: 1px solid white;\r\n    padding: .5rem;\r\n    margin: .5rem .5rem;\r\n}\r\n\r\n.game-log-pane {\r\n    margin-top: auto;\r\n}\r\n\r\n.pane-title {\r\n    font-size: 1.5rem;\r\n    text-align: center;\r\n}\r\n\r\n.player-pane-stats {\r\n    padding-bottom: 0.5rem;\r\n}\r\n\r\nscene-panel {\r\n    flex: 25rem 0 0;\r\n    max-width: 25rem;\r\n    overflow-y: scroll;\r\n}\r\n\r\nscene-panel-header {\r\n    display: block;\r\n    text-align: center;\r\n    border-bottom: 1px solid white;\r\n    padding: 0.25rem;\r\n}\r\n\r\nscene-panel-list {\r\n    display: block;\r\n    margin: 0.5rem;\r\n    overflow: auto;\r\n    text-overflow: ellipsis;\r\n}\r\n\r\nscene-panel-list-node { \r\n    display: block;\r\n}\r\n\r\n.node-wrapper { \r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n    display: flex;\r\n}\r\n\r\n.expand-button { \r\n    width: 1rem;\r\n    user-select: none;\r\n    flex-shrink: 0;\r\n}\r\n\r\n.debug-panel {\r\n    position: absolute;\r\n    white-space: pre;\r\n    bottom: 5px;\r\n    left: 5px;\r\n    border: 1px solid rgba(0, 0, 0, 0.5);\r\n    background-color: rgba(0, 0, 0, 0.3);\r\n    padding: 3px;\r\n    color: rgb(0, 255, 0);\r\n}\r\n\r\n.minimap-panel {\r\n    font-size: 0.75rem;\r\n    position: absolute;\r\n    top: 5px;\r\n    left: 5px;\r\n    border: 1px solid rgba(0, 0, 0, 0.75);\r\n    background-color: rgba(0, 0, 0, 0.7);\r\n    padding: 3px;\r\n    color: rgb(255, 255, 255);\r\n}\r\n", "",{"version":3,"sources":["webpack://./src/style.css"],"names":[],"mappings":"AAAA;IACI,YAAY;IACZ,SAAS;IACT,uBAAuB;IACvB,YAAY;IACZ,sBAAsB;IACtB,eAAe;AACnB;;AAEA;IACI,aAAa;IACb,YAAY;AAChB;;AAEA;IACI,iBAAiB;IACjB,aAAa;AACjB;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,aAAa;IACb,sBAAsB;IACtB,eAAe;IACf,gBAAgB;AACpB;;AAEA;IACI,aAAa;IACb,sBAAsB;IACtB,uBAAuB;IACvB,cAAc;IACd,mBAAmB;AACvB;;AAEA;IACI,gBAAgB;AACpB;;AAEA;IACI,iBAAiB;IACjB,kBAAkB;AACtB;;AAEA;IACI,sBAAsB;AAC1B;;AAEA;IACI,eAAe;IACf,gBAAgB;IAChB,kBAAkB;AACtB;;AAEA;IACI,cAAc;IACd,kBAAkB;IAClB,8BAA8B;IAC9B,gBAAgB;AACpB;;AAEA;IACI,cAAc;IACd,cAAc;IACd,cAAc;IACd,uBAAuB;AAC3B;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,mBAAmB;IACnB,uBAAuB;IACvB,aAAa;AACjB;;AAEA;IACI,WAAW;IACX,iBAAiB;IACjB,cAAc;AAClB;;AAEA;IACI,kBAAkB;IAClB,gBAAgB;IAChB,WAAW;IACX,SAAS;IACT,oCAAoC;IACpC,oCAAoC;IACpC,YAAY;IACZ,qBAAqB;AACzB;;AAEA;IACI,kBAAkB;IAClB,kBAAkB;IAClB,QAAQ;IACR,SAAS;IACT,qCAAqC;IACrC,oCAAoC;IACpC,YAAY;IACZ,yBAAyB;AAC7B","sourcesContent":["html, body { \r\n    height: 100%;\r\n    margin: 0;\r\n    background-color: black;\r\n    color: white;\r\n    font-family: monospace;\r\n    font-size: 1rem;\r\n}\r\n\r\n#app {\r\n    display: flex;\r\n    height: 100%;\r\n}\r\n\r\n#canvas-container {\r\n    flex: 10 10 100vw;\r\n    display: flex;\r\n}\r\n\r\ncanvas {\r\n    width: 100%;\r\n}\r\n\r\ngame-panel {\r\n    display: flex;\r\n    flex-direction: column;\r\n    flex: 2 2 25rem;\r\n    overflow-y: auto;\r\n}\r\n\r\n.game-pane {\r\n    display: flex;\r\n    flex-direction: column;\r\n    border: 1px solid white;\r\n    padding: .5rem;\r\n    margin: .5rem .5rem;\r\n}\r\n\r\n.game-log-pane {\r\n    margin-top: auto;\r\n}\r\n\r\n.pane-title {\r\n    font-size: 1.5rem;\r\n    text-align: center;\r\n}\r\n\r\n.player-pane-stats {\r\n    padding-bottom: 0.5rem;\r\n}\r\n\r\nscene-panel {\r\n    flex: 25rem 0 0;\r\n    max-width: 25rem;\r\n    overflow-y: scroll;\r\n}\r\n\r\nscene-panel-header {\r\n    display: block;\r\n    text-align: center;\r\n    border-bottom: 1px solid white;\r\n    padding: 0.25rem;\r\n}\r\n\r\nscene-panel-list {\r\n    display: block;\r\n    margin: 0.5rem;\r\n    overflow: auto;\r\n    text-overflow: ellipsis;\r\n}\r\n\r\nscene-panel-list-node { \r\n    display: block;\r\n}\r\n\r\n.node-wrapper { \r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n    display: flex;\r\n}\r\n\r\n.expand-button { \r\n    width: 1rem;\r\n    user-select: none;\r\n    flex-shrink: 0;\r\n}\r\n\r\n.debug-panel {\r\n    position: absolute;\r\n    white-space: pre;\r\n    bottom: 5px;\r\n    left: 5px;\r\n    border: 1px solid rgba(0, 0, 0, 0.5);\r\n    background-color: rgba(0, 0, 0, 0.3);\r\n    padding: 3px;\r\n    color: rgb(0, 255, 0);\r\n}\r\n\r\n.minimap-panel {\r\n    font-size: 0.75rem;\r\n    position: absolute;\r\n    top: 5px;\r\n    left: 5px;\r\n    border: 1px solid rgba(0, 0, 0, 0.75);\r\n    background-color: rgba(0, 0, 0, 0.7);\r\n    padding: 3px;\r\n    color: rgb(255, 255, 255);\r\n}\r\n"],"sourceRoot":""}]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ 7654:
/*!***********************!*\
  !*** ./src/style.css ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ 3379);
/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/styleDomAPI.js */ 7795);
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/insertBySelector.js */ 569);
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js */ 3565);
/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/insertStyleElement.js */ 9216);
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/styleTagTransform.js */ 4589);
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! !!../node_modules/css-loader/dist/cjs.js!./style.css */ 5426);

      
      
      
      
      
      
      
      
      

var options = {};

options.styleTagTransform = (_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default());
options.setAttributes = (_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default());

      options.insert = _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null, "head");
    
options.domAPI = (_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default());
options.insertStyleElement = (_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default());

var update = _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()(_node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__["default"], options);




       /* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__["default"] && _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__["default"].locals ? _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__["default"].locals : undefined);


/***/ }),

/***/ 6198:
/*!**************************************!*\
  !*** ./src/game/CameraController.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ CameraController)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);
/* harmony import */ var _util_Math__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Math */ 2835);
/* harmony import */ var _KeyListener__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./KeyListener */ 5574);



const KEY_MAP = {
    movement: {
        Numpad8: 'forward',
        Numpad2: 'backward',
        Numpad4: 'left',
        Numpad6: 'right',
        Numpad9: 'up',
        Numpad7: 'down',
        h: 'left',
        j: 'backward',
        k: 'forward',
        l: 'right',
        ']': 'up',
        '[': 'down',
    },
    look: {
        ArrowUp: 'up',
        ArrowDown: 'down',
        ArrowLeft: 'left',
        ArrowRight: 'right',
    },
};
class CameraController {
    camera;
    moveSpeed;
    lookSensitivity;
    activeInputs;
    static defaultInputs = {
        movement: {
            up: false,
            down: false,
            left: false,
            right: false,
            forward: false,
            backward: false,
        },
        look: {
            up: false,
            down: false,
            left: false,
            right: false,
        },
    };
    constructor(camera, 
    // Units per second
    moveSpeed = 1.0, 
    // Degrees per second
    lookSensitivity = (0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toRadians)(1.0), activeInputs = CameraController.defaultInputs) {
        this.camera = camera;
        this.moveSpeed = moveSpeed;
        this.lookSensitivity = lookSensitivity;
        this.activeInputs = activeInputs;
    }
    update(deltaTime) {
        // console.log(`Camera Update: ${this.direction.toString()}`);
        const moveVector = this.getMoveVector();
        const moveDistance = this.moveSpeed * (deltaTime / 1000);
        this.move(twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.mulScalar(moveVector, moveDistance));
        const rotations = this.getRotations();
        this.rotate(rotations);
    }
    bindKeys(keyListener) {
        // Camera movement with numpad
        Object.entries(KEY_MAP).forEach(([inputType, inputs]) => {
            Object.entries(inputs).forEach(([key, value]) => {
                keyListener.addListener(key, () => {
                    this.activeInputs[inputType][value] = true;
                });
                keyListener.addListener(key, () => {
                    this.activeInputs[inputType][value] = false;
                }, _KeyListener__WEBPACK_IMPORTED_MODULE_2__.KeyPressType.UP);
            });
        });
    }
    move(translation) {
        const { position } = this.camera.transform;
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.add(position, translation, position);
    }
    moveTo(position) {
        this.camera.transform.position = position;
    }
    getMoveVector() {
        const { transform } = this.camera;
        const moveVector = twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.create(0, 0, 0);
        const { movement } = this.activeInputs;
        if (movement.up) {
            twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.add(moveVector, transform.getUpVector(), moveVector);
        }
        if (movement.down) {
            twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.subtract(moveVector, transform.getUpVector(), moveVector);
        }
        if (movement.left) {
            twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.subtract(moveVector, transform.getRightVector(), moveVector);
        }
        if (movement.right) {
            twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.add(moveVector, transform.getRightVector(), moveVector);
        }
        if (movement.forward) {
            twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.add(moveVector, transform.getForwardVector(), moveVector);
        }
        if (movement.backward) {
            twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.subtract(moveVector, transform.getForwardVector(), moveVector);
        }
        return moveVector;
    }
    rotate(rotations) {
        const { rotation } = this.camera.transform;
        const maxX = (0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toRadians)(90);
        const minX = (0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toRadians)(-90);
        rotation[0] += rotations[0];
        // Clamp X
        if (rotation[0] > maxX) {
            rotation[0] = maxX;
        }
        else if (rotation[0] < minX) {
            rotation[0] = minX;
        }
        rotation[1] += rotations[1];
    }
    getRotations() {
        let xRotation = 0.0;
        let yRotation = 0.0;
        const { look } = this.activeInputs;
        if (look.up) {
            xRotation += this.lookSensitivity;
        }
        if (look.down) {
            xRotation -= this.lookSensitivity;
        }
        if (look.left) {
            yRotation += this.lookSensitivity;
        }
        if (look.right) {
            yRotation -= this.lookSensitivity;
        }
        return [xRotation, yRotation];
    }
}


/***/ }),

/***/ 5608:
/*!*****************************!*\
  !*** ./src/game/Dungeon.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Dungeon)
/* harmony export */ });
const NUM_ITEMS = 9;
const MAP_EMPTY = '.';
const MAP_WALL = '|';
const MAP_PLAYER = '@';
const MAP_WEAPON = 'w';
const MAP_ITEM = 'i';
const MAP_ENEMY = 'e';
class Dungeon {
    static generate(dungeonWidth, dungeonHeight, minRoomSize) {
        const main = new Rect(0, 0, dungeonHeight - 1, dungeonWidth - 1);
        // Split the dungeon into zones
        const zones = Dungeon.split(main, minRoomSize + 2);
        // Create rooms inside each of the zones
        const rooms = zones.map((zone) => Dungeon.createRoom(zone, minRoomSize));
        // Create hallways to connect rooms together
        const { halls, connections } = Dungeon.createHalls(zones, rooms);
        // Randomly select a starting room then calculate the difficulties of every other room
        const startRoom = Dungeon.randInt(0, rooms.length);
        const difficulties = rooms.map((_) => 999);
        difficulties[startRoom] = 1;
        for (let loop = 0; loop < rooms.length; loop++) {
            for (let conn = 0; conn < connections.length; conn++) {
                difficulties[connections[conn].b] = Math.min(difficulties[connections[conn].b], difficulties[connections[conn].a] + 1);
            }
        }
        // Generate the items, weapons, and enemies
        const mapPoints = Dungeon.fillRooms(rooms, difficulties, startRoom);
        return Dungeon.createMap(new Pair(dungeonHeight, dungeonWidth), rooms, halls, mapPoints);
    }
    // Split a zone into two smaller zones, then recurse
    static split(zone, minZoneSize) {
        const smallX = zone.x2 - zone.x1 < 2 * minZoneSize;
        const smallY = zone.y2 - zone.y1 < 2 * minZoneSize;
        // If a zone is too small, don't split it
        if (smallX && smallY)
            return [zone];
        // If a zone is too small in one direction, split it in the other direction
        if (smallX)
            return Dungeon.splitY(zone, minZoneSize);
        if (smallY)
            return Dungeon.splitX(zone, minZoneSize);
        // If a zone is big enough, randomly split it in the X or Y direction
        if (Dungeon.randInt(0, 2) == 0)
            return Dungeon.splitY(zone, minZoneSize);
        return Dungeon.splitX(zone, minZoneSize);
    }
    // Split a zone in the X direction
    static splitX(zone, minZoneSize) {
        // Choose a random split point
        const xSplit = Dungeon.randInt(zone.x1 + minZoneSize, zone.x2 - minZoneSize + 1);
        // Create sub-zones
        const zoneA = new Rect(zone.x1, zone.y1, xSplit, zone.y2);
        const zoneB = new Rect(xSplit, zone.y1, zone.x2, zone.y2);
        // Recurse and combine lists
        return [...Dungeon.split(zoneA, minZoneSize), ...Dungeon.split(zoneB, minZoneSize)];
    }
    // Split a zone in the Y direction
    static splitY(zone, minZoneSize) {
        // Choose a random split point
        const ySplit = Dungeon.randInt(zone.y1 + minZoneSize, zone.y2 - minZoneSize + 1);
        // Create sub-zones
        const zoneA = new Rect(zone.x1, zone.y1, zone.x2, ySplit);
        const zoneB = new Rect(zone.x1, ySplit, zone.x2, zone.y2);
        // Recurse and combine lists
        return [...Dungeon.split(zoneA, minZoneSize), ...Dungeon.split(zoneB, minZoneSize)];
    }
    // Create a room inside of a zone
    static createRoom(zone, minRoomSize) {
        let x1 = 0;
        let x2 = 0;
        let y1 = 0;
        let y2 = 0;
        // Randomly generate two valid points inside of the zone
        // The points must have x1 < x2, y1 < y2, and have a side length of at least minRoomSize
        while (x2 - x1 < minRoomSize || y2 - y1 < minRoomSize) {
            x1 = Dungeon.randInt(zone.x1 + 1, zone.x2);
            x2 = Dungeon.randInt(zone.x1 + 1, zone.x2);
            y1 = Dungeon.randInt(zone.y1 + 1, zone.y2);
            y2 = Dungeon.randInt(zone.y1 + 1, zone.y2);
            if (x1 > x2)
                x2 = x1;
            if (y1 > y2)
                y2 = y1;
        }
        return new Rect(x1, y1, x2, y2);
    }
    static createHalls(zones, rooms) {
        const halls = [];
        const connections = [];
        const hasRight = [...Array(zones.length)].map((q) => false);
        const hasDown = [...Array(zones.length)].map((q) => false);
        // loop through each pair of zones
        for (let from = 0; from < zones.length; from++) {
            for (let to = 0; to < zones.length; to++) {
                // If from room and to room share a vertical wall
                if (zones[from].x2 == zones[to].x1) {
                    // check for invalid sizes
                    if (zones[to].y1 >= rooms[from].y2)
                        continue;
                    if (rooms[to].y1 >= zones[from].y2)
                        continue;
                    // randomly choose access points
                    const y1 = Dungeon.randInt(rooms[from].y1 + 1, rooms[from].y2);
                    const y2 = Dungeon.randInt(rooms[to].y1 + 1, rooms[to].y2);
                    if (y1 == y2) {
                        // draw straight hallway
                        halls.push(new Rect(rooms[from].x2, y1, rooms[to].x1, y1));
                    }
                    else {
                        // draw zig zag hallway
                        halls.push(new Rect(rooms[from].x2, y1, zones[from].x2, y1));
                        halls.push(new Rect(zones[from].x2, Math.min(y1, y2), zones[from].x2, Math.max(y1, y2)));
                        halls.push(new Rect(zones[from].x2, y2, rooms[to].x1, y2));
                    }
                    // mark hallway
                    hasRight[from] = true;
                    connections.push(new Pair(from, to));
                    connections.push(new Pair(to, from));
                }
                // If from room and to room share a horizontal wall
                else if (zones[from].y2 == zones[to].y1) {
                    // check for invalid sizes
                    if (zones[to].x1 >= rooms[from].x2)
                        continue;
                    if (rooms[to].x1 >= zones[from].x2)
                        continue;
                    // randomly choose access points
                    const x1 = Dungeon.randInt(rooms[from].x1 + 1, rooms[from].x2);
                    const x2 = Dungeon.randInt(rooms[to].x1 + 1, rooms[to].x2);
                    if (x1 == x2) {
                        // draw straight hallway
                        halls.push(new Rect(x1, rooms[from].y2, x1, rooms[to].y1));
                    }
                    else {
                        // draw zig zag hallway
                        halls.push(new Rect(x1, rooms[from].y2, x1, zones[from].y2));
                        halls.push(new Rect(Math.min(x1, x2), zones[from].y2, Math.max(x1, x2), zones[from].y2));
                        halls.push(new Rect(x2, zones[to].y1, x2, rooms[to].y1));
                    }
                    // mark hallway
                    hasDown[from] = true;
                    connections.push(new Pair(from, to));
                    connections.push(new Pair(to, from));
                }
            }
        }
        return { halls, connections };
    }
    // Fill rooms with weapons, items, and enemies
    static fillRooms(rooms, difficulties, startRoom) {
        let maxDifficulty = 0;
        for (let q = 0; q < difficulties.length; q++) {
            if (difficulties[q] > maxDifficulty)
                maxDifficulty = difficulties[q];
        }
        const coords = [];
        let itemsLeft = NUM_ITEMS - 1;
        const weapons = [];
        const items = [];
        // Check if a coordinate is free to use
        function check(x, y) {
            for (let q = 0; q < coords.length; q++) {
                if (coords[q].x == x && coords[q].y == y) {
                    return false;
                }
            }
            return true;
        }
        // Generate a random coordinate in a room
        function randomCoord(room) {
            while (true) {
                const x = Dungeon.randInt(room.x1 + 1, room.x2);
                const y = Dungeon.randInt(room.y1 + 1, room.y2);
                if (check(x, y))
                    return new Point(x, y);
            }
        }
        // Generate spawn room
        const spawn = randomCoord(rooms[startRoom]);
        coords.push(spawn);
        // Add weapon to spawn room
        const c = randomCoord(rooms[startRoom]);
        coords.push(c);
        weapons.push(c);
        // Generate enemies
        const enemies = [];
        for (let room = 0; room < rooms.length; room++) {
            for (let enemy = 0; enemy < difficulties[room]; enemy++) {
                const c = randomCoord(rooms[room]);
                coords.push(c);
                enemies.push(c);
            }
        }
        // Generate items
        loop: while (itemsLeft > 0) {
            for (let difficulty = 2; difficulty <= maxDifficulty; difficulty++) {
                for (let room = 0; room < rooms.length; room++) {
                    if (difficulties[room] != difficulty)
                        continue;
                    if (itemsLeft <= 0)
                        break loop;
                    // Generate weapon or item
                    if (Dungeon.randInt(0, difficulty) == 0) {
                        itemsLeft--;
                        const c = randomCoord(rooms[room]);
                        coords.push(c);
                        (Dungeon.randInt(0, 2) ? weapons : items).push(c);
                    }
                }
            }
        }
        return {
            weapons, items, enemies, spawn,
        };
    }
    static createMap(dungeonSize, rooms, halls, mapPoints) {
        const map = [...Array(dungeonSize.a + 1)].map((q) => [...Array(dungeonSize.b + 1)].map((w) => MAP_WALL));
        // Fill rooms with empty space
        for (let room = 0; room < rooms.length; room++) {
            for (let x = rooms[room].x1 + 1; x < rooms[room].x2; x++) {
                for (let y = rooms[room].y1 + 1; y < rooms[room].y2; y++) {
                    map[x][y] = MAP_EMPTY;
                }
            }
        }
        // Fill halls with empty space
        for (let hall = 0; hall < halls.length; hall++) {
            if (halls[hall].x1 == halls[hall].x2) {
                for (let y = halls[hall].y1; y <= halls[hall].y2; y++) {
                    map[halls[hall].x1][y] = MAP_EMPTY;
                }
            }
            else {
                for (let x = halls[hall].x1; x <= halls[hall].x2; x++) {
                    map[x][halls[hall].y1] = MAP_EMPTY;
                }
            }
        }
        // Draw player position
        map[mapPoints.spawn.x][mapPoints.spawn.y] = MAP_PLAYER;
        // Draw weapons
        for (let weapon = 0; weapon < mapPoints.weapons.length; weapon++) {
            map[mapPoints.weapons[weapon].x][mapPoints.weapons[weapon].y] = MAP_WEAPON;
        }
        // Draw items
        for (let item = 0; item < mapPoints.items.length; item++) {
            map[mapPoints.items[item].x][mapPoints.items[item].y] = MAP_ITEM;
        }
        // Draw enemies
        for (let emeny = 0; emeny < mapPoints.enemies.length; emeny++) {
            map[mapPoints.enemies[emeny].x][mapPoints.enemies[emeny].y] = MAP_ENEMY;
        }
        // Stitch map together
        return map.map((row) => row.join('')).join('\n');
    }
    static randInt(min, max) {
        if (min == max)
            return min;
        if (min > max)
            return this.randInt(max, min);
        return Math.floor(Math.random() * (max - min)) + min;
    }
}
class Rect {
    x1;
    y1;
    x2;
    y2;
    area;
    constructor(x1, y1, x2, y2) {
        this.x1 = x1;
        this.y1 = y1;
        this.x2 = x2;
        this.y2 = y2;
        this.area = (this.x2 - this.x1) * (this.y2 - this.y1);
    }
}
class Pair {
    a;
    b;
    constructor(a, b) {
        this.a = a;
        this.b = b;
    }
}
class Point {
    x;
    y;
    constructor(x, y) {
        this.x = x;
        this.y = y;
    }
}


/***/ }),

/***/ 1611:
/*!**************************!*\
  !*** ./src/game/Game.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "GameState": () => (/* binding */ GameState),
/* harmony export */   "default": () => (/* binding */ Game)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);
/* harmony import */ var _KeyListener__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./KeyListener */ 5574);
/* harmony import */ var _Grid__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Grid */ 1227);
/* harmony import */ var _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./entities/Enemy */ 5296);
/* harmony import */ var _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./entities/Weapon */ 2354);
/* harmony import */ var _entities_Item__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./entities/Item */ 3282);
/* harmony import */ var _renderer_Renderer__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../renderer/Renderer */ 9870);
/* harmony import */ var _renderer_PerspectiveCamera__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../renderer/PerspectiveCamera */ 3305);
/* harmony import */ var _CameraController__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./CameraController */ 6198);
/* harmony import */ var _ui_game_GamePanel__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../ui/game/GamePanel */ 5439);
/* harmony import */ var _ui_game_MinimapPanel__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../ui/game/MinimapPanel */ 7206);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_entities_Item__WEBPACK_IMPORTED_MODULE_5__, _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__, _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__, _ui_game_GamePanel__WEBPACK_IMPORTED_MODULE_9__, _Grid__WEBPACK_IMPORTED_MODULE_2__]);
([_entities_Item__WEBPACK_IMPORTED_MODULE_5__, _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__, _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__, _ui_game_GamePanel__WEBPACK_IMPORTED_MODULE_9__, _Grid__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__);









// eslint-disable-next-line import/no-cycle

// eslint-disable-next-line import/no-cycle

var GameState;
(function (GameState) {
    GameState[GameState["WALKING"] = 0] = "WALKING";
    GameState[GameState["INVENTORY"] = 1] = "INVENTORY";
})(GameState || (GameState = {}));
var MoveDirection;
(function (MoveDirection) {
    MoveDirection[MoveDirection["Forward"] = 0] = "Forward";
    MoveDirection[MoveDirection["Backward"] = 1] = "Backward";
    MoveDirection[MoveDirection["Left"] = 2] = "Left";
    MoveDirection[MoveDirection["Right"] = 3] = "Right";
})(MoveDirection || (MoveDirection = {}));
class Game {
    grid;
    renderer;
    message;
    gamePanel;
    minimapPanel;
    player;
    state;
    camera;
    cameraController;
    keyListener;
    doResetCamera;
    constructor(gl) {
        this.camera = new _renderer_PerspectiveCamera__WEBPACK_IMPORTED_MODULE_7__["default"]();
        this.cameraController = new _CameraController__WEBPACK_IMPORTED_MODULE_8__["default"](this.camera, 3);
        this.renderer = new _renderer_Renderer__WEBPACK_IMPORTED_MODULE_6__["default"](gl, undefined, this.camera);
        this.doResetCamera = true;
        // Attach the camera controller update to the renderer
        this.renderer.addUpdateCallback((deltaTime) => this.cameraController.update(deltaTime));
        // Update camera aspect ratio
        this.renderer.addUpdateCallback(() => {
            this.camera.aspect = this.renderer.gl.canvas.width / this.renderer.gl.canvas.height;
        });
        this.grid = new _Grid__WEBPACK_IMPORTED_MODULE_2__["default"](this.renderer.scene);
        this.player = this.grid.getPlayer();
        this.cameraController.moveTo(this.player.cameraTarget.getWorldPosition());
        this.camera.transform.setRotationDeg(-45, 180, 0);
        this.state = GameState.WALKING;
        this.keyListener = new _KeyListener__WEBPACK_IMPORTED_MODULE_1__["default"]();
        this.keyListener.addListeners([
            // Move player with 'w', 'a', 's', 'd'
            ['w', () => this.movePlayer(MoveDirection.Forward)],
            ['a', () => this.movePlayer(MoveDirection.Left)],
            ['s', () => this.movePlayer(MoveDirection.Backward)],
            ['d', () => this.movePlayer(MoveDirection.Right)],
            // Open/close inventory with 'i'
            ['i', () => this.toggleInventory()],
            // Attack Enemy
            ['q', () => this.attack()],
            // Select inventory weapon/item with '1'-'9'
            [
                ['Digit1', 'Digit2', 'Digit3', 'Digit4', 'Digit5',
                    'Digit6', 'Digit7', 'Digit8', 'Digit9'],
                ({ key }) => this.selectFromInventory(Number(key) - 1),
            ],
            ['\\', () => this.grid.generateMap()],
            [',', () => { this.doResetCamera = !this.doResetCamera; }],
        ]);
        this.cameraController.bindKeys(this.keyListener);
        this.keyListener.startListening();
        this.gamePanel = new _ui_game_GamePanel__WEBPACK_IMPORTED_MODULE_9__["default"](this);
        this.minimapPanel = new _ui_game_MinimapPanel__WEBPACK_IMPORTED_MODULE_10__["default"](this);
        this.message = '';
        this.addMessage('Game Start');
        this.printGame();
        // Begin rendering
        requestAnimationFrame((time) => {
            this.renderer.render(time);
        });
    }
    stopGame() {
        this.keyListener.stopListening();
        this.renderer.stopRendering();
    }
    // update(handler?: Function): void {
    //   if (handler) handler();
    // }
    //
    movePlayer(dir) {
        if (this.state !== GameState.WALKING)
            return;
        let deltaX = 0;
        let deltaY = 0;
        switch (dir) {
            case MoveDirection.Forward:
                this.player.modelNode.localTransform.setRotationDeg(0, 0, 0);
                deltaY = 1;
                break;
            case MoveDirection.Backward:
                this.player.modelNode.localTransform.setRotationDeg(0, 180, 0);
                deltaY = -1;
                break;
            case MoveDirection.Left:
                this.player.modelNode.localTransform.setRotationDeg(0, 90, 0);
                deltaX = 1;
                break;
            case MoveDirection.Right:
                this.player.modelNode.localTransform.setRotationDeg(0, -90, 0);
                deltaX = -1;
                break;
            default:
                break;
        }
        const { x: currentX, y: currentY } = this.grid.getPositionOf(this.player);
        const newPosition = {
            x: currentX + deltaX,
            y: currentY + deltaY,
        };
        const { entity, collision } = this.grid.query(newPosition);
        // Check for entities
        if (entity) {
            switch (entity.constructor) {
                case _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__["default"]: {
                    const enemy = entity;
                    this.addMessage(`You bump into ${Game.nounPhrase(enemy)} ${enemy.stringRepresentation()}`);
                    break;
                }
                case _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__["default"]: {
                    const weapon = entity;
                    this.player.pickUpWeapon(weapon);
                    this.grid.removeEntity(weapon);
                    this.addMessage(`You pick up ${Game.nounPhrase(weapon)}`);
                    break;
                }
                case _entities_Item__WEBPACK_IMPORTED_MODULE_5__["default"]: {
                    // Pick up item
                    const item = entity;
                    this.player.pickUpItem(item);
                    this.grid.removeEntity(item);
                    this.addMessage(`You pick up ${Game.nounPhrase(item)}`);
                    break;
                }
                default:
                    break;
            }
        }
        // Check for collision
        if (!collision) {
            this.grid.moveEntity(this.player, newPosition);
        }
        if (this.doResetCamera) {
            const newCameraPosition = this.player.cameraTarget.getWorldPosition();
            this.cameraController.moveTo(newCameraPosition);
            this.camera.transform.setRotationDeg(-45, 180, 0);
        }
        this.postTurn();
        this.printGame();
    }
    moveCamera(translation) {
        const { position } = this.renderer.camera.transform;
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.add(position, translation, position);
        return position;
    }
    attack() {
        if (this.state !== GameState.WALKING)
            return;
        // Search for an enemy withing the nearest four tiles
        const range = [0, -1, -1, 0, 0, 1, 1, 0];
        let enemy;
        const { x: playerX, y: playerY } = this.grid.getPositionOf(this.player);
        for (let i = 0; i < range.length; i += 2) {
            const checkPosition = {
                x: playerX + range[i],
                y: playerY + range[i + 1],
            };
            const entity = this.grid.getEntityAt(checkPosition);
            if (entity && entity instanceof _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__["default"]) {
                enemy = entity;
                break;
            }
        }
        if (!enemy) {
            this.addMessage('No Enemies in Range');
            this.printGame();
            return;
        }
        if (!this.player.equippedWeapon) {
            this.addMessage('No Weapon Equipped');
            this.printGame();
            return;
        }
        enemy.combatTimer = 7;
        // Player attack
        let rand = 1 + Math.floor((Math.random() * 5));
        const SP = this.player.skill + rand + this.player.equippedWeapon.skillBonus;
        if (SP > enemy.skill) {
            // Attack hit
            enemy.health -= this.player.equippedWeapon.damage;
            this.addMessage(`${enemy.name} took ${this.player.equippedWeapon.damage} damage. ${enemy.name} has ${Math.max(enemy.health, 0)} health remaining`);
            if (enemy.health <= 0) {
                // Enemy defeated
                this.player.skill += 1;
                this.grid.removeEntity(enemy);
                this.addMessage(`${enemy.name} has been defeated`);
                if (this.grid.getEntities().enemies.size === 0) {
                    this.addMessage('All Enemies Defeated');
                    this.addMessage('You Win');
                    this.stopGame();
                }
                this.printGame();
                return;
            }
        }
        else {
            // Attack miss
            this.addMessage('Attack Missed. No damage dealt');
        }
        // Enemy attack
        rand = 1 + Math.floor((Math.random() * 5));
        const enemySP = enemy.skill + rand;
        if (enemySP > SP) {
            // Attack hit
            this.player.health -= enemy.damage;
            this.addMessage(`${enemy.name} deals ${enemy.damage} damage`);
            if (this.player.health <= 0) {
                this.addMessage('You Died.\nGame Over.');
                this.printGame();
                this.stopGame();
                return;
            }
        }
        else {
            // Arrack miss
            this.addMessage(`${enemy.name} misses. No damage dealt`);
        }
        this.postTurn();
        this.printGame();
    }
    toggleInventory() {
        if (this.state === GameState.INVENTORY) {
            // Close inventory
            this.state = GameState.WALKING;
        }
        else {
            // Open inventory
            this.addMessage('You look at your inventory');
            this.state = GameState.INVENTORY;
        }
        this.printGame();
    }
    selectFromInventory(index) {
        if (this.state !== GameState.INVENTORY)
            return;
        // if (index >= this.player.inventory.weapons.length) return;
        if (index >= this.player.inventory.inventory.length)
            return;
        // const weapon = this.player.inventory.weapons[index];
        const inventoryObj = this.player.inventory.inventory[index];
        if (inventoryObj instanceof _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__["default"]) {
            const weapon = inventoryObj;
            if (this.player.equippedWeapon === weapon) {
                this.message += `"You already have this ${weapon.name} equipped"\n`;
                this.printGame();
                return;
            }
            this.player.equippedWeapon = weapon;
            this.addMessage(`You equip ${Game.nounPhrase(weapon)}`);
        }
        else if (inventoryObj instanceof _entities_Item__WEBPACK_IMPORTED_MODULE_5__["default"]) {
            const item = inventoryObj;
            this.player.health += item.effectHP;
            this.player.skill += item.effectSP;
            this.player.useUpItem(item);
            this.message += `Use Item: ${item.name} : ${item.description}`;
        }
        this.postTurn();
        this.printGame();
    }
    addMessage(message) {
        this.message += `"${message}"\n`;
    }
    postTurn() {
        this.grid.getEntities().enemies.forEach((enemy) => {
            enemy.combatTimer -= 1;
            if (enemy.combatTimer > 0)
                return;
            const { x: currentX, y: currentY } = this.grid.getPositionOf(enemy);
            const range = [0, -1, -1, 0, 0, 1, 1, 0];
            const randPos = Math.floor(Math.random() * 4) * 2;
            const newPosition = {
                x: currentX + range[randPos],
                y: currentY + range[randPos + 1],
            };
            const { entity, collision } = this.grid.query(newPosition);
            if (entity || collision)
                return;
            this.grid.moveEntity(enemy, newPosition);
        });
    }
    printGame() {
        // Update the UI
        this.gamePanel.update();
        this.minimapPanel.update();
        /* eslint-disable no-console */
        // Grid
        // console.log(this.grid.stringRepresentation());
        // Player stats
        console.log(this.player.stringRepresentation());
        if (this.player.equippedWeapon) {
            // Equpped weapon
            console.log('Equipped weapon:', this.player.equippedWeapon.stringRepresentation());
        }
        if (this.message) {
            // Message
            console.log(this.message);
            this.message = '';
        }
        if (this.state === GameState.INVENTORY) {
            // Inventory
            console.log(this.player.inventory.stringRepresentation());
        }
        /* eslint-enable no-console */
    }
    static nounPhrase(object) {
        if (Game.isVowel(object.name.charAt(0))) {
            return `an ${object.name}`;
        }
        return `a ${object.name}`;
    }
    static isVowel(character) {
        return 'aeiou'.split('').includes(character.charAt(0).toLowerCase());
    }
}

});

/***/ }),

/***/ 1227:
/*!**************************!*\
  !*** ./src/game/Grid.ts ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Grid)
/* harmony export */ });
/* harmony import */ var _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./tiles/FloorTile */ 7790);
/* harmony import */ var _tiles_WallTile__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tiles/WallTile */ 9457);
/* harmony import */ var _entities_Player__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./entities/Player */ 8501);
/* harmony import */ var _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./entities/Enemy */ 5296);
/* harmony import */ var _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./entities/Weapon */ 2354);
/* harmony import */ var _entities_Item__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./entities/Item */ 3282);
/* harmony import */ var _renderer_SceneNode__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../renderer/SceneNode */ 9011);
/* harmony import */ var _renderer_Transform__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../renderer/Transform */ 6444);
/* harmony import */ var _Dungeon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./Dungeon */ 5608);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_entities_Item__WEBPACK_IMPORTED_MODULE_5__, _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__, _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__, _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__, _entities_Player__WEBPACK_IMPORTED_MODULE_2__, _tiles_WallTile__WEBPACK_IMPORTED_MODULE_1__]);
([_entities_Item__WEBPACK_IMPORTED_MODULE_5__, _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__, _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__, _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__, _entities_Player__WEBPACK_IMPORTED_MODULE_2__, _tiles_WallTile__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__);









class Grid {
    tiles;
    player;
    entities;
    entityLookup;
    positionLookup;
    sceneNode;
    scene;
    constructor(scene) {
        this.scene = scene;
        this.entities = {
            enemies: new Set(),
            weapons: new Set(),
            items: new Set(),
        };
        this.entityLookup = [];
        this.positionLookup = new Map();
        this.generateMap();
    }
    // Should only be called once after the map has been set
    buildDungeon() {
        // TODO: use model extents, normalize models to be the same size, and use
        // that for the tileSize
        const tileSize = 1.0;
        // TODO: remove after having movable camera
        const zFactor = 1;
        this.tiles.forEach((row, y) => {
            row.forEach((tile, x) => {
                this.sceneNode.addChild(tile.modelNode);
                tile.setTransform(new _renderer_Transform__WEBPACK_IMPORTED_MODULE_7__["default"]([x * tileSize, 0, y * tileSize * zFactor]));
            });
        });
    }
    getTiles() { return this.tiles; }
    getPlayer() { return this.player; }
    getEntities() { return this.entities; }
    getTileAt({ x, y }) { return this.tiles[y][x]; }
    getEntityAt({ x, y }) { return this.entityLookup[y][x]; }
    getPositionOf(entity) { return this.positionLookup.get(entity); }
    generateMap() {
        if (this.sceneNode) {
            this.entities = {
                enemies: new Set(),
                weapons: new Set(),
                items: new Set(),
            };
            this.entityLookup = [];
            this.positionLookup = new Map();
            this.sceneNode.removeSelf();
        }
        this.sceneNode = new _renderer_SceneNode__WEBPACK_IMPORTED_MODULE_6__["default"]('Grid');
        this.scene.addNode(this.sceneNode);
        this.loadGridFromString(_Dungeon__WEBPACK_IMPORTED_MODULE_8__["default"].generate(35, 35, 7));
        this.buildDungeon();
    }
    query(position) {
        const tile = this.getTileAt(position);
        const entity = this.getEntityAt(position);
        const collision = (!tile || tile.isCollidable) || (entity && entity.isCollidable);
        return { tile, entity, collision };
    }
    // If tiles is null, then the entities aren't added a children to their
    // ModelNodes. It's up to the caller to remedy that.
    addEntity(entity, { x, y }) {
        if (entity instanceof _entities_Player__WEBPACK_IMPORTED_MODULE_2__["default"]) {
            this.player = entity;
        }
        // Add entity to corresponding entity set
        this.forSubtypeOfEntity(entity, (entitySubtype, set) => {
            set.add(entitySubtype);
        });
        // Record entity's position on grid
        this.entityLookup[y][x] = entity;
        this.positionLookup.set(entity, { x, y });
        if (this.tiles)
            this.tiles[y][x].modelNode.addChild(entity.modelNode);
    }
    removeEntity(entity) {
        // Remove entity from corresponding entity set
        this.forSubtypeOfEntity(entity, (entitySubtype, set) => {
            set.delete(entitySubtype);
        });
        // Remove entity's position on grid
        const { x, y } = this.positionLookup.get(entity);
        this.entityLookup[y][x] = undefined;
        this.positionLookup.delete(entity);
        entity.modelNode.removeSelf();
        return entity;
    }
    moveEntity(entity, { x: newX, y: newY }) {
        // Change entity's position on grid
        const { x: oldX, y: oldY } = this.positionLookup.get(entity);
        this.entityLookup[oldY][oldX] = undefined;
        this.entityLookup[newY][newX] = entity;
        this.positionLookup.set(entity, { x: newX, y: newY });
        this.tiles[newY][newX].modelNode.addChild(entity.modelNode);
    }
    stringRepresentation() {
        // Floors and walls
        const textArray = this.tiles.map((tileRow) => tileRow.map((tile) => tile.character));
        // Non-player entities
        Object.values(this.entities).forEach((set) => {
            set.forEach((entity) => {
                const { x, y } = this.getPositionOf(entity);
                textArray[y][x] = entity.character;
            });
        });
        // Player
        const { x, y } = this.getPositionOf(this.player);
        textArray[y][x] = _entities_Player__WEBPACK_IMPORTED_MODULE_2__["default"].character;
        let text = '';
        textArray.forEach((row) => {
            row.forEach((character) => {
                text += character;
            });
            text += '\n';
        });
        return text;
    }
    loadGridFromString(string) {
        this.tiles = string.split('\n').map((stringRow, y) => stringRow.split('').map((character, x) => {
            this.entityLookup.push([]);
            switch (character) {
                case _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__["default"].character:
                    return new _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__["default"]();
                case _tiles_WallTile__WEBPACK_IMPORTED_MODULE_1__["default"].character:
                    return new _tiles_WallTile__WEBPACK_IMPORTED_MODULE_1__["default"]();
                case _entities_Player__WEBPACK_IMPORTED_MODULE_2__["default"].character:
                    this.addEntity(new _entities_Player__WEBPACK_IMPORTED_MODULE_2__["default"](), { x, y });
                    return new _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__["default"]();
                case _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__["default"].character:
                    this.addEntity(new _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__["default"](), { x, y });
                    return new _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__["default"]();
                case _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__["default"].character:
                    this.addEntity(new _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__["default"](), { x, y });
                    return new _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__["default"]();
                case _entities_Item__WEBPACK_IMPORTED_MODULE_5__["default"].character:
                    this.addEntity(new _entities_Item__WEBPACK_IMPORTED_MODULE_5__["default"](), { x, y });
                    return new _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__["default"]();
                default:
                    return new _tiles_FloorTile__WEBPACK_IMPORTED_MODULE_0__["default"]();
            }
        }));
        this.positionLookup.forEach(({ x, y }, entity) => {
            this.tiles[y][x].modelNode.addChild(entity.modelNode);
        });
    }
    forSubtypeOfEntity(entity, callback) {
        switch (entity.constructor) {
            case _entities_Enemy__WEBPACK_IMPORTED_MODULE_3__["default"]:
                callback(entity, this.entities.enemies);
                break;
            case _entities_Weapon__WEBPACK_IMPORTED_MODULE_4__["default"]:
                callback(entity, this.entities.weapons);
                break;
            case _entities_Item__WEBPACK_IMPORTED_MODULE_5__["default"]:
                callback(entity, this.entities.items);
                break;
            default:
                break;
        }
    }
}

});

/***/ }),

/***/ 327:
/*!*******************************!*\
  !*** ./src/game/Inventory.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Inventory)
/* harmony export */ });
class Inventory {
    weapons;
    inventory;
    constructor() {
        this.weapons = [];
        this.inventory = [];
    }
    stringRepresentation() {
        // if (this.weapons.length > 0) {
        //   return `weapons: ${
        //     this.weapons
        //       .map((weapon, index) => `\n  ${index + 1}. ${weapon.stringRepresentation()}`)
        //       .join()
        //   }`;
        // }
        if (this.inventory.length > 0) {
            return `Inventory: ${this.inventory
                .map((item, index) => `\n  ${index + 1}. ${item.stringRepresentation()}`)
                .join()}`;
        }
        return 'weapons: (no weapons)';
    }
}


/***/ }),

/***/ 5574:
/*!*********************************!*\
  !*** ./src/game/KeyListener.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "KeyPressType": () => (/* binding */ KeyPressType),
/* harmony export */   "default": () => (/* binding */ KeyListener)
/* harmony export */ });
var KeyPressType;
(function (KeyPressType) {
    KeyPressType[KeyPressType["DOWN"] = 0] = "DOWN";
    KeyPressType[KeyPressType["UP"] = 1] = "UP";
})(KeyPressType || (KeyPressType = {}));
class KeyListener {
    keyDownCallbacks = new Map();
    keyUpCallbacks = new Map();
    keyDownHandler;
    keyUpHandler;
    constructor() {
        this.keyDownHandler = (keyEvent) => {
            // If callback exists for the given key or code
            [keyEvent.key, keyEvent.code].find((key) => {
                if (this.keyDownCallbacks.has(key)) {
                    // Invoke callback
                    (this.keyDownCallbacks.get(key))(keyEvent);
                    return true;
                }
                return false;
            });
        };
        this.keyUpHandler = (keyEvent) => {
            // If callback exists for the given key or code
            [keyEvent.key, keyEvent.code].find((key) => {
                if (this.keyUpCallbacks.has(key)) {
                    // Invoke callback
                    (this.keyUpCallbacks.get(key))(keyEvent);
                    return true;
                }
                return false;
            });
        };
    }
    addListener(keys, callback, pressType = KeyPressType.DOWN) {
        const callbacks = pressType === KeyPressType.DOWN
            ? this.keyDownCallbacks : this.keyUpCallbacks;
        // Add callback to the given key(s)
        [keys].flat().forEach((key) => {
            callbacks.set(key, callback);
        });
    }
    addListeners(listeners) {
        // Add callback for each given key-callback pair
        listeners.forEach(([keys, callback, pressType]) => {
            this.addListener(keys, callback, pressType);
        });
    }
    startListening() {
        window.addEventListener('keydown', this.keyDownHandler);
        window.addEventListener('keyup', this.keyUpHandler);
    }
    stopListening() {
        window.removeEventListener('keydown', this.keyDownHandler);
        window.removeEventListener('keyup', this.keyUpHandler);
    }
}


/***/ }),

/***/ 5296:
/*!************************************!*\
  !*** ./src/game/entities/Enemy.ts ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Enemy)
/* harmony export */ });
/* harmony import */ var _renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../renderer/Model */ 5911);
/* harmony import */ var _Entity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Entity */ 4038);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_renderer_Model__WEBPACK_IMPORTED_MODULE_0__]);
_renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];


const models = {
    maggot: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/Maggot/model.json'),
    slimeMold: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/SlimeMold/model.json'),
    goblin: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/Goblin/model.json'),
    ork: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/Ork/model.json'),
    vampire: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/Vampire/model.json'),
};
/* eslint quote-props: ["error", "consistent"] */
const enemies = new Map([
    ['Maggot', {
            health: 4, skill: 0, damage: 4, model: models.maggot,
        }],
    ['Slime Mold', {
            health: 7, skill: 1, damage: 3, model: models.slimeMold,
        }],
    ['Goblin', {
            health: 9, skill: 4, damage: 5, model: models.goblin,
        }],
    ['Ork', {
            health: 11, skill: 2, damage: 7, model: models.ork,
        }],
    ['Vampire', {
            health: 20, skill: 9, damage: 10, model: models.vampire,
        }],
]);
class Enemy extends _Entity__WEBPACK_IMPORTED_MODULE_1__["default"] {
    static character = 'e';
    static isCollidable = true;
    // name: string;
    health;
    skill;
    damage;
    combatTimer;
    constructor(name = Enemy.randomEnemyName()) {
        super(enemies.get(name).model, Enemy.character, Enemy.isCollidable);
        this.name = name;
        this.health = enemies.get(name)?.health ?? 1;
        this.skill = enemies.get(name)?.skill ?? 0;
        this.damage = enemies.get(name)?.damage ?? 0;
        this.combatTimer = 0;
    }
    stringRepresentation() {
        return `(HP: ${this.health}, SP: ${this.skill}, damage: ${this.damage})`;
    }
    static randomEnemyName() {
        const names = Array.from(enemies.keys());
        return names[Math.floor(Math.random() * names.length)];
    }
}

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 4038:
/*!*************************************!*\
  !*** ./src/game/entities/Entity.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Entity)
/* harmony export */ });
class Entity {
    character;
    name;
    isCollidable;
    modelNode;
    stringRepresentation() {
        return this.character;
    }
    constructor(model, character, isCollidable) {
        this.character = character.charAt(0);
        this.isCollidable = isCollidable;
        this.modelNode = model.createModelNode();
    }
}


/***/ }),

/***/ 3282:
/*!***********************************!*\
  !*** ./src/game/entities/Item.ts ***!
  \***********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Item)
/* harmony export */ });
/* harmony import */ var _renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../renderer/Model */ 5911);
/* harmony import */ var _Entity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Entity */ 4038);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_renderer_Model__WEBPACK_IMPORTED_MODULE_0__]);
_renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];


// const rationModel = await Model.load('/assets/Ration/model.json');
const models = {
    ration: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/ration/model.json'),
    gourmetMeal: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/gourmet_meal/model.json'),
    silverRing: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/silver_ring/model.json'),
    foolsCap: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/fools_cap/model.json'),
};
/* eslint quote-props: ["error", "consistent"] */
const items = new Map([
    ['Rations', {
            effectHP: 5, effectSP: 0, description: 'Give 5 HP', model: models.ration,
        }],
    ['Gourmet Meal', {
            effectHP: 10, effectSP: 0, description: 'Give 10 HP', model: models.gourmetMeal,
        }],
    ['Silver Ring', {
            effectHP: 0, effectSP: 5, description: 'Give 5 SP', model: models.silverRing,
        }],
    ['Fool\'s Cap', {
            effectHP: 10, effectSP: -10, description: 'Give 10 HP, Remove 10 SP', model: models.foolsCap,
        }],
]);
class Item extends _Entity__WEBPACK_IMPORTED_MODULE_1__["default"] {
    static character = 'i';
    static isCollidable = false;
    // name: string;
    effectHP;
    effectSP;
    description;
    constructor(name = Item.randomitemName()) {
        super(items.get(name).model, Item.character, Item.isCollidable);
        this.name = name;
        this.effectHP = items.get(name)?.effectHP ?? 0;
        this.effectSP = items.get(name)?.effectSP ?? 0;
        this.description = items.get(name)?.description ?? '';
    }
    stringRepresentation() {
        return `${this.name} (Effect: ${this.description})`;
    }
    static randomitemName() {
        const names = Array.from(items.keys());
        return names[Math.floor(Math.random() * names.length)];
    }
}

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 8501:
/*!*************************************!*\
  !*** ./src/game/entities/Player.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Player)
/* harmony export */ });
/* harmony import */ var _Entity__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Entity */ 4038);
/* harmony import */ var _Inventory__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Inventory */ 327);
/* harmony import */ var _renderer_Model__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../renderer/Model */ 5911);
/* harmony import */ var _renderer_SceneNode__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../renderer/SceneNode */ 9011);
/* harmony import */ var _util_Math__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../util/Math */ 2835);
/* harmony import */ var _renderer_Transform__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../renderer/Transform */ 6444);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_renderer_Model__WEBPACK_IMPORTED_MODULE_2__]);
_renderer_Model__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];






const model = await _renderer_Model__WEBPACK_IMPORTED_MODULE_2__["default"].load('/assets/Player/model.json');
class Player extends _Entity__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static character = '@';
    static isCollidable = true;
    health;
    skill;
    inventory;
    equippedWeapon;
    cameraTarget;
    constructor() {
        const initCamDistance = 4;
        const initCamAngle = 45;
        const { xLen, yLen, zLen } = model.extents;
        super(model, Player.character, Player.isCollidable);
        this.health = 20;
        this.skill = 0;
        this.inventory = new _Inventory__WEBPACK_IMPORTED_MODULE_1__["default"]();
        this.equippedWeapon = null;
        let maxLen = xLen;
        if (maxLen < yLen)
            maxLen = yLen;
        if (maxLen < zLen)
            maxLen = zLen;
        this.modelNode.localTransform.scale = [1 / maxLen, 1 / maxLen, 1 / maxLen];
        this.cameraTarget = new _renderer_SceneNode__WEBPACK_IMPORTED_MODULE_3__["default"]('Player Camera Target', new _renderer_Transform__WEBPACK_IMPORTED_MODULE_5__["default"]([
            0,
            initCamDistance * Math.sin((0,_util_Math__WEBPACK_IMPORTED_MODULE_4__.toRadians)(initCamAngle)),
            -initCamDistance * Math.cos((0,_util_Math__WEBPACK_IMPORTED_MODULE_4__.toRadians)(initCamAngle)),
        ]));
        // Assuming Raymon is initially facing in the +z direction. Pray this never
        // changes.
        this.modelNode.addChild(this.cameraTarget);
    }
    pickUpWeapon(weapon) {
        // this.inventory.weapons.push(weapon);
        this.inventory.inventory.push(weapon);
        if (!this.equippedWeapon) {
            this.equippedWeapon = weapon;
        }
    }
    stringRepresentation() {
        let string = `HP: ${this.health}, SP: ${this.skill}`;
        if (this.equippedWeapon) {
            string += `(${this.equippedWeapon.skillBonus >= 0 ? '+' : ''}${this.equippedWeapon.skillBonus})`;
        }
        return string;
    }
    pickUpItem(item) {
        this.inventory.inventory.push(item);
    }
    useUpItem(item) {
        const index = this.inventory.inventory.indexOf(item);
        this.inventory.inventory.splice(index, 1);
    }
}

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 2354:
/*!*************************************!*\
  !*** ./src/game/entities/Weapon.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Weapon)
/* harmony export */ });
/* harmony import */ var _renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../renderer/Model */ 5911);
/* harmony import */ var _Entity__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Entity */ 4038);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_renderer_Model__WEBPACK_IMPORTED_MODULE_0__]);
_renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];


const models = {
    dagger: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/dagger/model.json'),
    castIronPan: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/cast_iron_pan/model.json'),
    warHammer: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/war_hammer/model.json'),
    hatchet: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/hatchet/model.json'),
    battleaxe: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/battleaxe/model.json'),
    sword: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/sword/model.json'),
    baton: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/baton/model.json'),
    battleStaff: await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load('/assets/battle_staff/model.json'),
};
/* eslint quote-props: ["error", "consistent"] */
const weapons = new Map([
    ['Dagger', { damage: 3, skillBonus: 0, model: models.dagger }],
    ['Cast Iron Pan', { damage: 7, skillBonus: 1, model: models.castIronPan }],
    ['War Hammer', { damage: 12, skillBonus: -1, model: models.warHammer }],
    ['Hatchet', { damage: 3, skillBonus: 4, model: models.hatchet }],
    ['Battleaxe', { damage: 10, skillBonus: 2, model: models.battleaxe }],
    ['Sword', { damage: 7, skillBonus: 3, model: models.sword }],
    ['Baton', { damage: 2, skillBonus: 7, model: models.baton }],
    ['Battle Staff', { damage: 6, skillBonus: 3, model: models.battleStaff }],
]);
class Weapon extends _Entity__WEBPACK_IMPORTED_MODULE_1__["default"] {
    static character = 'w';
    static isCollidable = false;
    // name: string;
    damage;
    skillBonus;
    constructor(name = Weapon.randomWeaponName()) {
        super(weapons.get(name).model, Weapon.character, Weapon.isCollidable);
        this.name = name;
        this.damage = weapons.get(name)?.damage ?? 0;
        this.skillBonus = weapons.get(name)?.skillBonus ?? 0;
    }
    stringRepresentation() {
        return `${this.name} (damage: ${this.damage}, skill bonus: ${this.skillBonus})`;
    }
    static randomWeaponName() {
        const names = Array.from(weapons.keys());
        return names[Math.floor(Math.random() * names.length)];
    }
}

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 7790:
/*!*************************************!*\
  !*** ./src/game/tiles/FloorTile.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ FloorTile)
/* harmony export */ });
/* harmony import */ var _renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../renderer/Model */ 5911);
/* harmony import */ var _renderer_Transform__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../renderer/Transform */ 6444);
/* harmony import */ var _Tile__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Tile */ 5075);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_renderer_Model__WEBPACK_IMPORTED_MODULE_0__]);
_renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];



const modelUrl = '/assets/Floor/model.json';
const floorModel = await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load(modelUrl);
class FloorTile extends _Tile__WEBPACK_IMPORTED_MODULE_2__.Tile {
    static type = 'FloorTile';
    static character = '.';
    static isCollidable = false;
    constructor(transform = new _renderer_Transform__WEBPACK_IMPORTED_MODULE_1__["default"]()) {
        super(floorModel, FloorTile.character, FloorTile.isCollidable, transform);
    }
}

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 5075:
/*!********************************!*\
  !*** ./src/game/tiles/Tile.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Tile": () => (/* binding */ Tile)
/* harmony export */ });
/* harmony import */ var _renderer_Transform__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../renderer/Transform */ 6444);

class Tile {
    static type = 'Tile';
    character;
    isCollidable;
    modelNode;
    constructor(model, character, isCollidable, transform = new _renderer_Transform__WEBPACK_IMPORTED_MODULE_0__["default"]()) {
        this.character = character.charAt(0);
        this.isCollidable = isCollidable;
        this.modelNode = model.createModelNode(transform);
    }
    setTransform(transform) {
        this.modelNode.localTransform = transform;
    }
}


/***/ }),

/***/ 9457:
/*!************************************!*\
  !*** ./src/game/tiles/WallTile.ts ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ WallTile)
/* harmony export */ });
/* harmony import */ var _renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../renderer/Model */ 5911);
/* harmony import */ var _renderer_Transform__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../renderer/Transform */ 6444);
/* harmony import */ var _Tile__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Tile */ 5075);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_renderer_Model__WEBPACK_IMPORTED_MODULE_0__]);
_renderer_Model__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];



const modelUrl = '/assets/Wall/model.json';
const wallModel = await _renderer_Model__WEBPACK_IMPORTED_MODULE_0__["default"].load(modelUrl);
class WallTile extends _Tile__WEBPACK_IMPORTED_MODULE_2__.Tile {
    static type = 'WallTile';
    static character = '|';
    static isCollidable = true;
    constructor(transform = new _renderer_Transform__WEBPACK_IMPORTED_MODULE_1__["default"]()) {
        super(wallModel, WallTile.character, WallTile.isCollidable, transform);
    }
}

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 1177:
/*!********************************!*\
  !*** ./src/renderer/Camera.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Camera)
/* harmony export */ });
class Camera {
    transform;
}


/***/ }),

/***/ 6110:
/*!*******************************!*\
  !*** ./src/renderer/Color.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Color)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);

class Color {
    r;
    g;
    b;
    /**
     * Creates an RGB color from color components represented by decimal numbers
     * between 0.0 and 1.0
     *
     * @param red Red color component between 0.0 and 1.0
     * @param green Green color component between 0.0 and 1.0
     * @param blue Blue color component between 0.0 and 1.0
     */
    constructor(red, green, blue) {
        if (red < 0.0 || red > 1.0
            || green < 0.0 || green > 1.0
            || blue < 0.0 || blue > 1.0) {
            throw new Error('Invalid Color component range (outside 0.0-1.0)');
        }
        this.r = red;
        this.g = green;
        this.b = blue;
    }
    /**
     * Converts a hex string to a color. Can be provided in either six or three-digit
     * formats. Ex. '#0099CC' or '#09C'
     *
     * Capitalization is ignored
     *
     * @param hex Hex string representing a color
     */
    static fromHex(hex) {
        if (hex.length !== 7 && hex.length !== 4) {
            throw new Error('Invalid hex string argument in Color creation');
        }
        let redString;
        let greenString;
        let blueString;
        if (hex.length === 7) {
            redString = hex.substring(1, 3);
            greenString = hex.substring(3, 5);
            blueString = hex.substring(5, 7);
        }
        else {
            redString = hex[1] + hex[1];
            greenString = hex[2] + hex[2];
            blueString = hex[3] + hex[3];
        }
        const red = parseInt(redString, 16) / 255.0;
        const green = parseInt(greenString, 16) / 255.0;
        const blue = parseInt(blueString, 16) / 255.0;
        return new Color(red, green, blue);
    }
    toVec3() {
        return twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.create(this.r, this.g, this.b);
    }
}


/***/ }),

/***/ 4281:
/*!*********************************!*\
  !*** ./src/renderer/DebugUI.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ DebugUI)
/* harmony export */ });
/* harmony import */ var _ui_FrameTimePanel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../ui/FrameTimePanel */ 5944);
/* harmony import */ var _ui_scene_panel_ScenePanel__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../ui/scene-panel/ScenePanel */ 1985);


class DebugUI {
    renderer;
    container;
    frameTimePanel;
    scenePanel;
    isVisible;
    constructor(renderer, container, isVisible = false) {
        this.renderer = renderer;
        this.container = container;
        this.isVisible = isVisible;
        if (this.isVisible) {
            this.show();
        }
        const toggleInputCallback = (ev) => {
            if (ev.key === '.') {
                this.toggleVisibility();
            }
        };
        window.addEventListener('keydown', toggleInputCallback);
        if (false) {}
    }
    show() {
        this.bindFrameTimePanel();
        this.bindScenePanel();
        this.isVisible = true;
    }
    hide() {
        this.unbindFrameTimePanel();
        this.unbindScenePanel();
        this.isVisible = false;
    }
    toggleVisibility() {
        if (this.isVisible) {
            this.hide();
        }
        else {
            this.show();
        }
    }
    bindFrameTimePanel() {
        this.frameTimePanel = new _ui_FrameTimePanel__WEBPACK_IMPORTED_MODULE_0__["default"](this.renderer);
        document.body.appendChild(this.frameTimePanel.element);
    }
    unbindFrameTimePanel() {
        if (this.frameTimePanel) {
            document.body.removeChild(this.frameTimePanel.element);
            this.frameTimePanel.cleanUp();
            this.frameTimePanel = null;
        }
    }
    bindScenePanel() {
        this.scenePanel = new _ui_scene_panel_ScenePanel__WEBPACK_IMPORTED_MODULE_1__["default"](this.renderer);
        this.container.appendChild(this.scenePanel);
    }
    unbindScenePanel() {
        if (this.scenePanel) {
            this.container.removeChild(this.scenePanel);
            this.scenePanel = null;
        }
    }
}


/***/ }),

/***/ 3467:
/*!******************************!*\
  !*** ./src/renderer/Mesh.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Mesh)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);

/**
 * A less-generalized Mesh representation. For simplicity we are sticking with
 * having 3 attributes (position, normal, and uv) alongside the indices.
 *
 * These attributes are meant to be passed into a shader with standard names
 * as shown.
 *
 * You may leave out normal, uv, or indices.
 *
 * The number of components for these members should always be:
 * /--------------\
 * | position | 3 |
 * | normal   | 3 |
 * | uv       | 2 |
 * | indices  | 3 |
 * \--------------/
 *
 * This is a class to generalize later on, as its invariants are stiff.
 */
class Mesh {
    static NUM_COMPONENTS_POSITION = 3;
    static NUM_COMPONENTS_NORMAL = 3;
    static NUM_COMPONENTS_UV = 2;
    static NUM_COMPONENTS_INDICES = 3;
    position;
    normal;
    uv;
    indices;
    name;
    bufferInfo;
    arrays;
    constructor(position, normal, uv, indices, name) {
        this.position = position;
        this.normal = normal;
        this.uv = uv;
        this.indices = indices;
        this.name = name;
    }
    getArrays() {
        if (!this.arrays) {
            this.arrays = this.createArrays();
        }
        return this.arrays;
    }
    getBufferInfo(gl) {
        if (!this.bufferInfo) {
            this.bufferInfo = (0,twgl_js__WEBPACK_IMPORTED_MODULE_0__.createBufferInfoFromArrays)(gl, this.createArrays());
        }
        return this.bufferInfo;
    }
    createArrays() {
        return {
            position: {
                numComponents: Mesh.NUM_COMPONENTS_POSITION,
                data: this.position,
            },
            ...(this.normal && {
                normal: {
                    numComponents: Mesh.NUM_COMPONENTS_NORMAL,
                    data: this.normal,
                },
            }),
            ...(this.uv && {
                uv: {
                    numComponents: Mesh.NUM_COMPONENTS_UV,
                    data: this.uv,
                },
            }),
            ...(this.indices && {
                indices: {
                    numComponents: Mesh.NUM_COMPONENTS_INDICES,
                    data: this.indices,
                },
            }),
        };
    }
}


/***/ }),

/***/ 4001:
/*!**********************************!*\
  !*** ./src/renderer/MeshNode.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ MeshNode)
/* harmony export */ });
/* harmony import */ var _SceneNode__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SceneNode */ 9011);
/* harmony import */ var _Transform__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Transform */ 6444);


class MeshNode extends _SceneNode__WEBPACK_IMPORTED_MODULE_0__["default"] {
    mesh;
    material;
    static numMeshNodes = 0;
    constructor(transform = new _Transform__WEBPACK_IMPORTED_MODULE_1__["default"](), mesh, material, name) {
        const defaultName = `meshNode#${MeshNode.numMeshNodes}`;
        let computedName;
        if (name) {
            computedName = name;
        }
        else if (mesh.name) {
            computedName = `${mesh.name}-${defaultName}`;
        }
        else {
            computedName = defaultName;
        }
        super(computedName, transform);
        this.mesh = mesh;
        this.material = material;
        MeshNode.numMeshNodes += 1;
    }
}


/***/ }),

/***/ 5911:
/*!*******************************!*\
  !*** ./src/renderer/Model.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Model)
/* harmony export */ });
/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! three */ 2212);
/* harmony import */ var three_examples_jsm_loaders_OBJLoader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! three/examples/jsm/loaders/OBJLoader */ 7011);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ 6470);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _Mesh__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Mesh */ 3467);
/* harmony import */ var _MeshNode__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./MeshNode */ 4001);
/* harmony import */ var _Transform__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Transform */ 6444);
/* harmony import */ var _materials_MaterialInternal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./materials/_MaterialInternal */ 4143);
/* harmony import */ var _ModelNode__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ModelNode */ 6288);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_materials_MaterialInternal__WEBPACK_IMPORTED_MODULE_5__]);
_materials_MaterialInternal__WEBPACK_IMPORTED_MODULE_5__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];








/**
 * Class that holds model data.
 *
 * A Model instance is a structure containing the meshes and material
 * that should be applied to each mesh.
 *
 * There should only be one Model instance for each 3D model you
 * want to load in the game. You can use the `createModelNode`
 * method to generate a ModelNode with MeshNode children ready
 * for placement in a scene.
 *
 * NOTE: Currently only supports OBJ models.
 *
 * TODO: Support more than just OBJ models (probably GLTF / GLB first)
 */
class Model {
    static cache = new Map();
    static numModels = 0;
    meshes;
    material;
    extents;
    name;
    constructor(meshes, material, name) {
        this.meshes = meshes;
        this.material = material;
        this.extents = this.calcModelExtents();
        this.name = name ?? `model#${Model.numModels}`;
        Model.numModels += 1;
    }
    createModelNode(transform = new _Transform__WEBPACK_IMPORTED_MODULE_4__["default"]()) {
        const modelNode = new _ModelNode__WEBPACK_IMPORTED_MODULE_6__["default"](this, transform, this.name);
        this.meshes.forEach((mesh) => {
            const meshNode = new _MeshNode__WEBPACK_IMPORTED_MODULE_3__["default"](new _Transform__WEBPACK_IMPORTED_MODULE_4__["default"](), mesh, this.material);
            modelNode.addChild(meshNode);
        });
        return modelNode;
    }
    calcModelExtents() {
        if (this.meshes.length < 1) {
            return {
                minX: 0,
                maxX: 0,
                minY: 0,
                maxY: 0,
                minZ: 0,
                maxZ: 0,
                xLen: 0,
                yLen: 0,
                zLen: 0,
            };
        }
        let minX = this.meshes[0].position[0];
        let maxX = this.meshes[0].position[0];
        let minY = this.meshes[0].position[1];
        let maxY = this.meshes[0].position[1];
        let minZ = this.meshes[0].position[2];
        let maxZ = this.meshes[0].position[2];
        this.meshes.forEach((mesh) => {
            mesh.position.forEach((v, j) => {
                switch (j % 3) {
                    case 0:
                        if (v < minX)
                            minX = v;
                        else if (v > maxX)
                            maxX = v;
                        break;
                    case 1:
                        if (v < minY)
                            minY = v;
                        else if (v > maxY)
                            maxY = v;
                        break;
                    case 2:
                        if (v < minZ)
                            minZ = v;
                        else if (v > maxZ)
                            maxZ = v;
                        break;
                    default:
                        throw new Error('This shouldnt happen because...math');
                }
            });
        });
        return {
            minX,
            maxX,
            minY,
            maxY,
            minZ,
            maxZ,
            xLen: maxX - minX,
            yLen: maxY - minY,
            zLen: maxZ - minZ,
        };
    }
    static createMeshArray(model) {
        const { children } = model;
        // Create meshes for the first level mesh children
        // TODO: (Low Priority) Support multi-level hierarchy of meshes? We might not need this
        const meshes = children.filter((child) => child instanceof three__WEBPACK_IMPORTED_MODULE_7__.Mesh)
            .map((child) => {
            const { geometry } = child;
            return new _Mesh__WEBPACK_IMPORTED_MODULE_2__["default"](new Float32Array(geometry.getAttribute('position').array), new Float32Array(geometry.getAttribute('normal').array), new Float32Array(geometry.getAttribute('uv').array), null, child.name);
        });
        return meshes;
    }
    static async fromURL(model_url, material, name) {
        const loader = new three_examples_jsm_loaders_OBJLoader__WEBPACK_IMPORTED_MODULE_0__.OBJLoader();
        const loadedModel = await loader.loadAsync(model_url);
        const meshNodes = Model.createMeshArray(loadedModel);
        return new Model(meshNodes, material, name);
    }
    static async load(url) {
        if (this.cache.has(url)) {
            return this.cache.get(url);
        }
        const configRequest = await fetch(url);
        const modelConfig = (await configRequest.json());
        const dir = path__WEBPACK_IMPORTED_MODULE_1__.dirname(url);
        // Load the model file
        const modelUrl = path__WEBPACK_IMPORTED_MODULE_1__.resolve(dir, modelConfig.model);
        const loader = new three_examples_jsm_loaders_OBJLoader__WEBPACK_IMPORTED_MODULE_0__.OBJLoader();
        const loadedModel = await loader.loadAsync(modelUrl);
        const meshes = Model.createMeshArray(loadedModel);
        // Load the material
        const materialUrl = path__WEBPACK_IMPORTED_MODULE_1__.resolve(dir, modelConfig.material);
        const material = await _materials_MaterialInternal__WEBPACK_IMPORTED_MODULE_5__.Material.load(materialUrl);
        const model = new Model(meshes, material, modelConfig.name);
        this.cache.set(url, model);
        return model;
    }
}

});

/***/ }),

/***/ 6288:
/*!***********************************!*\
  !*** ./src/renderer/ModelNode.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ModelNode)
/* harmony export */ });
/* harmony import */ var _SceneNode__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SceneNode */ 9011);

/**
 * A simple node type that represents a scene instance of a Model.
 *
 * This node will contain MeshNode children that were loaded from
 * the meshes of the Model.
 */
class ModelNode extends _SceneNode__WEBPACK_IMPORTED_MODULE_0__["default"] {
    model;
    static numModelNodes = 0;
    constructor(model, transform, name = `modelNode#${ModelNode.numModelNodes}`) {
        super(name, transform);
        this.model = model;
        ModelNode.numModelNodes += 1;
    }
}


/***/ }),

/***/ 3305:
/*!*******************************************!*\
  !*** ./src/renderer/PerspectiveCamera.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PerspectiveCamera)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);
/* harmony import */ var _util_Math__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Math */ 2835);
/* harmony import */ var _Camera__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Camera */ 1177);
/* harmony import */ var _Transform__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Transform */ 6444);




class PerspectiveCamera extends _Camera__WEBPACK_IMPORTED_MODULE_2__["default"] {
    fov;
    aspect;
    zNear;
    zFar;
    constructor(transform = new _Transform__WEBPACK_IMPORTED_MODULE_3__["default"](), fov = 60, aspect = 1, zNear = 0.1, zFar = 1000) {
        super();
        this.transform = transform;
        this.fov = fov;
        this.aspect = aspect;
        this.zNear = zNear;
        this.zFar = zFar;
    }
    getViewProjectionMatrix() {
        const projectionMatrix = this.getProjectionMatrix();
        const viewMatrix = this.getViewMatrix();
        return twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.multiply(projectionMatrix, viewMatrix);
    }
    getProjectionMatrix() {
        return twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.perspective((0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toRadians)(this.fov), this.aspect, this.zNear, this.zFar);
    }
    getViewMatrix() {
        return twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.inverse(this.transform.getMatrix());
    }
}


/***/ }),

/***/ 9870:
/*!**********************************!*\
  !*** ./src/renderer/Renderer.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Renderer)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);
/* harmony import */ var _MeshNode__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./MeshNode */ 4001);
/* harmony import */ var _PerspectiveCamera__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PerspectiveCamera */ 3305);
/* harmony import */ var _Scene__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Scene */ 8899);




class Renderer {
    gl;
    scene;
    camera;
    rendererUniforms;
    updateCallbacks = new Set();
    // Time in ms the last frame took to render
    frameTime = 0;
    animationRequestId;
    previousTime;
    renderMap;
    constructor(gl, scene = new _Scene__WEBPACK_IMPORTED_MODULE_3__["default"](), camera = new _PerspectiveCamera__WEBPACK_IMPORTED_MODULE_2__["default"]()) {
        this.gl = gl;
        this.scene = scene;
        this.camera = camera;
        this.renderMap = new Map();
        // Content initialization
        gl.clearColor(0.2, 0.075, 0.0, 1.0);
        // eslint-disable-next-line no-bitwise
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        gl.enable(gl.DEPTH_TEST);
        gl.enable(gl.CULL_FACE);
    }
    drawScene(time) {
        this.rendererUniforms = {
            u_time: time * 0.001,
            u_resolution: [this.gl.canvas.width, this.gl.canvas.height],
        };
        this.renderMap.clear();
        this.processNode(this.scene.root, twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.identity());
        // Render from renderMap (for each material type)
        this.renderMap.forEach((meshMap, shader) => {
            // each unique mesh
            meshMap.forEach((meshNodeInstances, mesh) => {
                if (!meshNodeInstances) {
                    return;
                }
                const programInfo = shader.getProgramInfo(this.gl);
                this.gl.useProgram(programInfo.program);
                // Compute matrix
                const cameraMatrix = this.camera.getViewProjectionMatrix();
                const eyePosition = twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.inverse(this.camera.getViewMatrix()).slice(12, 15);
                const templateNode = meshNodeInstances[0].node;
                // Set all uniforms
                (0,twgl_js__WEBPACK_IMPORTED_MODULE_0__.setUniforms)(programInfo, [
                    this.rendererUniforms,
                    templateNode.material.uniforms,
                    {
                        u_eyePosition: eyePosition,
                        u_cameraMatrix: cameraMatrix,
                    },
                ]);
                const matrices = new Float32Array(16 * meshNodeInstances.length);
                meshNodeInstances.forEach((instance, i) => matrices.set(instance.matrix, i * 16));
                const arrays = {
                    ...mesh.getArrays(),
                    a_matrix: {
                        numComponents: 16,
                        data: matrices,
                        divisor: 1,
                    },
                };
                const bufferInfo = (0,twgl_js__WEBPACK_IMPORTED_MODULE_0__.createBufferInfoFromArrays)(this.gl, arrays);
                const vertexArrayInfo = (0,twgl_js__WEBPACK_IMPORTED_MODULE_0__.createVertexArrayInfo)(this.gl, programInfo, bufferInfo);
                (0,twgl_js__WEBPACK_IMPORTED_MODULE_0__.setBuffersAndAttributes)(this.gl, programInfo, vertexArrayInfo);
                (0,twgl_js__WEBPACK_IMPORTED_MODULE_0__.drawBufferInfo)(this.gl, vertexArrayInfo, this.gl.TRIANGLES, vertexArrayInfo.numElements, 0, meshNodeInstances.length);
            });
        });
    }
    processNode(node, parentMatrix) {
        // Compute this node's matrix
        let matrix = node.localTransform.getMatrix();
        matrix = twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.multiply(parentMatrix, matrix);
        // Process self
        if (node instanceof _MeshNode__WEBPACK_IMPORTED_MODULE_1__["default"]) {
            const { shader } = node.material;
            if (!this.renderMap.has(shader)) {
                this.renderMap.set(shader, new Map());
            }
            const shaderMeshMap = this.renderMap.get(shader);
            if (!shaderMeshMap.has(node.mesh)) {
                shaderMeshMap.set(node.mesh, new Array());
            }
            const meshNodeInstances = shaderMeshMap.get(node.mesh);
            meshNodeInstances.push({ node, matrix });
        }
        // if (node instanceof MeshNode) {
        //   // Get the mesh's buffer info
        //   const bufferInfo = node.mesh.getBufferInfo(this.gl);
        //   const programInfo = node.material.shader.getProgramInfo(this.gl);
        //   this.gl.useProgram(programInfo.program);
        //   setBuffersAndAttributes(this.gl, programInfo, bufferInfo);
        //   // Compute matrix
        //   const cameraMatrix = this.camera.getViewProjectionMatrix();
        //   const projectedMatrix = m4.multiply(this.camera.getViewProjectionMatrix(), matrix);
        //   const eyePosition = m4.inverse(this.camera.getViewMatrix()).slice(12, 15);
        //   // Set all uniforms
        //   setUniforms(programInfo, [
        //     this.rendererUniforms,
        //     node.material.uniforms,
        //     {
        //       u_eyePosition: eyePosition,
        //       u_cameraMatrix: cameraMatrix,
        //     },
        //   ]);
        //   // Render
        //   drawBufferInfo(this.gl, bufferInfo);
        // }
        // Process all children
        node.getChildren().forEach((child) => this.processNode(child, matrix));
    }
    addUpdateCallback(callback) {
        this.updateCallbacks.add(callback);
    }
    removeUpdateCallback(callback) {
        if (!this.updateCallbacks.has(callback)) {
            return false;
        }
        this.updateCallbacks.delete(callback);
        return true;
    }
    preRender(deltaTime) {
        this.updateCallbacks.forEach((callback) => callback(deltaTime));
    }
    render(time) {
        const deltaTime = this.previousTime ? time - this.previousTime : 0;
        const startTime = performance.now();
        this.preRender(deltaTime);
        (0,twgl_js__WEBPACK_IMPORTED_MODULE_0__.resizeCanvasToDisplaySize)(this.gl.canvas);
        this.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);
        this.gl.clear(this.gl.COLOR_BUFFER_BIT);
        this.drawScene(time);
        const endTime = performance.now();
        this.frameTime = endTime - startTime;
        this.previousTime = time;
        this.animationRequestId = requestAnimationFrame((newTime) => this.render(newTime));
    }
    stopRendering() {
        cancelAnimationFrame(this.animationRequestId);
    }
}


/***/ }),

/***/ 8899:
/*!*******************************!*\
  !*** ./src/renderer/Scene.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Scene)
/* harmony export */ });
/* harmony import */ var _SceneNode__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SceneNode */ 9011);

class Scene {
    root;
    constructor(root = new _SceneNode__WEBPACK_IMPORTED_MODULE_0__["default"]()) {
        this.root = root;
    }
    /**
       * Adds a node to the root node of this Scene.
       *
       * Lazy way of doing `scene.root.addChild()`.
       */
    addNode(node) {
        this.root.addChild(node);
    }
}


/***/ }),

/***/ 9011:
/*!***********************************!*\
  !*** ./src/renderer/SceneNode.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ SceneNode)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);
/* harmony import */ var _Transform__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Transform */ 6444);


/**
 * Base class for nodes that inhabit a {@link Scene}
 *
 * SceneNodes can have children of the same type, which forms the basis of a Scene Graph
 */
class SceneNode {
    // This node's transform is relative to its parent
    localTransform;
    name;
    // These are private because they shouldn't be modified by users.
    // Parent is set when adding children to nodes.
    parent;
    children;
    // Counter for the number of scene nodes created this session
    static sceneNodes = 0;
    constructor(name, localTransform = new _Transform__WEBPACK_IMPORTED_MODULE_1__["default"]()) {
        this.localTransform = localTransform;
        this.name = name ?? `sceneNode#${SceneNode.sceneNodes}`;
        this.children = new Set();
        SceneNode.sceneNodes += 1;
    }
    getParent() {
        return this.parent;
    }
    getChildren() {
        return this.children;
    }
    addChild(node) {
        if (node.parent) {
            node.parent.removeChild(node);
        }
        node.parent = this;
        this.children.add(node);
    }
    removeChild(node) {
        if (!this.children.has(node)) {
            return;
        }
        node.parent = null;
        this.children.delete(node);
    }
    removeSelf() {
        this.getParent().removeChild(this);
    }
    // Traverses to root if ancestor is null
    getAncestorPosition(ancestor) {
        const nodeStack = [];
        let node = this;
        // The root will always be found
        let ancestorFound = ancestor === null;
        while (node != null) {
            nodeStack.push(node);
            if (node === ancestor) {
                ancestorFound = true;
                break;
            }
            node = node.getParent();
        }
        if (!ancestorFound)
            return null;
        // The stack will always at least have 1
        let { position } = nodeStack.pop().localTransform;
        while (nodeStack.length > 0) {
            node = nodeStack.pop();
            position = twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.add(position, node.localTransform.position);
        }
        return position;
    }
    getWorldPosition() {
        return this.getAncestorPosition(null);
    }
}


/***/ }),

/***/ 938:
/*!********************************!*\
  !*** ./src/renderer/Shader.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Shader)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ 6470);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);


class Shader {
    static cache = new Map();
    vertexShader;
    fragmentShader;
    programInfo;
    constructor(vertexShader, fragmentShader) {
        this.vertexShader = vertexShader;
        this.fragmentShader = fragmentShader;
    }
    static async fromURLs(vertexShaderURL, fragmentShaderURL) {
        let request = await fetch(vertexShaderURL);
        if (!request.ok) {
            throw Error(`Couldn't fetch vertex shader from URL: ${vertexShaderURL}, Status: ${request.statusText}`);
        }
        const vertexShader = await request.text();
        request = await fetch(fragmentShaderURL);
        if (!request.ok) {
            throw Error(`Couldn't fetch fragment shader from URL: ${fragmentShaderURL}, Status: ${request.statusText}`);
        }
        const fragmentShader = await request.text();
        return new Shader(vertexShader, fragmentShader);
    }
    /**
     * Gets the ProgramInfo object created from the compilation of this Shader.
     * If the ProgramInfo hasn't been created yet, this will create and cache it.
     *
     * @param gl WebGL context
     * @returns Compiled shader linked to a program
     */
    getProgramInfo(gl) {
        if (!this.programInfo) {
            this.programInfo = (0,twgl_js__WEBPACK_IMPORTED_MODULE_0__.createProgramInfo)(gl, [this.vertexShader, this.fragmentShader]);
        }
        return this.programInfo;
    }
    static async load(url) {
        if (this.cache.has(url)) {
            return this.cache.get(url);
        }
        const configRequest = await fetch(url);
        const config = (await configRequest.json());
        const dir = path__WEBPACK_IMPORTED_MODULE_1__.dirname(url);
        const vertexShaderPath = path__WEBPACK_IMPORTED_MODULE_1__.resolve(dir, config.vertexShader);
        const fragmentShaderPath = path__WEBPACK_IMPORTED_MODULE_1__.resolve(dir, config.fragmentShader);
        const shader = await Shader.fromURLs(vertexShaderPath, fragmentShaderPath);
        this.cache.set(url, shader);
        return shader;
    }
}


/***/ }),

/***/ 9838:
/*!*********************************!*\
  !*** ./src/renderer/Texture.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Texture)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);

/**
 * A class for constructing a texuture and include it's data,
 * it uses the TextureLoader class from Three.js.
 */
class Texture {
    static cache = new Map();
    m_texture;
    constructor(context, url) {
        this.m_texture = twgl_js__WEBPACK_IMPORTED_MODULE_0__.createTexture(context, {
            src: url,
            flipY: 1,
            wrap: context.REPEAT,
            min: context.NEAREST_MIPMAP_LINEAR,
            mag: context.LINEAR,
        });
    }
    static async load(url) {
        if (this.cache.has(url)) {
            return this.cache.get(url);
        }
        // Hacky way of getting the context so we don't
        // have to pass it in to the load function
        const context = document.getElementsByTagName('canvas')[0].getContext('webgl2');
        const texture = new Texture(context, url);
        this.cache.set(url, texture);
        return texture;
    }
}


/***/ }),

/***/ 6444:
/*!***********************************!*\
  !*** ./src/renderer/Transform.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Transform)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);
/* harmony import */ var _util_Math__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Math */ 2835);


class Transform {
    position;
    // In radians
    rotation;
    scale;
    matrix;
    constructor(position = new Float32Array([0.0, 0.0, 0.0]), rotation = new Float32Array([0.0, 0.0, 0.0]), scale = new Float32Array([1.0, 1.0, 1.0])) {
        this.position = position;
        this.rotation = rotation;
        this.scale = scale;
    }
    /**
       * Uses TWGL m4 to multiply scale, rotation, and translation matrices
       * together to get the matrix representing this model's transform.
       *
       * The order of operations is important. We want the following formula:
       * Matrix = Translation * Rotation * Scale * Identity
       */
    getMatrix() {
        if (this.matrix) {
            return this.matrix;
        }
        const matrix = twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.identity();
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.scale(matrix, this.scale, matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.translate(matrix, this.position, matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateZ(matrix, this.rotation[2], matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateY(matrix, this.rotation[1], matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateX(matrix, this.rotation[0], matrix);
        this.matrix = matrix;
        return this.matrix;
    }
    getForwardVector() {
        const forward = twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.create(0, 0, -1);
        const matrix = twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.identity();
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateZ(matrix, this.rotation[2], matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateY(matrix, this.rotation[1], matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateX(matrix, this.rotation[0], matrix);
        return twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.transformDirection(matrix, forward);
    }
    getRightVector() {
        const right = twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.create(1, 0, 0);
        const matrix = twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.identity();
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateZ(matrix, this.rotation[2], matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateY(matrix, this.rotation[1], matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateX(matrix, this.rotation[0], matrix);
        return twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.transformDirection(matrix, right);
    }
    getUpVector() {
        const up = twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.create(0, 1, 0);
        const matrix = twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.identity();
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateZ(matrix, this.rotation[2], matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateY(matrix, this.rotation[1], matrix);
        twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.rotateX(matrix, this.rotation[0], matrix);
        return twgl_js__WEBPACK_IMPORTED_MODULE_0__.m4.transformDirection(matrix, up);
    }
    setRotationDeg(x, y, z) {
        this.rotation = [(0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toRadians)(x), (0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toRadians)(y), (0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toRadians)(z)];
    }
    setRotationRad(x, y, z) {
        this.rotation = [x, y, z];
    }
    getRotationRad() {
        return this.rotation;
    }
    getRotationDeg() {
        return [
            (0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toDegrees)(this.rotation[0]),
            (0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toDegrees)(this.rotation[1]),
            (0,_util_Math__WEBPACK_IMPORTED_MODULE_1__.toDegrees)(this.rotation[2]),
        ];
    }
}


/***/ }),

/***/ 1653:
/*!**************************************************!*\
  !*** ./src/renderer/materials/AlbedoMaterial.ts ***!
  \**************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "AlbedoMaterial": () => (/* binding */ AlbedoMaterial)
/* harmony export */ });
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ 6470);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _MaterialInternal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./_MaterialInternal */ 4143);
/* harmony import */ var _Shader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Shader */ 938);
/* harmony import */ var _Texture__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../Texture */ 9838);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__]);
_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];

// eslint-disable-next-line import/no-cycle



const shaderUrl = '/assets/shaders/albedo/shader.json';
const albedoShader = await _Shader__WEBPACK_IMPORTED_MODULE_2__["default"].load(shaderUrl);
// eslint-disable-next-line import/prefer-default-export
class AlbedoMaterial extends _MaterialInternal__WEBPACK_IMPORTED_MODULE_1__.Material {
    static type = 'AlbedoMaterial';
    texture;
    constructor(texture) {
        super(albedoShader, { u_texture: texture });
        this.setTexture(texture);
    }
    setTexture(texture) {
        this.texture = texture;
        this.uniforms.u_texture = texture.m_texture;
    }
    static async loadFromConfig(url, config) {
        const dir = path__WEBPACK_IMPORTED_MODULE_0__.dirname(url);
        const textureUrl = path__WEBPACK_IMPORTED_MODULE_0__.resolve(dir, config.texture);
        const texture = await _Texture__WEBPACK_IMPORTED_MODULE_3__["default"].load(textureUrl);
        return new AlbedoMaterial(texture);
    }
}
_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__.materialLoaderMap.set('AlbedoMaterial', AlbedoMaterial.loadFromConfig);

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 1265:
/*!*****************************************************!*\
  !*** ./src/renderer/materials/BaseColorMaterial.ts ***!
  \*****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "BaseColorMaterial": () => (/* binding */ BaseColorMaterial)
/* harmony export */ });
/* harmony import */ var twgl_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! twgl.js */ 3141);
/* harmony import */ var _MaterialInternal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./_MaterialInternal */ 4143);
/* harmony import */ var _Shader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Shader */ 938);
/* harmony import */ var _Color__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../Color */ 6110);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__]);
_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];

// eslint-disable-next-line import/no-cycle



const shaderUrl = '/assets/shaders/baseColor/shader.json';
const baseColorShader = await _Shader__WEBPACK_IMPORTED_MODULE_2__["default"].load(shaderUrl);
const DEFAULT_U_COLOR = twgl_js__WEBPACK_IMPORTED_MODULE_0__.v3.create(0.0, 0.0, 0.0);
// eslint-disable-next-line import/prefer-default-export
class BaseColorMaterial extends _MaterialInternal__WEBPACK_IMPORTED_MODULE_1__.Material {
    color;
    constructor(color) {
        super(baseColorShader, { u_color: DEFAULT_U_COLOR });
        this.setColor(color);
    }
    setColor(color) {
        this.color = color;
        this.uniforms.u_color = color.toVec3();
    }
    getColor() {
        return this.color;
    }
    static async loadFromConfig(url, config) {
        const color = _Color__WEBPACK_IMPORTED_MODULE_3__["default"].fromHex(config.color);
        return new BaseColorMaterial(color);
    }
}
_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__.materialLoaderMap.set('BaseColorMaterial', BaseColorMaterial.loadFromConfig);

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 6319:
/*!********************************************!*\
  !*** ./src/renderer/materials/Material.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "materialLoaderMap": () => (/* binding */ materialLoaderMap),
/* harmony export */   "Material": () => (/* binding */ Material)
/* harmony export */ });
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ 6470);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Shader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Shader */ 938);


const materialLoaderMap = new Map();
/**
 * Base class for a custom Material. Meant to be subclassed to create
 * tailored materials that are customized via a few exposed uniforms.
 */
class Material {
    static cache = new Map();
    static type = 'Material';
    shader;
    uniforms;
    constructor(shader, uniforms) {
        this.shader = shader;
        this.uniforms = uniforms;
    }
    getType() {
        return this.constructor.type;
    }
    static async load(url) {
        if (this.cache.has(url)) {
            return this.cache.get(url);
        }
        const configRequest = await fetch(url);
        const materialConfig = (await configRequest.json());
        if (!materialLoaderMap.has(materialConfig.type)) {
            throw new Error('No material loader found for given material type.');
        }
        const loaderFunction = materialLoaderMap.get(materialConfig.type);
        const material = await loaderFunction(url, materialConfig);
        this.cache.set(url, material);
        return material;
    }
    // Can't use ResourceSchema as config type here because it prevents
    // subclasses from using their own ResourceSchema type. >:(
    static async loadFromConfig(url, config) {
        const materialConfig = config;
        const dir = path__WEBPACK_IMPORTED_MODULE_0__.dirname(url);
        const shaderUrl = path__WEBPACK_IMPORTED_MODULE_0__.resolve(dir, materialConfig.shader);
        const shader = await _Shader__WEBPACK_IMPORTED_MODULE_1__["default"].load(shaderUrl);
        const { uniforms } = materialConfig;
        return new Material(shader, uniforms);
    }
}
materialLoaderMap.set('Material', Material.loadFromConfig);


/***/ }),

/***/ 3142:
/*!***********************************************!*\
  !*** ./src/renderer/materials/PBRMaterial.ts ***!
  \***********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PBRMaterial)
/* harmony export */ });
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ 6470);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _MaterialInternal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./_MaterialInternal */ 4143);
/* harmony import */ var _Shader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Shader */ 938);
/* harmony import */ var _Texture__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../Texture */ 9838);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__]);
_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];

// eslint-disable-next-line import/no-cycle



const PBRShader = await _Shader__WEBPACK_IMPORTED_MODULE_2__["default"].load('/assets/shaders/pbr/shader.json');
class PBRMaterial extends _MaterialInternal__WEBPACK_IMPORTED_MODULE_1__.Material {
    static type = 'PBRMaterial';
    albedo;
    normal;
    mrao;
    lightPositions;
    ligthColors;
    constructor(albedo, normal, mrao, pLightPos, pLightCols, dLightDir, dLightCol) {
        super(PBRShader, {
            u_albedo: albedo,
            u_normal: normal,
            u_mrao: mrao,
            u_dLightDirection: dLightDir,
            u_dLightColor: dLightCol,
            u_pLightPositions: pLightPos,
            u_pLightColors: pLightCols,
        });
        this.setAlbedo(albedo);
        this.setNormal(normal);
        this.setMrao(mrao);
        this.setLights(pLightPos, pLightCols);
    }
    setAlbedo(albedo) {
        this.albedo = albedo;
        this.uniforms.u_albedo = albedo.m_texture;
    }
    setNormal(normal) {
        this.normal = normal;
        this.uniforms.u_normal = normal.m_texture;
    }
    setMrao(mrao) {
        this.mrao = mrao;
        this.uniforms.u_mrao = mrao.m_texture;
    }
    setLights(lightPos, lightCols) {
        this.lightPositions = lightPos;
        this.uniforms.u_pLightPositions = lightPos;
        this.ligthColors = lightCols;
        this.uniforms.u_pLightColors = lightCols;
    }
    static async loadFromConfig(url, config) {
        const dir = path__WEBPACK_IMPORTED_MODULE_0__.dirname(url);
        const albedoUrl = path__WEBPACK_IMPORTED_MODULE_0__.resolve(dir, config.albedo);
        const albedo = await _Texture__WEBPACK_IMPORTED_MODULE_3__["default"].load(albedoUrl);
        const normalUrl = path__WEBPACK_IMPORTED_MODULE_0__.resolve(dir, config.normal);
        const normal = await _Texture__WEBPACK_IMPORTED_MODULE_3__["default"].load(normalUrl);
        const mraoUrl = path__WEBPACK_IMPORTED_MODULE_0__.resolve(dir, config.mrao);
        const mrao = await _Texture__WEBPACK_IMPORTED_MODULE_3__["default"].load(mraoUrl);
        const sceneLightingPath = '/assets/lighting.json';
        const configRequest = await fetch(sceneLightingPath);
        const sceneLightingConfig = (await configRequest.json());
        const { pLightPositions, pLightColors, dLightDirection, dLightColor, } = sceneLightingConfig;
        return new PBRMaterial(albedo, normal, mrao, pLightPositions, pLightColors, dLightDirection, dLightColor);
    }
}
_MaterialInternal__WEBPACK_IMPORTED_MODULE_1__.materialLoaderMap.set('PBRMaterial', PBRMaterial.loadFromConfig);

__webpack_handle_async_dependencies__();
}, 1);

/***/ }),

/***/ 4143:
/*!*****************************************************!*\
  !*** ./src/renderer/materials/_MaterialInternal.ts ***!
  \*****************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Material": () => (/* reexport safe */ _Material__WEBPACK_IMPORTED_MODULE_0__.Material),
/* harmony export */   "materialLoaderMap": () => (/* reexport safe */ _Material__WEBPACK_IMPORTED_MODULE_0__.materialLoaderMap),
/* harmony export */   "AlbedoMaterial": () => (/* reexport safe */ _AlbedoMaterial__WEBPACK_IMPORTED_MODULE_1__.AlbedoMaterial),
/* harmony export */   "BaseColorMaterial": () => (/* reexport safe */ _BaseColorMaterial__WEBPACK_IMPORTED_MODULE_2__.BaseColorMaterial)
/* harmony export */ });
/* harmony import */ var _Material__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Material */ 6319);
/* harmony import */ var _AlbedoMaterial__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./AlbedoMaterial */ 1653);
/* harmony import */ var _BaseColorMaterial__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./BaseColorMaterial */ 1265);
/* harmony import */ var _PBRMaterial__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./PBRMaterial */ 3142);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_PBRMaterial__WEBPACK_IMPORTED_MODULE_3__, _BaseColorMaterial__WEBPACK_IMPORTED_MODULE_2__, _AlbedoMaterial__WEBPACK_IMPORTED_MODULE_1__]);
([_PBRMaterial__WEBPACK_IMPORTED_MODULE_3__, _BaseColorMaterial__WEBPACK_IMPORTED_MODULE_2__, _AlbedoMaterial__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__);
/* eslint-disable import/no-cycle */
// See https://medium.com/visual-development/how-to-fix-nasty-circular-dependency-issues-once-and-for-all-in-javascript-typescript-a04c987cf0de
// for more information on this pattern





});

/***/ }),

/***/ 2550:
/*!***********************!*\
  !*** ./src/script.ts ***!
  \***********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _game_Game__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./game/Game */ 1611);
/* harmony import */ var _style_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./style.css */ 7654);
/* harmony import */ var _renderer_DebugUI__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./renderer/DebugUI */ 4281);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_game_Game__WEBPACK_IMPORTED_MODULE_0__]);
_game_Game__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];



(async () => {
    const appWrapper = document.getElementById('app');
    const canvas = document.getElementById('canvas');
    const gl = canvas.getContext('webgl2');
    // Create the game logic handler
    const game = new _game_Game__WEBPACK_IMPORTED_MODULE_0__["default"](gl);
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    const debugUI = new _renderer_DebugUI__WEBPACK_IMPORTED_MODULE_2__["default"](game.renderer, appWrapper);
    if (false) {}
})();

});

/***/ }),

/***/ 5944:
/*!**********************************!*\
  !*** ./src/ui/FrameTimePanel.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ FrameTimePanel)
/* harmony export */ });
class FrameTimePanel {
    static className = 'debug-panel';
    renderer;
    element;
    frameTimeUpdateIntervalId;
    constructor(renderer) {
        this.renderer = renderer;
        this.element = document.createElement('div');
        this.element.className = FrameTimePanel.className;
        // Update the frame time 30 times per second
        this.frameTimeUpdateIntervalId = setInterval(() => {
            const timeString = this.renderer.frameTime.toFixed(2).padStart(6);
            this.element.textContent = `Frame time: ${timeString} ms`;
        }, 30 / 1000);
        if (false) {}
    }
    cleanUp() {
        clearInterval(this.frameTimeUpdateIntervalId);
    }
}


/***/ }),

/***/ 7605:
/*!*************************************!*\
  !*** ./src/ui/game/ControlsPane.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ControlsPane)
/* harmony export */ });
const controls = [
    { label: 'W', action: 'Move forward' },
    { label: 'A', action: 'Move left' },
    { label: 'S', action: 'Move backward' },
    { label: 'D', action: 'Move right' },
    { label: 'Q', action: 'Attack adjacent tiles' },
    { label: 'I', action: 'Toggle inventory' },
    { label: '1-9', action: 'Use inventory slot item' },
    { label: 'M', action: 'Toggle Map' },
    { label: '.', action: 'Toggle debug mode' },
    { label: ',', action: 'Toggle free camera' },
    { label: 'h', action: 'Free camera move left' },
    { label: 'j', action: 'Free camera move backward' },
    { label: 'k', action: 'Free camera move forward' },
    { label: 'l', action: 'Free camera move right' },
    { label: '[', action: 'Free camera move down' },
    { label: ']', action: 'Free camera move up' },
    { label: '\\', action: 'Re-generate map (not recommended)' },
];
class ControlsPane extends HTMLElement {
    game;
    titleElement;
    statsElement;
    equippedWeaponElement;
    constructor(game) {
        super();
        this.game = game;
        this.className = 'game-pane';
        this.titleElement = ControlsPane.createTitleElement();
        this.appendChild(this.titleElement);
        const controlsElements = controls.map(({ label, action }) => {
            const element = document.createElement('div');
            element.innerHTML = `<strong>${label}:</strong> ${action}`;
            return element;
        });
        this.append(...controlsElements);
    }
    static createTitleElement() {
        const element = document.createElement('div');
        element.className = 'pane-title';
        element.innerText = 'Controls';
        return element;
    }
}
customElements.define('controls-pane', ControlsPane);


/***/ }),

/***/ 1291:
/*!************************************!*\
  !*** ./src/ui/game/GameLogPane.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ GameLogPane)
/* harmony export */ });
class GameLogPane extends HTMLElement {
    game;
    titleElement;
    messageElement;
    constructor(game) {
        super();
        this.game = game;
        this.classList.add('game-pane', 'game-log-pane');
        this.titleElement = GameLogPane.createTitleElement();
        this.appendChild(this.titleElement);
        this.messageElement = document.createElement('div');
        this.appendChild(this.messageElement);
    }
    static createTitleElement() {
        const element = document.createElement('div');
        element.className = 'pane-title';
        element.innerText = 'Game Log';
        return element;
    }
    update() {
        this.messageElement.innerText = this.game.message;
    }
}
customElements.define('game-log-pane', GameLogPane);


/***/ }),

/***/ 5439:
/*!**********************************!*\
  !*** ./src/ui/game/GamePanel.ts ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ GamePanel)
/* harmony export */ });
/* harmony import */ var _ControlsPane__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ControlsPane */ 7605);
/* harmony import */ var _GameLogPane__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./GameLogPane */ 1291);
/* harmony import */ var _InventoryPane__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./InventoryPane */ 3094);
/* harmony import */ var _PlayerPane__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./PlayerPane */ 8150);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_InventoryPane__WEBPACK_IMPORTED_MODULE_2__]);
_InventoryPane__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__)[0];




class GamePanel extends HTMLElement {
    game;
    playerPane;
    controlsPane;
    inventoryPane;
    gameLogPane;
    constructor(game) {
        super();
        this.game = game;
        this.playerPane = new _PlayerPane__WEBPACK_IMPORTED_MODULE_3__["default"](game);
        this.appendChild(this.playerPane);
        this.controlsPane = new _ControlsPane__WEBPACK_IMPORTED_MODULE_0__["default"](game);
        this.appendChild(this.controlsPane);
        this.inventoryPane = new _InventoryPane__WEBPACK_IMPORTED_MODULE_2__["default"](game);
        this.appendChild(this.inventoryPane);
        this.gameLogPane = new _GameLogPane__WEBPACK_IMPORTED_MODULE_1__["default"](game);
        this.appendChild(this.gameLogPane);
        // Mount self
        document.getElementById('app').appendChild(this);
        this.update();
        // if (module.hot) {
        //   module.hot.dispose(() => this.dispose());
        // }
    }
    update() {
        this.playerPane.update();
        this.inventoryPane.update();
        this.gameLogPane.update();
    }
}
customElements.define('game-panel', GamePanel);

});

/***/ }),

/***/ 3094:
/*!**************************************!*\
  !*** ./src/ui/game/InventoryPane.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.a(module, async (__webpack_handle_async_dependencies__) => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ InventoryPane)
/* harmony export */ });
/* harmony import */ var _game_entities_Item__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../game/entities/Item */ 3282);
/* harmony import */ var _game_entities_Weapon__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../game/entities/Weapon */ 2354);
/* harmony import */ var _game_Game__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../game/Game */ 1611);
var __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_game_Game__WEBPACK_IMPORTED_MODULE_2__, _game_entities_Item__WEBPACK_IMPORTED_MODULE_0__, _game_entities_Weapon__WEBPACK_IMPORTED_MODULE_1__]);
([_game_Game__WEBPACK_IMPORTED_MODULE_2__, _game_entities_Item__WEBPACK_IMPORTED_MODULE_0__, _game_entities_Weapon__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? await __webpack_async_dependencies__ : __webpack_async_dependencies__);
/* eslint-disable import/no-cycle */



class InventoryPane extends HTMLElement {
    game;
    titleElement;
    itemsWrapper;
    constructor(game) {
        super();
        this.game = game;
        this.className = 'game-pane';
        this.titleElement = InventoryPane.createTitleElement();
        this.appendChild(this.titleElement);
        this.itemsWrapper = document.createElement('div');
        this.appendChild(this.itemsWrapper);
        this.update();
    }
    static createTitleElement() {
        const element = document.createElement('div');
        element.className = 'pane-title';
        element.innerText = 'Inventory';
        return element;
    }
    createInventoryElements() {
        const inventoryElements = this.game.player.inventory.inventory.map((entity, index) => {
            const wrapperElement = document.createElement('div');
            wrapperElement.className = 'inventory-entity-wrapper';
            const labelElement = document.createElement('div');
            wrapperElement.appendChild(labelElement);
            const bodyElement = document.createElement('div');
            wrapperElement.appendChild(bodyElement);
            if (entity instanceof _game_entities_Weapon__WEBPACK_IMPORTED_MODULE_1__["default"]) {
                const weapon = entity;
                labelElement.innerHTML = `<strong>${index + 1}. (Weapon) ${weapon.name}</strong>`;
                bodyElement.innerText = `Damage: ${weapon.damage}, Skill Bonus: ${weapon.skillBonus}`;
            }
            else if (entity instanceof _game_entities_Item__WEBPACK_IMPORTED_MODULE_0__["default"]) {
                const item = entity;
                labelElement.innerHTML = `<strong>${index + 1}. (Item) ${item.name}`;
                bodyElement.innerText = `${item.description}`;
            }
            return wrapperElement;
        });
        return inventoryElements;
    }
    setVisibility(isVisible) {
        this.style.display = isVisible ? '' : 'none';
    }
    update() {
        this.setVisibility(this.game.state === _game_Game__WEBPACK_IMPORTED_MODULE_2__.GameState.INVENTORY);
        this.itemsWrapper.replaceChildren(...this.createInventoryElements());
    }
}
customElements.define('inventory-pane', InventoryPane);

});

/***/ }),

/***/ 7206:
/*!*************************************!*\
  !*** ./src/ui/game/MinimapPanel.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ MinimapPanel)
/* harmony export */ });
class MinimapPanel extends HTMLElement {
    game;
    static className = 'minimap-panel';
    frameTimeUpdateIntervalId;
    isVisible = true;
    constructor(game) {
        super();
        this.game = game;
        this.className = MinimapPanel.className;
        // mount self
        document.getElementById('app').appendChild(this);
        // Bind toggle keybind
        window.addEventListener('keydown', (ev) => {
            if (ev.key === 'm')
                this.toggleVisibility();
        });
        if (false) {}
    }
    toggleVisibility() {
        if (this.isVisible) {
            this.style.display = 'none';
            this.isVisible = false;
            return;
        }
        this.style.display = '';
        this.isVisible = true;
    }
    update() {
        const mapString = this.game.grid.stringRepresentation();
        this.innerText = mapString;
    }
}
customElements.define('minimap-panel', MinimapPanel);


/***/ }),

/***/ 8150:
/*!***********************************!*\
  !*** ./src/ui/game/PlayerPane.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PlayerPane)
/* harmony export */ });
class PlayerPane extends HTMLElement {
    game;
    titleElement;
    statsElement;
    equippedWeaponElement;
    constructor(game) {
        super();
        this.game = game;
        this.className = 'game-pane';
        this.titleElement = PlayerPane.createTitleElement();
        this.appendChild(this.titleElement);
        const statsLabel = document.createElement('div');
        statsLabel.innerHTML = '<strong>Stats:</strong>';
        this.appendChild(statsLabel);
        this.statsElement = PlayerPane.createStatsElement();
        this.appendChild(this.statsElement);
        const equippedWeaponLabel = document.createElement('div');
        equippedWeaponLabel.className = 'player-pane-equip-label';
        equippedWeaponLabel.innerHTML = '<strong>Equipped Weapon:</strong>';
        this.appendChild(equippedWeaponLabel);
        this.equippedWeaponElement = PlayerPane.createEquippedWeaponElement();
        this.appendChild(this.equippedWeaponElement);
    }
    static createTitleElement() {
        const element = document.createElement('div');
        element.className = 'pane-title';
        element.innerText = 'Player';
        return element;
    }
    static createStatsElement() {
        const element = document.createElement('div');
        element.className = 'player-pane-stats';
        return element;
    }
    static createEquippedWeaponElement() {
        const element = document.createElement('div');
        element.className = 'player-pane-equipped-weapon';
        return element;
    }
    update() {
        this.statsElement.innerText = `${this.game.player.stringRepresentation()}`;
        if (this.game.player.equippedWeapon) {
            this.equippedWeaponElement.innerText = this.game.player.equippedWeapon.stringRepresentation();
        }
        else {
            this.equippedWeaponElement.innerText = 'None';
        }
    }
}
customElements.define('player-pane', PlayerPane);


/***/ }),

/***/ 1985:
/*!******************************************!*\
  !*** ./src/ui/scene-panel/ScenePanel.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ScenePanel)
/* harmony export */ });
/* harmony import */ var _ScenePanelHeader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ScenePanelHeader */ 3019);
/* harmony import */ var _ScenePanelList__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ScenePanelList */ 3672);


class ScenePanel extends HTMLElement {
    renderer;
    header;
    list;
    constructor(renderer) {
        super();
        this.renderer = renderer;
        this.header = new _ScenePanelHeader__WEBPACK_IMPORTED_MODULE_0__["default"]();
        this.appendChild(this.header);
        this.list = new _ScenePanelList__WEBPACK_IMPORTED_MODULE_1__["default"](this.renderer.scene);
        this.appendChild(this.list);
    }
}
customElements.define('scene-panel', ScenePanel);


/***/ }),

/***/ 3019:
/*!************************************************!*\
  !*** ./src/ui/scene-panel/ScenePanelHeader.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ScenePanelHeader)
/* harmony export */ });
class ScenePanelHeader extends HTMLElement {
    constructor() {
        super();
        this.innerText = 'Scene Hierarchy';
    }
}
customElements.define('scene-panel-header', ScenePanelHeader);


/***/ }),

/***/ 3672:
/*!**********************************************!*\
  !*** ./src/ui/scene-panel/ScenePanelList.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ScenePanelList)
/* harmony export */ });
/* harmony import */ var _ScenePanelListNode__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ScenePanelListNode */ 4627);

class ScenePanelList extends HTMLElement {
    scene;
    constructor(scene) {
        super();
        this.scene = scene;
        this.updateList();
    }
    updateList() {
        const nodes = Array.from(this.scene.root.getChildren());
        nodes.forEach((node) => {
            this.appendChild(new _ScenePanelListNode__WEBPACK_IMPORTED_MODULE_0__["default"](node));
        });
    }
}
customElements.define('scene-panel-list', ScenePanelList);


/***/ }),

/***/ 4627:
/*!**************************************************!*\
  !*** ./src/ui/scene-panel/ScenePanelListNode.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ScenePanelListNode)
/* harmony export */ });
class ScenePanelListNode extends HTMLElement {
    level;
    sceneNode;
    wrapper;
    expandButton;
    childrenNodes;
    isOpen = false;
    constructor(sceneNode, level = 0) {
        super();
        this.sceneNode = sceneNode;
        this.level = level;
        this.style.paddingLeft = `${this.level * 0.5}rem`;
        this.wrapper = document.createElement('div');
        this.wrapper.className = 'node-wrapper';
        this.appendChild(this.wrapper);
        // Create collapsible button
        this.expandButton = document.createElement('div');
        this.expandButton.className = 'expand-button';
        if (sceneNode.getChildren().size > 0) {
            this.expandButton.innerText = '+';
            this.expandButton.addEventListener('click', () => {
                this.isOpen = !this.isOpen;
                this.update();
            });
        }
        else {
            this.expandButton.innerText = ' ';
        }
        this.wrapper.append(this.expandButton);
        // Create label
        const label = document.createElement('div');
        label.innerText = `${this.sceneNode.name} : ${this.sceneNode.constructor.name}`;
        this.wrapper.append(label);
        if (false) {}
    }
    update() {
        this.expandButton.innerText = this.isOpen ? '-' : '+';
        // Create children wrapper
        if (this.isOpen) {
            const nodes = Array.from(this.sceneNode.getChildren());
            this.childrenNodes = nodes.map((node) => new ScenePanelListNode(node, this.level + 1));
            this.append(...this.childrenNodes);
        }
        else {
            this.replaceChildren(this.wrapper);
        }
    }
}
customElements.define('scene-panel-list-node', ScenePanelListNode);


/***/ }),

/***/ 2835:
/*!**************************!*\
  !*** ./src/util/Math.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "toRadians": () => (/* binding */ toRadians),
/* harmony export */   "toDegrees": () => (/* binding */ toDegrees)
/* harmony export */ });
function toRadians(degrees) {
    return degrees * (Math.PI / 180.0);
}
function toDegrees(radians) {
    return radians * (180 / Math.PI);
}


/***/ })

},
/******/ __webpack_require__ => { // webpackRuntimeModules
/******/ var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
/******/ __webpack_require__.O(0, ["vendors"], () => (__webpack_exec__(2550)));
/******/ var __webpack_exports__ = __webpack_require__.O();
/******/ }
]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Ozs7QUNGNkI7QUFDZDtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSw4Q0FBUztBQUN4QjtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQ3hEa0Q7QUFDSTtBQUN2QztBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksS0FBVSxFQUFFLEVBS2Y7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLDBEQUFjO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGtFQUFVO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQ25Fc0Q7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDakRrRDtBQUNKO0FBQy9CO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHlEQUFnQjtBQUMxQztBQUNBLHdCQUF3Qix1REFBYztBQUN0QztBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FDZmU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUNOc0Q7QUFDdkM7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsMkRBQWtCO0FBQ25ELFNBQVM7QUFDVDtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztBQ2ZlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsaUJBQWlCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIscUJBQXFCLElBQUksZ0NBQWdDO0FBQ3RGO0FBQ0EsWUFBWSxLQUFVLEVBQUUsRUFFZjtBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQ2xETztBQUNQO0FBQ0E7QUFDTztBQUNQO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvc3R5bGUuY3NzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9zdHlsZS5jc3M/NzE2MyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvZ2FtZS9DYW1lcmFDb250cm9sbGVyLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9nYW1lL0R1bmdlb24udHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL2dhbWUvR2FtZS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvZ2FtZS9HcmlkLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9nYW1lL0ludmVudG9yeS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvZ2FtZS9LZXlMaXN0ZW5lci50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvZ2FtZS9lbnRpdGllcy9FbmVteS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvZ2FtZS9lbnRpdGllcy9FbnRpdHkudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL2dhbWUvZW50aXRpZXMvSXRlbS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvZ2FtZS9lbnRpdGllcy9QbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL2dhbWUvZW50aXRpZXMvV2VhcG9uLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9nYW1lL3RpbGVzL0Zsb29yVGlsZS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvZ2FtZS90aWxlcy9UaWxlLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9nYW1lL3RpbGVzL1dhbGxUaWxlLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9yZW5kZXJlci9DYW1lcmEudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL3JlbmRlcmVyL0NvbG9yLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9yZW5kZXJlci9EZWJ1Z1VJLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9yZW5kZXJlci9NZXNoLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9yZW5kZXJlci9NZXNoTm9kZS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvcmVuZGVyZXIvTW9kZWwudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL3JlbmRlcmVyL01vZGVsTm9kZS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvcmVuZGVyZXIvUGVyc3BlY3RpdmVDYW1lcmEudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL3JlbmRlcmVyL1JlbmRlcmVyLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9yZW5kZXJlci9TY2VuZS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvcmVuZGVyZXIvU2NlbmVOb2RlLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9yZW5kZXJlci9TaGFkZXIudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL3JlbmRlcmVyL1RleHR1cmUudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL3JlbmRlcmVyL1RyYW5zZm9ybS50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvcmVuZGVyZXIvbWF0ZXJpYWxzL0FsYmVkb01hdGVyaWFsLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9yZW5kZXJlci9tYXRlcmlhbHMvQmFzZUNvbG9yTWF0ZXJpYWwudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL3JlbmRlcmVyL21hdGVyaWFscy9NYXRlcmlhbC50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvcmVuZGVyZXIvbWF0ZXJpYWxzL1BCUk1hdGVyaWFsLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy9yZW5kZXJlci9tYXRlcmlhbHMvX01hdGVyaWFsSW50ZXJuYWwudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL3NjcmlwdC50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvdWkvRnJhbWVUaW1lUGFuZWwudHMiLCJ3ZWJwYWNrOi8vcm9ndWU0NzIwLy4vc3JjL3VpL2dhbWUvQ29udHJvbHNQYW5lLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy91aS9nYW1lL0dhbWVMb2dQYW5lLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy91aS9nYW1lL0dhbWVQYW5lbC50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvdWkvZ2FtZS9JbnZlbnRvcnlQYW5lLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy91aS9nYW1lL01pbmltYXBQYW5lbC50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvdWkvZ2FtZS9QbGF5ZXJQYW5lLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy91aS9zY2VuZS1wYW5lbC9TY2VuZVBhbmVsLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy91aS9zY2VuZS1wYW5lbC9TY2VuZVBhbmVsSGVhZGVyLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy91aS9zY2VuZS1wYW5lbC9TY2VuZVBhbmVsTGlzdC50cyIsIndlYnBhY2s6Ly9yb2d1ZTQ3MjAvLi9zcmMvdWkvc2NlbmUtcGFuZWwvU2NlbmVQYW5lbExpc3ROb2RlLnRzIiwid2VicGFjazovL3JvZ3VlNDcyMC8uL3NyYy91dGlsL01hdGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0c1xuaW1wb3J0IF9fX0NTU19MT0FERVJfQVBJX1NPVVJDRU1BUF9JTVBPUlRfX18gZnJvbSBcIi4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9zb3VyY2VNYXBzLmpzXCI7XG5pbXBvcnQgX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fIGZyb20gXCIuLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvYXBpLmpzXCI7XG52YXIgX19fQ1NTX0xPQURFUl9FWFBPUlRfX18gPSBfX19DU1NfTE9BREVSX0FQSV9JTVBPUlRfX18oX19fQ1NTX0xPQURFUl9BUElfU09VUkNFTUFQX0lNUE9SVF9fXyk7XG4vLyBNb2R1bGVcbl9fX0NTU19MT0FERVJfRVhQT1JUX19fLnB1c2goW21vZHVsZS5pZCwgXCJodG1sLCBib2R5IHsgXFxyXFxuICAgIGhlaWdodDogMTAwJTtcXHJcXG4gICAgbWFyZ2luOiAwO1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBibGFjaztcXHJcXG4gICAgY29sb3I6IHdoaXRlO1xcclxcbiAgICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xcclxcbiAgICBmb250LXNpemU6IDFyZW07XFxyXFxufVxcclxcblxcclxcbiNhcHAge1xcclxcbiAgICBkaXNwbGF5OiBmbGV4O1xcclxcbiAgICBoZWlnaHQ6IDEwMCU7XFxyXFxufVxcclxcblxcclxcbiNjYW52YXMtY29udGFpbmVyIHtcXHJcXG4gICAgZmxleDogMTAgMTAgMTAwdnc7XFxyXFxuICAgIGRpc3BsYXk6IGZsZXg7XFxyXFxufVxcclxcblxcclxcbmNhbnZhcyB7XFxyXFxuICAgIHdpZHRoOiAxMDAlO1xcclxcbn1cXHJcXG5cXHJcXG5nYW1lLXBhbmVsIHtcXHJcXG4gICAgZGlzcGxheTogZmxleDtcXHJcXG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcXHJcXG4gICAgZmxleDogMiAyIDI1cmVtO1xcclxcbiAgICBvdmVyZmxvdy15OiBhdXRvO1xcclxcbn1cXHJcXG5cXHJcXG4uZ2FtZS1wYW5lIHtcXHJcXG4gICAgZGlzcGxheTogZmxleDtcXHJcXG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcXHJcXG4gICAgYm9yZGVyOiAxcHggc29saWQgd2hpdGU7XFxyXFxuICAgIHBhZGRpbmc6IC41cmVtO1xcclxcbiAgICBtYXJnaW46IC41cmVtIC41cmVtO1xcclxcbn1cXHJcXG5cXHJcXG4uZ2FtZS1sb2ctcGFuZSB7XFxyXFxuICAgIG1hcmdpbi10b3A6IGF1dG87XFxyXFxufVxcclxcblxcclxcbi5wYW5lLXRpdGxlIHtcXHJcXG4gICAgZm9udC1zaXplOiAxLjVyZW07XFxyXFxuICAgIHRleHQtYWxpZ246IGNlbnRlcjtcXHJcXG59XFxyXFxuXFxyXFxuLnBsYXllci1wYW5lLXN0YXRzIHtcXHJcXG4gICAgcGFkZGluZy1ib3R0b206IDAuNXJlbTtcXHJcXG59XFxyXFxuXFxyXFxuc2NlbmUtcGFuZWwge1xcclxcbiAgICBmbGV4OiAyNXJlbSAwIDA7XFxyXFxuICAgIG1heC13aWR0aDogMjVyZW07XFxyXFxuICAgIG92ZXJmbG93LXk6IHNjcm9sbDtcXHJcXG59XFxyXFxuXFxyXFxuc2NlbmUtcGFuZWwtaGVhZGVyIHtcXHJcXG4gICAgZGlzcGxheTogYmxvY2s7XFxyXFxuICAgIHRleHQtYWxpZ246IGNlbnRlcjtcXHJcXG4gICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHdoaXRlO1xcclxcbiAgICBwYWRkaW5nOiAwLjI1cmVtO1xcclxcbn1cXHJcXG5cXHJcXG5zY2VuZS1wYW5lbC1saXN0IHtcXHJcXG4gICAgZGlzcGxheTogYmxvY2s7XFxyXFxuICAgIG1hcmdpbjogMC41cmVtO1xcclxcbiAgICBvdmVyZmxvdzogYXV0bztcXHJcXG4gICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XFxyXFxufVxcclxcblxcclxcbnNjZW5lLXBhbmVsLWxpc3Qtbm9kZSB7IFxcclxcbiAgICBkaXNwbGF5OiBibG9jaztcXHJcXG59XFxyXFxuXFxyXFxuLm5vZGUtd3JhcHBlciB7IFxcclxcbiAgICB3aGl0ZS1zcGFjZTogbm93cmFwO1xcclxcbiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcXHJcXG4gICAgZGlzcGxheTogZmxleDtcXHJcXG59XFxyXFxuXFxyXFxuLmV4cGFuZC1idXR0b24geyBcXHJcXG4gICAgd2lkdGg6IDFyZW07XFxyXFxuICAgIHVzZXItc2VsZWN0OiBub25lO1xcclxcbiAgICBmbGV4LXNocmluazogMDtcXHJcXG59XFxyXFxuXFxyXFxuLmRlYnVnLXBhbmVsIHtcXHJcXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xcclxcbiAgICB3aGl0ZS1zcGFjZTogcHJlO1xcclxcbiAgICBib3R0b206IDVweDtcXHJcXG4gICAgbGVmdDogNXB4O1xcclxcbiAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDAsIDAsIDAuNSk7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4zKTtcXHJcXG4gICAgcGFkZGluZzogM3B4O1xcclxcbiAgICBjb2xvcjogcmdiKDAsIDI1NSwgMCk7XFxyXFxufVxcclxcblxcclxcbi5taW5pbWFwLXBhbmVsIHtcXHJcXG4gICAgZm9udC1zaXplOiAwLjc1cmVtO1xcclxcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XFxyXFxuICAgIHRvcDogNXB4O1xcclxcbiAgICBsZWZ0OiA1cHg7XFxyXFxuICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgMC43NSk7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC43KTtcXHJcXG4gICAgcGFkZGluZzogM3B4O1xcclxcbiAgICBjb2xvcjogcmdiKDI1NSwgMjU1LCAyNTUpO1xcclxcbn1cXHJcXG5cIiwgXCJcIix7XCJ2ZXJzaW9uXCI6MyxcInNvdXJjZXNcIjpbXCJ3ZWJwYWNrOi8vLi9zcmMvc3R5bGUuY3NzXCJdLFwibmFtZXNcIjpbXSxcIm1hcHBpbmdzXCI6XCJBQUFBO0lBQ0ksWUFBWTtJQUNaLFNBQVM7SUFDVCx1QkFBdUI7SUFDdkIsWUFBWTtJQUNaLHNCQUFzQjtJQUN0QixlQUFlO0FBQ25COztBQUVBO0lBQ0ksYUFBYTtJQUNiLFlBQVk7QUFDaEI7O0FBRUE7SUFDSSxpQkFBaUI7SUFDakIsYUFBYTtBQUNqQjs7QUFFQTtJQUNJLFdBQVc7QUFDZjs7QUFFQTtJQUNJLGFBQWE7SUFDYixzQkFBc0I7SUFDdEIsZUFBZTtJQUNmLGdCQUFnQjtBQUNwQjs7QUFFQTtJQUNJLGFBQWE7SUFDYixzQkFBc0I7SUFDdEIsdUJBQXVCO0lBQ3ZCLGNBQWM7SUFDZCxtQkFBbUI7QUFDdkI7O0FBRUE7SUFDSSxnQkFBZ0I7QUFDcEI7O0FBRUE7SUFDSSxpQkFBaUI7SUFDakIsa0JBQWtCO0FBQ3RCOztBQUVBO0lBQ0ksc0JBQXNCO0FBQzFCOztBQUVBO0lBQ0ksZUFBZTtJQUNmLGdCQUFnQjtJQUNoQixrQkFBa0I7QUFDdEI7O0FBRUE7SUFDSSxjQUFjO0lBQ2Qsa0JBQWtCO0lBQ2xCLDhCQUE4QjtJQUM5QixnQkFBZ0I7QUFDcEI7O0FBRUE7SUFDSSxjQUFjO0lBQ2QsY0FBYztJQUNkLGNBQWM7SUFDZCx1QkFBdUI7QUFDM0I7O0FBRUE7SUFDSSxjQUFjO0FBQ2xCOztBQUVBO0lBQ0ksbUJBQW1CO0lBQ25CLHVCQUF1QjtJQUN2QixhQUFhO0FBQ2pCOztBQUVBO0lBQ0ksV0FBVztJQUNYLGlCQUFpQjtJQUNqQixjQUFjO0FBQ2xCOztBQUVBO0lBQ0ksa0JBQWtCO0lBQ2xCLGdCQUFnQjtJQUNoQixXQUFXO0lBQ1gsU0FBUztJQUNULG9DQUFvQztJQUNwQyxvQ0FBb0M7SUFDcEMsWUFBWTtJQUNaLHFCQUFxQjtBQUN6Qjs7QUFFQTtJQUNJLGtCQUFrQjtJQUNsQixrQkFBa0I7SUFDbEIsUUFBUTtJQUNSLFNBQVM7SUFDVCxxQ0FBcUM7SUFDckMsb0NBQW9DO0lBQ3BDLFlBQVk7SUFDWix5QkFBeUI7QUFDN0JcIixcInNvdXJjZXNDb250ZW50XCI6W1wiaHRtbCwgYm9keSB7IFxcclxcbiAgICBoZWlnaHQ6IDEwMCU7XFxyXFxuICAgIG1hcmdpbjogMDtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7XFxyXFxuICAgIGNvbG9yOiB3aGl0ZTtcXHJcXG4gICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcXHJcXG4gICAgZm9udC1zaXplOiAxcmVtO1xcclxcbn1cXHJcXG5cXHJcXG4jYXBwIHtcXHJcXG4gICAgZGlzcGxheTogZmxleDtcXHJcXG4gICAgaGVpZ2h0OiAxMDAlO1xcclxcbn1cXHJcXG5cXHJcXG4jY2FudmFzLWNvbnRhaW5lciB7XFxyXFxuICAgIGZsZXg6IDEwIDEwIDEwMHZ3O1xcclxcbiAgICBkaXNwbGF5OiBmbGV4O1xcclxcbn1cXHJcXG5cXHJcXG5jYW52YXMge1xcclxcbiAgICB3aWR0aDogMTAwJTtcXHJcXG59XFxyXFxuXFxyXFxuZ2FtZS1wYW5lbCB7XFxyXFxuICAgIGRpc3BsYXk6IGZsZXg7XFxyXFxuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XFxyXFxuICAgIGZsZXg6IDIgMiAyNXJlbTtcXHJcXG4gICAgb3ZlcmZsb3cteTogYXV0bztcXHJcXG59XFxyXFxuXFxyXFxuLmdhbWUtcGFuZSB7XFxyXFxuICAgIGRpc3BsYXk6IGZsZXg7XFxyXFxuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XFxyXFxuICAgIGJvcmRlcjogMXB4IHNvbGlkIHdoaXRlO1xcclxcbiAgICBwYWRkaW5nOiAuNXJlbTtcXHJcXG4gICAgbWFyZ2luOiAuNXJlbSAuNXJlbTtcXHJcXG59XFxyXFxuXFxyXFxuLmdhbWUtbG9nLXBhbmUge1xcclxcbiAgICBtYXJnaW4tdG9wOiBhdXRvO1xcclxcbn1cXHJcXG5cXHJcXG4ucGFuZS10aXRsZSB7XFxyXFxuICAgIGZvbnQtc2l6ZTogMS41cmVtO1xcclxcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxyXFxufVxcclxcblxcclxcbi5wbGF5ZXItcGFuZS1zdGF0cyB7XFxyXFxuICAgIHBhZGRpbmctYm90dG9tOiAwLjVyZW07XFxyXFxufVxcclxcblxcclxcbnNjZW5lLXBhbmVsIHtcXHJcXG4gICAgZmxleDogMjVyZW0gMCAwO1xcclxcbiAgICBtYXgtd2lkdGg6IDI1cmVtO1xcclxcbiAgICBvdmVyZmxvdy15OiBzY3JvbGw7XFxyXFxufVxcclxcblxcclxcbnNjZW5lLXBhbmVsLWhlYWRlciB7XFxyXFxuICAgIGRpc3BsYXk6IGJsb2NrO1xcclxcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxyXFxuICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB3aGl0ZTtcXHJcXG4gICAgcGFkZGluZzogMC4yNXJlbTtcXHJcXG59XFxyXFxuXFxyXFxuc2NlbmUtcGFuZWwtbGlzdCB7XFxyXFxuICAgIGRpc3BsYXk6IGJsb2NrO1xcclxcbiAgICBtYXJnaW46IDAuNXJlbTtcXHJcXG4gICAgb3ZlcmZsb3c6IGF1dG87XFxyXFxuICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xcclxcbn1cXHJcXG5cXHJcXG5zY2VuZS1wYW5lbC1saXN0LW5vZGUgeyBcXHJcXG4gICAgZGlzcGxheTogYmxvY2s7XFxyXFxufVxcclxcblxcclxcbi5ub2RlLXdyYXBwZXIgeyBcXHJcXG4gICAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcXHJcXG4gICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XFxyXFxuICAgIGRpc3BsYXk6IGZsZXg7XFxyXFxufVxcclxcblxcclxcbi5leHBhbmQtYnV0dG9uIHsgXFxyXFxuICAgIHdpZHRoOiAxcmVtO1xcclxcbiAgICB1c2VyLXNlbGVjdDogbm9uZTtcXHJcXG4gICAgZmxleC1zaHJpbms6IDA7XFxyXFxufVxcclxcblxcclxcbi5kZWJ1Zy1wYW5lbCB7XFxyXFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXHJcXG4gICAgd2hpdGUtc3BhY2U6IHByZTtcXHJcXG4gICAgYm90dG9tOiA1cHg7XFxyXFxuICAgIGxlZnQ6IDVweDtcXHJcXG4gICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjUpO1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuMyk7XFxyXFxuICAgIHBhZGRpbmc6IDNweDtcXHJcXG4gICAgY29sb3I6IHJnYigwLCAyNTUsIDApO1xcclxcbn1cXHJcXG5cXHJcXG4ubWluaW1hcC1wYW5lbCB7XFxyXFxuICAgIGZvbnQtc2l6ZTogMC43NXJlbTtcXHJcXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xcclxcbiAgICB0b3A6IDVweDtcXHJcXG4gICAgbGVmdDogNXB4O1xcclxcbiAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDAsIDAsIDAuNzUpO1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNyk7XFxyXFxuICAgIHBhZGRpbmc6IDNweDtcXHJcXG4gICAgY29sb3I6IHJnYigyNTUsIDI1NSwgMjU1KTtcXHJcXG59XFxyXFxuXCJdLFwic291cmNlUm9vdFwiOlwiXCJ9XSk7XG4vLyBFeHBvcnRzXG5leHBvcnQgZGVmYXVsdCBfX19DU1NfTE9BREVSX0VYUE9SVF9fXztcbiIsIlxuICAgICAgaW1wb3J0IEFQSSBmcm9tIFwiIS4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luamVjdFN0eWxlc0ludG9TdHlsZVRhZy5qc1wiO1xuICAgICAgaW1wb3J0IGRvbUFQSSBmcm9tIFwiIS4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3N0eWxlRG9tQVBJLmpzXCI7XG4gICAgICBpbXBvcnQgaW5zZXJ0Rm4gZnJvbSBcIiEuLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRCeVNlbGVjdG9yLmpzXCI7XG4gICAgICBpbXBvcnQgc2V0QXR0cmlidXRlcyBmcm9tIFwiIS4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3NldEF0dHJpYnV0ZXNXaXRob3V0QXR0cmlidXRlcy5qc1wiO1xuICAgICAgaW1wb3J0IGluc2VydFN0eWxlRWxlbWVudCBmcm9tIFwiIS4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luc2VydFN0eWxlRWxlbWVudC5qc1wiO1xuICAgICAgaW1wb3J0IHN0eWxlVGFnVHJhbnNmb3JtRm4gZnJvbSBcIiEuLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZVRhZ1RyYW5zZm9ybS5qc1wiO1xuICAgICAgaW1wb3J0IGNvbnRlbnQsICogYXMgbmFtZWRFeHBvcnQgZnJvbSBcIiEhLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanMhLi9zdHlsZS5jc3NcIjtcbiAgICAgIFxuICAgICAgXG5cbnZhciBvcHRpb25zID0ge307XG5cbm9wdGlvbnMuc3R5bGVUYWdUcmFuc2Zvcm0gPSBzdHlsZVRhZ1RyYW5zZm9ybUZuO1xub3B0aW9ucy5zZXRBdHRyaWJ1dGVzID0gc2V0QXR0cmlidXRlcztcblxuICAgICAgb3B0aW9ucy5pbnNlcnQgPSBpbnNlcnRGbi5iaW5kKG51bGwsIFwiaGVhZFwiKTtcbiAgICBcbm9wdGlvbnMuZG9tQVBJID0gZG9tQVBJO1xub3B0aW9ucy5pbnNlcnRTdHlsZUVsZW1lbnQgPSBpbnNlcnRTdHlsZUVsZW1lbnQ7XG5cbnZhciB1cGRhdGUgPSBBUEkoY29udGVudCwgb3B0aW9ucyk7XG5cblxuXG5leHBvcnQgKiBmcm9tIFwiISEuLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL3N0eWxlLmNzc1wiO1xuICAgICAgIGV4cG9ydCBkZWZhdWx0IGNvbnRlbnQgJiYgY29udGVudC5sb2NhbHMgPyBjb250ZW50LmxvY2FscyA6IHVuZGVmaW5lZDtcbiIsImltcG9ydCB7IHYzIH0gZnJvbSAndHdnbC5qcyc7XG5pbXBvcnQgeyB0b1JhZGlhbnMgfSBmcm9tICcuLi91dGlsL01hdGgnO1xuaW1wb3J0IHsgS2V5UHJlc3NUeXBlIH0gZnJvbSAnLi9LZXlMaXN0ZW5lcic7XG5jb25zdCBLRVlfTUFQID0ge1xuICAgIG1vdmVtZW50OiB7XG4gICAgICAgIE51bXBhZDg6ICdmb3J3YXJkJyxcbiAgICAgICAgTnVtcGFkMjogJ2JhY2t3YXJkJyxcbiAgICAgICAgTnVtcGFkNDogJ2xlZnQnLFxuICAgICAgICBOdW1wYWQ2OiAncmlnaHQnLFxuICAgICAgICBOdW1wYWQ5OiAndXAnLFxuICAgICAgICBOdW1wYWQ3OiAnZG93bicsXG4gICAgICAgIGg6ICdsZWZ0JyxcbiAgICAgICAgajogJ2JhY2t3YXJkJyxcbiAgICAgICAgazogJ2ZvcndhcmQnLFxuICAgICAgICBsOiAncmlnaHQnLFxuICAgICAgICAnXSc6ICd1cCcsXG4gICAgICAgICdbJzogJ2Rvd24nLFxuICAgIH0sXG4gICAgbG9vazoge1xuICAgICAgICBBcnJvd1VwOiAndXAnLFxuICAgICAgICBBcnJvd0Rvd246ICdkb3duJyxcbiAgICAgICAgQXJyb3dMZWZ0OiAnbGVmdCcsXG4gICAgICAgIEFycm93UmlnaHQ6ICdyaWdodCcsXG4gICAgfSxcbn07XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYW1lcmFDb250cm9sbGVyIHtcbiAgICBjYW1lcmE7XG4gICAgbW92ZVNwZWVkO1xuICAgIGxvb2tTZW5zaXRpdml0eTtcbiAgICBhY3RpdmVJbnB1dHM7XG4gICAgc3RhdGljIGRlZmF1bHRJbnB1dHMgPSB7XG4gICAgICAgIG1vdmVtZW50OiB7XG4gICAgICAgICAgICB1cDogZmFsc2UsXG4gICAgICAgICAgICBkb3duOiBmYWxzZSxcbiAgICAgICAgICAgIGxlZnQ6IGZhbHNlLFxuICAgICAgICAgICAgcmlnaHQ6IGZhbHNlLFxuICAgICAgICAgICAgZm9yd2FyZDogZmFsc2UsXG4gICAgICAgICAgICBiYWNrd2FyZDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICAgIGxvb2s6IHtcbiAgICAgICAgICAgIHVwOiBmYWxzZSxcbiAgICAgICAgICAgIGRvd246IGZhbHNlLFxuICAgICAgICAgICAgbGVmdDogZmFsc2UsXG4gICAgICAgICAgICByaWdodDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdHJ1Y3RvcihjYW1lcmEsIFxuICAgIC8vIFVuaXRzIHBlciBzZWNvbmRcbiAgICBtb3ZlU3BlZWQgPSAxLjAsIFxuICAgIC8vIERlZ3JlZXMgcGVyIHNlY29uZFxuICAgIGxvb2tTZW5zaXRpdml0eSA9IHRvUmFkaWFucygxLjApLCBhY3RpdmVJbnB1dHMgPSBDYW1lcmFDb250cm9sbGVyLmRlZmF1bHRJbnB1dHMpIHtcbiAgICAgICAgdGhpcy5jYW1lcmEgPSBjYW1lcmE7XG4gICAgICAgIHRoaXMubW92ZVNwZWVkID0gbW92ZVNwZWVkO1xuICAgICAgICB0aGlzLmxvb2tTZW5zaXRpdml0eSA9IGxvb2tTZW5zaXRpdml0eTtcbiAgICAgICAgdGhpcy5hY3RpdmVJbnB1dHMgPSBhY3RpdmVJbnB1dHM7XG4gICAgfVxuICAgIHVwZGF0ZShkZWx0YVRpbWUpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coYENhbWVyYSBVcGRhdGU6ICR7dGhpcy5kaXJlY3Rpb24udG9TdHJpbmcoKX1gKTtcbiAgICAgICAgY29uc3QgbW92ZVZlY3RvciA9IHRoaXMuZ2V0TW92ZVZlY3RvcigpO1xuICAgICAgICBjb25zdCBtb3ZlRGlzdGFuY2UgPSB0aGlzLm1vdmVTcGVlZCAqIChkZWx0YVRpbWUgLyAxMDAwKTtcbiAgICAgICAgdGhpcy5tb3ZlKHYzLm11bFNjYWxhcihtb3ZlVmVjdG9yLCBtb3ZlRGlzdGFuY2UpKTtcbiAgICAgICAgY29uc3Qgcm90YXRpb25zID0gdGhpcy5nZXRSb3RhdGlvbnMoKTtcbiAgICAgICAgdGhpcy5yb3RhdGUocm90YXRpb25zKTtcbiAgICB9XG4gICAgYmluZEtleXMoa2V5TGlzdGVuZXIpIHtcbiAgICAgICAgLy8gQ2FtZXJhIG1vdmVtZW50IHdpdGggbnVtcGFkXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKEtFWV9NQVApLmZvckVhY2goKFtpbnB1dFR5cGUsIGlucHV0c10pID0+IHtcbiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGlucHV0cykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgICAgICAga2V5TGlzdGVuZXIuYWRkTGlzdGVuZXIoa2V5LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlSW5wdXRzW2lucHV0VHlwZV1bdmFsdWVdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBrZXlMaXN0ZW5lci5hZGRMaXN0ZW5lcihrZXksICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVJbnB1dHNbaW5wdXRUeXBlXVt2YWx1ZV0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LCBLZXlQcmVzc1R5cGUuVVApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBtb3ZlKHRyYW5zbGF0aW9uKSB7XG4gICAgICAgIGNvbnN0IHsgcG9zaXRpb24gfSA9IHRoaXMuY2FtZXJhLnRyYW5zZm9ybTtcbiAgICAgICAgdjMuYWRkKHBvc2l0aW9uLCB0cmFuc2xhdGlvbiwgcG9zaXRpb24pO1xuICAgIH1cbiAgICBtb3ZlVG8ocG9zaXRpb24pIHtcbiAgICAgICAgdGhpcy5jYW1lcmEudHJhbnNmb3JtLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgfVxuICAgIGdldE1vdmVWZWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IHsgdHJhbnNmb3JtIH0gPSB0aGlzLmNhbWVyYTtcbiAgICAgICAgY29uc3QgbW92ZVZlY3RvciA9IHYzLmNyZWF0ZSgwLCAwLCAwKTtcbiAgICAgICAgY29uc3QgeyBtb3ZlbWVudCB9ID0gdGhpcy5hY3RpdmVJbnB1dHM7XG4gICAgICAgIGlmIChtb3ZlbWVudC51cCkge1xuICAgICAgICAgICAgdjMuYWRkKG1vdmVWZWN0b3IsIHRyYW5zZm9ybS5nZXRVcFZlY3RvcigpLCBtb3ZlVmVjdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW92ZW1lbnQuZG93bikge1xuICAgICAgICAgICAgdjMuc3VidHJhY3QobW92ZVZlY3RvciwgdHJhbnNmb3JtLmdldFVwVmVjdG9yKCksIG1vdmVWZWN0b3IpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtb3ZlbWVudC5sZWZ0KSB7XG4gICAgICAgICAgICB2My5zdWJ0cmFjdChtb3ZlVmVjdG9yLCB0cmFuc2Zvcm0uZ2V0UmlnaHRWZWN0b3IoKSwgbW92ZVZlY3Rvcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vdmVtZW50LnJpZ2h0KSB7XG4gICAgICAgICAgICB2My5hZGQobW92ZVZlY3RvciwgdHJhbnNmb3JtLmdldFJpZ2h0VmVjdG9yKCksIG1vdmVWZWN0b3IpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtb3ZlbWVudC5mb3J3YXJkKSB7XG4gICAgICAgICAgICB2My5hZGQobW92ZVZlY3RvciwgdHJhbnNmb3JtLmdldEZvcndhcmRWZWN0b3IoKSwgbW92ZVZlY3Rvcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vdmVtZW50LmJhY2t3YXJkKSB7XG4gICAgICAgICAgICB2My5zdWJ0cmFjdChtb3ZlVmVjdG9yLCB0cmFuc2Zvcm0uZ2V0Rm9yd2FyZFZlY3RvcigpLCBtb3ZlVmVjdG9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbW92ZVZlY3RvcjtcbiAgICB9XG4gICAgcm90YXRlKHJvdGF0aW9ucykge1xuICAgICAgICBjb25zdCB7IHJvdGF0aW9uIH0gPSB0aGlzLmNhbWVyYS50cmFuc2Zvcm07XG4gICAgICAgIGNvbnN0IG1heFggPSB0b1JhZGlhbnMoOTApO1xuICAgICAgICBjb25zdCBtaW5YID0gdG9SYWRpYW5zKC05MCk7XG4gICAgICAgIHJvdGF0aW9uWzBdICs9IHJvdGF0aW9uc1swXTtcbiAgICAgICAgLy8gQ2xhbXAgWFxuICAgICAgICBpZiAocm90YXRpb25bMF0gPiBtYXhYKSB7XG4gICAgICAgICAgICByb3RhdGlvblswXSA9IG1heFg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocm90YXRpb25bMF0gPCBtaW5YKSB7XG4gICAgICAgICAgICByb3RhdGlvblswXSA9IG1pblg7XG4gICAgICAgIH1cbiAgICAgICAgcm90YXRpb25bMV0gKz0gcm90YXRpb25zWzFdO1xuICAgIH1cbiAgICBnZXRSb3RhdGlvbnMoKSB7XG4gICAgICAgIGxldCB4Um90YXRpb24gPSAwLjA7XG4gICAgICAgIGxldCB5Um90YXRpb24gPSAwLjA7XG4gICAgICAgIGNvbnN0IHsgbG9vayB9ID0gdGhpcy5hY3RpdmVJbnB1dHM7XG4gICAgICAgIGlmIChsb29rLnVwKSB7XG4gICAgICAgICAgICB4Um90YXRpb24gKz0gdGhpcy5sb29rU2Vuc2l0aXZpdHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvb2suZG93bikge1xuICAgICAgICAgICAgeFJvdGF0aW9uIC09IHRoaXMubG9va1NlbnNpdGl2aXR5O1xuICAgICAgICB9XG4gICAgICAgIGlmIChsb29rLmxlZnQpIHtcbiAgICAgICAgICAgIHlSb3RhdGlvbiArPSB0aGlzLmxvb2tTZW5zaXRpdml0eTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobG9vay5yaWdodCkge1xuICAgICAgICAgICAgeVJvdGF0aW9uIC09IHRoaXMubG9va1NlbnNpdGl2aXR5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbeFJvdGF0aW9uLCB5Um90YXRpb25dO1xuICAgIH1cbn1cbiIsImNvbnN0IE5VTV9JVEVNUyA9IDk7XG5jb25zdCBNQVBfRU1QVFkgPSAnLic7XG5jb25zdCBNQVBfV0FMTCA9ICd8JztcbmNvbnN0IE1BUF9QTEFZRVIgPSAnQCc7XG5jb25zdCBNQVBfV0VBUE9OID0gJ3cnO1xuY29uc3QgTUFQX0lURU0gPSAnaSc7XG5jb25zdCBNQVBfRU5FTVkgPSAnZSc7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEdW5nZW9uIHtcbiAgICBzdGF0aWMgZ2VuZXJhdGUoZHVuZ2VvbldpZHRoLCBkdW5nZW9uSGVpZ2h0LCBtaW5Sb29tU2l6ZSkge1xuICAgICAgICBjb25zdCBtYWluID0gbmV3IFJlY3QoMCwgMCwgZHVuZ2VvbkhlaWdodCAtIDEsIGR1bmdlb25XaWR0aCAtIDEpO1xuICAgICAgICAvLyBTcGxpdCB0aGUgZHVuZ2VvbiBpbnRvIHpvbmVzXG4gICAgICAgIGNvbnN0IHpvbmVzID0gRHVuZ2Vvbi5zcGxpdChtYWluLCBtaW5Sb29tU2l6ZSArIDIpO1xuICAgICAgICAvLyBDcmVhdGUgcm9vbXMgaW5zaWRlIGVhY2ggb2YgdGhlIHpvbmVzXG4gICAgICAgIGNvbnN0IHJvb21zID0gem9uZXMubWFwKCh6b25lKSA9PiBEdW5nZW9uLmNyZWF0ZVJvb20oem9uZSwgbWluUm9vbVNpemUpKTtcbiAgICAgICAgLy8gQ3JlYXRlIGhhbGx3YXlzIHRvIGNvbm5lY3Qgcm9vbXMgdG9nZXRoZXJcbiAgICAgICAgY29uc3QgeyBoYWxscywgY29ubmVjdGlvbnMgfSA9IER1bmdlb24uY3JlYXRlSGFsbHMoem9uZXMsIHJvb21zKTtcbiAgICAgICAgLy8gUmFuZG9tbHkgc2VsZWN0IGEgc3RhcnRpbmcgcm9vbSB0aGVuIGNhbGN1bGF0ZSB0aGUgZGlmZmljdWx0aWVzIG9mIGV2ZXJ5IG90aGVyIHJvb21cbiAgICAgICAgY29uc3Qgc3RhcnRSb29tID0gRHVuZ2Vvbi5yYW5kSW50KDAsIHJvb21zLmxlbmd0aCk7XG4gICAgICAgIGNvbnN0IGRpZmZpY3VsdGllcyA9IHJvb21zLm1hcCgoXykgPT4gOTk5KTtcbiAgICAgICAgZGlmZmljdWx0aWVzW3N0YXJ0Um9vbV0gPSAxO1xuICAgICAgICBmb3IgKGxldCBsb29wID0gMDsgbG9vcCA8IHJvb21zLmxlbmd0aDsgbG9vcCsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBjb25uID0gMDsgY29ubiA8IGNvbm5lY3Rpb25zLmxlbmd0aDsgY29ubisrKSB7XG4gICAgICAgICAgICAgICAgZGlmZmljdWx0aWVzW2Nvbm5lY3Rpb25zW2Nvbm5dLmJdID0gTWF0aC5taW4oZGlmZmljdWx0aWVzW2Nvbm5lY3Rpb25zW2Nvbm5dLmJdLCBkaWZmaWN1bHRpZXNbY29ubmVjdGlvbnNbY29ubl0uYV0gKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBHZW5lcmF0ZSB0aGUgaXRlbXMsIHdlYXBvbnMsIGFuZCBlbmVtaWVzXG4gICAgICAgIGNvbnN0IG1hcFBvaW50cyA9IER1bmdlb24uZmlsbFJvb21zKHJvb21zLCBkaWZmaWN1bHRpZXMsIHN0YXJ0Um9vbSk7XG4gICAgICAgIHJldHVybiBEdW5nZW9uLmNyZWF0ZU1hcChuZXcgUGFpcihkdW5nZW9uSGVpZ2h0LCBkdW5nZW9uV2lkdGgpLCByb29tcywgaGFsbHMsIG1hcFBvaW50cyk7XG4gICAgfVxuICAgIC8vIFNwbGl0IGEgem9uZSBpbnRvIHR3byBzbWFsbGVyIHpvbmVzLCB0aGVuIHJlY3Vyc2VcbiAgICBzdGF0aWMgc3BsaXQoem9uZSwgbWluWm9uZVNpemUpIHtcbiAgICAgICAgY29uc3Qgc21hbGxYID0gem9uZS54MiAtIHpvbmUueDEgPCAyICogbWluWm9uZVNpemU7XG4gICAgICAgIGNvbnN0IHNtYWxsWSA9IHpvbmUueTIgLSB6b25lLnkxIDwgMiAqIG1pblpvbmVTaXplO1xuICAgICAgICAvLyBJZiBhIHpvbmUgaXMgdG9vIHNtYWxsLCBkb24ndCBzcGxpdCBpdFxuICAgICAgICBpZiAoc21hbGxYICYmIHNtYWxsWSlcbiAgICAgICAgICAgIHJldHVybiBbem9uZV07XG4gICAgICAgIC8vIElmIGEgem9uZSBpcyB0b28gc21hbGwgaW4gb25lIGRpcmVjdGlvbiwgc3BsaXQgaXQgaW4gdGhlIG90aGVyIGRpcmVjdGlvblxuICAgICAgICBpZiAoc21hbGxYKVxuICAgICAgICAgICAgcmV0dXJuIER1bmdlb24uc3BsaXRZKHpvbmUsIG1pblpvbmVTaXplKTtcbiAgICAgICAgaWYgKHNtYWxsWSlcbiAgICAgICAgICAgIHJldHVybiBEdW5nZW9uLnNwbGl0WCh6b25lLCBtaW5ab25lU2l6ZSk7XG4gICAgICAgIC8vIElmIGEgem9uZSBpcyBiaWcgZW5vdWdoLCByYW5kb21seSBzcGxpdCBpdCBpbiB0aGUgWCBvciBZIGRpcmVjdGlvblxuICAgICAgICBpZiAoRHVuZ2Vvbi5yYW5kSW50KDAsIDIpID09IDApXG4gICAgICAgICAgICByZXR1cm4gRHVuZ2Vvbi5zcGxpdFkoem9uZSwgbWluWm9uZVNpemUpO1xuICAgICAgICByZXR1cm4gRHVuZ2Vvbi5zcGxpdFgoem9uZSwgbWluWm9uZVNpemUpO1xuICAgIH1cbiAgICAvLyBTcGxpdCBhIHpvbmUgaW4gdGhlIFggZGlyZWN0aW9uXG4gICAgc3RhdGljIHNwbGl0WCh6b25lLCBtaW5ab25lU2l6ZSkge1xuICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gc3BsaXQgcG9pbnRcbiAgICAgICAgY29uc3QgeFNwbGl0ID0gRHVuZ2Vvbi5yYW5kSW50KHpvbmUueDEgKyBtaW5ab25lU2l6ZSwgem9uZS54MiAtIG1pblpvbmVTaXplICsgMSk7XG4gICAgICAgIC8vIENyZWF0ZSBzdWItem9uZXNcbiAgICAgICAgY29uc3Qgem9uZUEgPSBuZXcgUmVjdCh6b25lLngxLCB6b25lLnkxLCB4U3BsaXQsIHpvbmUueTIpO1xuICAgICAgICBjb25zdCB6b25lQiA9IG5ldyBSZWN0KHhTcGxpdCwgem9uZS55MSwgem9uZS54Miwgem9uZS55Mik7XG4gICAgICAgIC8vIFJlY3Vyc2UgYW5kIGNvbWJpbmUgbGlzdHNcbiAgICAgICAgcmV0dXJuIFsuLi5EdW5nZW9uLnNwbGl0KHpvbmVBLCBtaW5ab25lU2l6ZSksIC4uLkR1bmdlb24uc3BsaXQoem9uZUIsIG1pblpvbmVTaXplKV07XG4gICAgfVxuICAgIC8vIFNwbGl0IGEgem9uZSBpbiB0aGUgWSBkaXJlY3Rpb25cbiAgICBzdGF0aWMgc3BsaXRZKHpvbmUsIG1pblpvbmVTaXplKSB7XG4gICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBzcGxpdCBwb2ludFxuICAgICAgICBjb25zdCB5U3BsaXQgPSBEdW5nZW9uLnJhbmRJbnQoem9uZS55MSArIG1pblpvbmVTaXplLCB6b25lLnkyIC0gbWluWm9uZVNpemUgKyAxKTtcbiAgICAgICAgLy8gQ3JlYXRlIHN1Yi16b25lc1xuICAgICAgICBjb25zdCB6b25lQSA9IG5ldyBSZWN0KHpvbmUueDEsIHpvbmUueTEsIHpvbmUueDIsIHlTcGxpdCk7XG4gICAgICAgIGNvbnN0IHpvbmVCID0gbmV3IFJlY3Qoem9uZS54MSwgeVNwbGl0LCB6b25lLngyLCB6b25lLnkyKTtcbiAgICAgICAgLy8gUmVjdXJzZSBhbmQgY29tYmluZSBsaXN0c1xuICAgICAgICByZXR1cm4gWy4uLkR1bmdlb24uc3BsaXQoem9uZUEsIG1pblpvbmVTaXplKSwgLi4uRHVuZ2Vvbi5zcGxpdCh6b25lQiwgbWluWm9uZVNpemUpXTtcbiAgICB9XG4gICAgLy8gQ3JlYXRlIGEgcm9vbSBpbnNpZGUgb2YgYSB6b25lXG4gICAgc3RhdGljIGNyZWF0ZVJvb20oem9uZSwgbWluUm9vbVNpemUpIHtcbiAgICAgICAgbGV0IHgxID0gMDtcbiAgICAgICAgbGV0IHgyID0gMDtcbiAgICAgICAgbGV0IHkxID0gMDtcbiAgICAgICAgbGV0IHkyID0gMDtcbiAgICAgICAgLy8gUmFuZG9tbHkgZ2VuZXJhdGUgdHdvIHZhbGlkIHBvaW50cyBpbnNpZGUgb2YgdGhlIHpvbmVcbiAgICAgICAgLy8gVGhlIHBvaW50cyBtdXN0IGhhdmUgeDEgPCB4MiwgeTEgPCB5MiwgYW5kIGhhdmUgYSBzaWRlIGxlbmd0aCBvZiBhdCBsZWFzdCBtaW5Sb29tU2l6ZVxuICAgICAgICB3aGlsZSAoeDIgLSB4MSA8IG1pblJvb21TaXplIHx8IHkyIC0geTEgPCBtaW5Sb29tU2l6ZSkge1xuICAgICAgICAgICAgeDEgPSBEdW5nZW9uLnJhbmRJbnQoem9uZS54MSArIDEsIHpvbmUueDIpO1xuICAgICAgICAgICAgeDIgPSBEdW5nZW9uLnJhbmRJbnQoem9uZS54MSArIDEsIHpvbmUueDIpO1xuICAgICAgICAgICAgeTEgPSBEdW5nZW9uLnJhbmRJbnQoem9uZS55MSArIDEsIHpvbmUueTIpO1xuICAgICAgICAgICAgeTIgPSBEdW5nZW9uLnJhbmRJbnQoem9uZS55MSArIDEsIHpvbmUueTIpO1xuICAgICAgICAgICAgaWYgKHgxID4geDIpXG4gICAgICAgICAgICAgICAgeDIgPSB4MTtcbiAgICAgICAgICAgIGlmICh5MSA+IHkyKVxuICAgICAgICAgICAgICAgIHkyID0geTE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBSZWN0KHgxLCB5MSwgeDIsIHkyKTtcbiAgICB9XG4gICAgc3RhdGljIGNyZWF0ZUhhbGxzKHpvbmVzLCByb29tcykge1xuICAgICAgICBjb25zdCBoYWxscyA9IFtdO1xuICAgICAgICBjb25zdCBjb25uZWN0aW9ucyA9IFtdO1xuICAgICAgICBjb25zdCBoYXNSaWdodCA9IFsuLi5BcnJheSh6b25lcy5sZW5ndGgpXS5tYXAoKHEpID0+IGZhbHNlKTtcbiAgICAgICAgY29uc3QgaGFzRG93biA9IFsuLi5BcnJheSh6b25lcy5sZW5ndGgpXS5tYXAoKHEpID0+IGZhbHNlKTtcbiAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGVhY2ggcGFpciBvZiB6b25lc1xuICAgICAgICBmb3IgKGxldCBmcm9tID0gMDsgZnJvbSA8IHpvbmVzLmxlbmd0aDsgZnJvbSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCB0byA9IDA7IHRvIDwgem9uZXMubGVuZ3RoOyB0bysrKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgZnJvbSByb29tIGFuZCB0byByb29tIHNoYXJlIGEgdmVydGljYWwgd2FsbFxuICAgICAgICAgICAgICAgIGlmICh6b25lc1tmcm9tXS54MiA9PSB6b25lc1t0b10ueDEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGludmFsaWQgc2l6ZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKHpvbmVzW3RvXS55MSA+PSByb29tc1tmcm9tXS55MilcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAocm9vbXNbdG9dLnkxID49IHpvbmVzW2Zyb21dLnkyKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJhbmRvbWx5IGNob29zZSBhY2Nlc3MgcG9pbnRzXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHkxID0gRHVuZ2Vvbi5yYW5kSW50KHJvb21zW2Zyb21dLnkxICsgMSwgcm9vbXNbZnJvbV0ueTIpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB5MiA9IER1bmdlb24ucmFuZEludChyb29tc1t0b10ueTEgKyAxLCByb29tc1t0b10ueTIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoeTEgPT0geTIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRyYXcgc3RyYWlnaHQgaGFsbHdheVxuICAgICAgICAgICAgICAgICAgICAgICAgaGFsbHMucHVzaChuZXcgUmVjdChyb29tc1tmcm9tXS54MiwgeTEsIHJvb21zW3RvXS54MSwgeTEpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRyYXcgemlnIHphZyBoYWxsd2F5XG4gICAgICAgICAgICAgICAgICAgICAgICBoYWxscy5wdXNoKG5ldyBSZWN0KHJvb21zW2Zyb21dLngyLCB5MSwgem9uZXNbZnJvbV0ueDIsIHkxKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYWxscy5wdXNoKG5ldyBSZWN0KHpvbmVzW2Zyb21dLngyLCBNYXRoLm1pbih5MSwgeTIpLCB6b25lc1tmcm9tXS54MiwgTWF0aC5tYXgoeTEsIHkyKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFsbHMucHVzaChuZXcgUmVjdCh6b25lc1tmcm9tXS54MiwgeTIsIHJvb21zW3RvXS54MSwgeTIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBtYXJrIGhhbGx3YXlcbiAgICAgICAgICAgICAgICAgICAgaGFzUmlnaHRbZnJvbV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9ucy5wdXNoKG5ldyBQYWlyKGZyb20sIHRvKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25zLnB1c2gobmV3IFBhaXIodG8sIGZyb20pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gSWYgZnJvbSByb29tIGFuZCB0byByb29tIHNoYXJlIGEgaG9yaXpvbnRhbCB3YWxsXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoem9uZXNbZnJvbV0ueTIgPT0gem9uZXNbdG9dLnkxKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBpbnZhbGlkIHNpemVzXG4gICAgICAgICAgICAgICAgICAgIGlmICh6b25lc1t0b10ueDEgPj0gcm9vbXNbZnJvbV0ueDIpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvb21zW3RvXS54MSA+PSB6b25lc1tmcm9tXS54MilcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAvLyByYW5kb21seSBjaG9vc2UgYWNjZXNzIHBvaW50c1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB4MSA9IER1bmdlb24ucmFuZEludChyb29tc1tmcm9tXS54MSArIDEsIHJvb21zW2Zyb21dLngyKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeDIgPSBEdW5nZW9uLnJhbmRJbnQocm9vbXNbdG9dLngxICsgMSwgcm9vbXNbdG9dLngyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHgxID09IHgyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkcmF3IHN0cmFpZ2h0IGhhbGx3YXlcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbGxzLnB1c2gobmV3IFJlY3QoeDEsIHJvb21zW2Zyb21dLnkyLCB4MSwgcm9vbXNbdG9dLnkxKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkcmF3IHppZyB6YWcgaGFsbHdheVxuICAgICAgICAgICAgICAgICAgICAgICAgaGFsbHMucHVzaChuZXcgUmVjdCh4MSwgcm9vbXNbZnJvbV0ueTIsIHgxLCB6b25lc1tmcm9tXS55MikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFsbHMucHVzaChuZXcgUmVjdChNYXRoLm1pbih4MSwgeDIpLCB6b25lc1tmcm9tXS55MiwgTWF0aC5tYXgoeDEsIHgyKSwgem9uZXNbZnJvbV0ueTIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbGxzLnB1c2gobmV3IFJlY3QoeDIsIHpvbmVzW3RvXS55MSwgeDIsIHJvb21zW3RvXS55MSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIG1hcmsgaGFsbHdheVxuICAgICAgICAgICAgICAgICAgICBoYXNEb3duW2Zyb21dID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbnMucHVzaChuZXcgUGFpcihmcm9tLCB0bykpO1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9ucy5wdXNoKG5ldyBQYWlyKHRvLCBmcm9tKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGhhbGxzLCBjb25uZWN0aW9ucyB9O1xuICAgIH1cbiAgICAvLyBGaWxsIHJvb21zIHdpdGggd2VhcG9ucywgaXRlbXMsIGFuZCBlbmVtaWVzXG4gICAgc3RhdGljIGZpbGxSb29tcyhyb29tcywgZGlmZmljdWx0aWVzLCBzdGFydFJvb20pIHtcbiAgICAgICAgbGV0IG1heERpZmZpY3VsdHkgPSAwO1xuICAgICAgICBmb3IgKGxldCBxID0gMDsgcSA8IGRpZmZpY3VsdGllcy5sZW5ndGg7IHErKykge1xuICAgICAgICAgICAgaWYgKGRpZmZpY3VsdGllc1txXSA+IG1heERpZmZpY3VsdHkpXG4gICAgICAgICAgICAgICAgbWF4RGlmZmljdWx0eSA9IGRpZmZpY3VsdGllc1txXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb29yZHMgPSBbXTtcbiAgICAgICAgbGV0IGl0ZW1zTGVmdCA9IE5VTV9JVEVNUyAtIDE7XG4gICAgICAgIGNvbnN0IHdlYXBvbnMgPSBbXTtcbiAgICAgICAgY29uc3QgaXRlbXMgPSBbXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgYSBjb29yZGluYXRlIGlzIGZyZWUgdG8gdXNlXG4gICAgICAgIGZ1bmN0aW9uIGNoZWNrKHgsIHkpIHtcbiAgICAgICAgICAgIGZvciAobGV0IHEgPSAwOyBxIDwgY29vcmRzLmxlbmd0aDsgcSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvb3Jkc1txXS54ID09IHggJiYgY29vcmRzW3FdLnkgPT0geSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gR2VuZXJhdGUgYSByYW5kb20gY29vcmRpbmF0ZSBpbiBhIHJvb21cbiAgICAgICAgZnVuY3Rpb24gcmFuZG9tQ29vcmQocm9vbSkge1xuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB4ID0gRHVuZ2Vvbi5yYW5kSW50KHJvb20ueDEgKyAxLCByb29tLngyKTtcbiAgICAgICAgICAgICAgICBjb25zdCB5ID0gRHVuZ2Vvbi5yYW5kSW50KHJvb20ueTEgKyAxLCByb29tLnkyKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hlY2soeCwgeSkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUG9pbnQoeCwgeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gR2VuZXJhdGUgc3Bhd24gcm9vbVxuICAgICAgICBjb25zdCBzcGF3biA9IHJhbmRvbUNvb3JkKHJvb21zW3N0YXJ0Um9vbV0pO1xuICAgICAgICBjb29yZHMucHVzaChzcGF3bik7XG4gICAgICAgIC8vIEFkZCB3ZWFwb24gdG8gc3Bhd24gcm9vbVxuICAgICAgICBjb25zdCBjID0gcmFuZG9tQ29vcmQocm9vbXNbc3RhcnRSb29tXSk7XG4gICAgICAgIGNvb3Jkcy5wdXNoKGMpO1xuICAgICAgICB3ZWFwb25zLnB1c2goYyk7XG4gICAgICAgIC8vIEdlbmVyYXRlIGVuZW1pZXNcbiAgICAgICAgY29uc3QgZW5lbWllcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCByb29tID0gMDsgcm9vbSA8IHJvb21zLmxlbmd0aDsgcm9vbSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBlbmVteSA9IDA7IGVuZW15IDwgZGlmZmljdWx0aWVzW3Jvb21dOyBlbmVteSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYyA9IHJhbmRvbUNvb3JkKHJvb21zW3Jvb21dKTtcbiAgICAgICAgICAgICAgICBjb29yZHMucHVzaChjKTtcbiAgICAgICAgICAgICAgICBlbmVtaWVzLnB1c2goYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gR2VuZXJhdGUgaXRlbXNcbiAgICAgICAgbG9vcDogd2hpbGUgKGl0ZW1zTGVmdCA+IDApIHtcbiAgICAgICAgICAgIGZvciAobGV0IGRpZmZpY3VsdHkgPSAyOyBkaWZmaWN1bHR5IDw9IG1heERpZmZpY3VsdHk7IGRpZmZpY3VsdHkrKykge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IHJvb20gPSAwOyByb29tIDwgcm9vbXMubGVuZ3RoOyByb29tKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmZpY3VsdGllc1tyb29tXSAhPSBkaWZmaWN1bHR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc0xlZnQgPD0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGxvb3A7XG4gICAgICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHdlYXBvbiBvciBpdGVtXG4gICAgICAgICAgICAgICAgICAgIGlmIChEdW5nZW9uLnJhbmRJbnQoMCwgZGlmZmljdWx0eSkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNMZWZ0LS07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0gcmFuZG9tQ29vcmQocm9vbXNbcm9vbV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRzLnB1c2goYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAoRHVuZ2Vvbi5yYW5kSW50KDAsIDIpID8gd2VhcG9ucyA6IGl0ZW1zKS5wdXNoKGMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3ZWFwb25zLCBpdGVtcywgZW5lbWllcywgc3Bhd24sXG4gICAgICAgIH07XG4gICAgfVxuICAgIHN0YXRpYyBjcmVhdGVNYXAoZHVuZ2VvblNpemUsIHJvb21zLCBoYWxscywgbWFwUG9pbnRzKSB7XG4gICAgICAgIGNvbnN0IG1hcCA9IFsuLi5BcnJheShkdW5nZW9uU2l6ZS5hICsgMSldLm1hcCgocSkgPT4gWy4uLkFycmF5KGR1bmdlb25TaXplLmIgKyAxKV0ubWFwKCh3KSA9PiBNQVBfV0FMTCkpO1xuICAgICAgICAvLyBGaWxsIHJvb21zIHdpdGggZW1wdHkgc3BhY2VcbiAgICAgICAgZm9yIChsZXQgcm9vbSA9IDA7IHJvb20gPCByb29tcy5sZW5ndGg7IHJvb20rKykge1xuICAgICAgICAgICAgZm9yIChsZXQgeCA9IHJvb21zW3Jvb21dLngxICsgMTsgeCA8IHJvb21zW3Jvb21dLngyOyB4KyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gcm9vbXNbcm9vbV0ueTEgKyAxOyB5IDwgcm9vbXNbcm9vbV0ueTI7IHkrKykge1xuICAgICAgICAgICAgICAgICAgICBtYXBbeF1beV0gPSBNQVBfRU1QVFk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEZpbGwgaGFsbHMgd2l0aCBlbXB0eSBzcGFjZVxuICAgICAgICBmb3IgKGxldCBoYWxsID0gMDsgaGFsbCA8IGhhbGxzLmxlbmd0aDsgaGFsbCsrKSB7XG4gICAgICAgICAgICBpZiAoaGFsbHNbaGFsbF0ueDEgPT0gaGFsbHNbaGFsbF0ueDIpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gaGFsbHNbaGFsbF0ueTE7IHkgPD0gaGFsbHNbaGFsbF0ueTI7IHkrKykge1xuICAgICAgICAgICAgICAgICAgICBtYXBbaGFsbHNbaGFsbF0ueDFdW3ldID0gTUFQX0VNUFRZO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSBoYWxsc1toYWxsXS54MTsgeCA8PSBoYWxsc1toYWxsXS54MjsgeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hcFt4XVtoYWxsc1toYWxsXS55MV0gPSBNQVBfRU1QVFk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIERyYXcgcGxheWVyIHBvc2l0aW9uXG4gICAgICAgIG1hcFttYXBQb2ludHMuc3Bhd24ueF1bbWFwUG9pbnRzLnNwYXduLnldID0gTUFQX1BMQVlFUjtcbiAgICAgICAgLy8gRHJhdyB3ZWFwb25zXG4gICAgICAgIGZvciAobGV0IHdlYXBvbiA9IDA7IHdlYXBvbiA8IG1hcFBvaW50cy53ZWFwb25zLmxlbmd0aDsgd2VhcG9uKyspIHtcbiAgICAgICAgICAgIG1hcFttYXBQb2ludHMud2VhcG9uc1t3ZWFwb25dLnhdW21hcFBvaW50cy53ZWFwb25zW3dlYXBvbl0ueV0gPSBNQVBfV0VBUE9OO1xuICAgICAgICB9XG4gICAgICAgIC8vIERyYXcgaXRlbXNcbiAgICAgICAgZm9yIChsZXQgaXRlbSA9IDA7IGl0ZW0gPCBtYXBQb2ludHMuaXRlbXMubGVuZ3RoOyBpdGVtKyspIHtcbiAgICAgICAgICAgIG1hcFttYXBQb2ludHMuaXRlbXNbaXRlbV0ueF1bbWFwUG9pbnRzLml0ZW1zW2l0ZW1dLnldID0gTUFQX0lURU07XG4gICAgICAgIH1cbiAgICAgICAgLy8gRHJhdyBlbmVtaWVzXG4gICAgICAgIGZvciAobGV0IGVtZW55ID0gMDsgZW1lbnkgPCBtYXBQb2ludHMuZW5lbWllcy5sZW5ndGg7IGVtZW55KyspIHtcbiAgICAgICAgICAgIG1hcFttYXBQb2ludHMuZW5lbWllc1tlbWVueV0ueF1bbWFwUG9pbnRzLmVuZW1pZXNbZW1lbnldLnldID0gTUFQX0VORU1ZO1xuICAgICAgICB9XG4gICAgICAgIC8vIFN0aXRjaCBtYXAgdG9nZXRoZXJcbiAgICAgICAgcmV0dXJuIG1hcC5tYXAoKHJvdykgPT4gcm93LmpvaW4oJycpKS5qb2luKCdcXG4nKTtcbiAgICB9XG4gICAgc3RhdGljIHJhbmRJbnQobWluLCBtYXgpIHtcbiAgICAgICAgaWYgKG1pbiA9PSBtYXgpXG4gICAgICAgICAgICByZXR1cm4gbWluO1xuICAgICAgICBpZiAobWluID4gbWF4KVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmFuZEludChtYXgsIG1pbik7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluKSkgKyBtaW47XG4gICAgfVxufVxuY2xhc3MgUmVjdCB7XG4gICAgeDE7XG4gICAgeTE7XG4gICAgeDI7XG4gICAgeTI7XG4gICAgYXJlYTtcbiAgICBjb25zdHJ1Y3Rvcih4MSwgeTEsIHgyLCB5Mikge1xuICAgICAgICB0aGlzLngxID0geDE7XG4gICAgICAgIHRoaXMueTEgPSB5MTtcbiAgICAgICAgdGhpcy54MiA9IHgyO1xuICAgICAgICB0aGlzLnkyID0geTI7XG4gICAgICAgIHRoaXMuYXJlYSA9ICh0aGlzLngyIC0gdGhpcy54MSkgKiAodGhpcy55MiAtIHRoaXMueTEpO1xuICAgIH1cbn1cbmNsYXNzIFBhaXIge1xuICAgIGE7XG4gICAgYjtcbiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7XG4gICAgICAgIHRoaXMuYSA9IGE7XG4gICAgICAgIHRoaXMuYiA9IGI7XG4gICAgfVxufVxuY2xhc3MgUG9pbnQge1xuICAgIHg7XG4gICAgeTtcbiAgICBjb25zdHJ1Y3Rvcih4LCB5KSB7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgdjMgfSBmcm9tICd0d2dsLmpzJztcbmltcG9ydCBLZXlMaXN0ZW5lciBmcm9tICcuL0tleUxpc3RlbmVyJztcbmltcG9ydCBHcmlkIGZyb20gJy4vR3JpZCc7XG5pbXBvcnQgRW5lbXkgZnJvbSAnLi9lbnRpdGllcy9FbmVteSc7XG5pbXBvcnQgV2VhcG9uIGZyb20gJy4vZW50aXRpZXMvV2VhcG9uJztcbmltcG9ydCBJdGVtIGZyb20gJy4vZW50aXRpZXMvSXRlbSc7XG5pbXBvcnQgUmVuZGVyZXIgZnJvbSAnLi4vcmVuZGVyZXIvUmVuZGVyZXInO1xuaW1wb3J0IFBlcnNwZWN0aXZlQ2FtZXJhIGZyb20gJy4uL3JlbmRlcmVyL1BlcnNwZWN0aXZlQ2FtZXJhJztcbmltcG9ydCBDYW1lcmFDb250cm9sbGVyIGZyb20gJy4vQ2FtZXJhQ29udHJvbGxlcic7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWN5Y2xlXG5pbXBvcnQgR2FtZVBhbmVsIGZyb20gJy4uL3VpL2dhbWUvR2FtZVBhbmVsJztcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tY3ljbGVcbmltcG9ydCBNaW5pbWFwUGFuZWwgZnJvbSAnLi4vdWkvZ2FtZS9NaW5pbWFwUGFuZWwnO1xuZXhwb3J0IHZhciBHYW1lU3RhdGU7XG4oZnVuY3Rpb24gKEdhbWVTdGF0ZSkge1xuICAgIEdhbWVTdGF0ZVtHYW1lU3RhdGVbXCJXQUxLSU5HXCJdID0gMF0gPSBcIldBTEtJTkdcIjtcbiAgICBHYW1lU3RhdGVbR2FtZVN0YXRlW1wiSU5WRU5UT1JZXCJdID0gMV0gPSBcIklOVkVOVE9SWVwiO1xufSkoR2FtZVN0YXRlIHx8IChHYW1lU3RhdGUgPSB7fSkpO1xudmFyIE1vdmVEaXJlY3Rpb247XG4oZnVuY3Rpb24gKE1vdmVEaXJlY3Rpb24pIHtcbiAgICBNb3ZlRGlyZWN0aW9uW01vdmVEaXJlY3Rpb25bXCJGb3J3YXJkXCJdID0gMF0gPSBcIkZvcndhcmRcIjtcbiAgICBNb3ZlRGlyZWN0aW9uW01vdmVEaXJlY3Rpb25bXCJCYWNrd2FyZFwiXSA9IDFdID0gXCJCYWNrd2FyZFwiO1xuICAgIE1vdmVEaXJlY3Rpb25bTW92ZURpcmVjdGlvbltcIkxlZnRcIl0gPSAyXSA9IFwiTGVmdFwiO1xuICAgIE1vdmVEaXJlY3Rpb25bTW92ZURpcmVjdGlvbltcIlJpZ2h0XCJdID0gM10gPSBcIlJpZ2h0XCI7XG59KShNb3ZlRGlyZWN0aW9uIHx8IChNb3ZlRGlyZWN0aW9uID0ge30pKTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWUge1xuICAgIGdyaWQ7XG4gICAgcmVuZGVyZXI7XG4gICAgbWVzc2FnZTtcbiAgICBnYW1lUGFuZWw7XG4gICAgbWluaW1hcFBhbmVsO1xuICAgIHBsYXllcjtcbiAgICBzdGF0ZTtcbiAgICBjYW1lcmE7XG4gICAgY2FtZXJhQ29udHJvbGxlcjtcbiAgICBrZXlMaXN0ZW5lcjtcbiAgICBkb1Jlc2V0Q2FtZXJhO1xuICAgIGNvbnN0cnVjdG9yKGdsKSB7XG4gICAgICAgIHRoaXMuY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7XG4gICAgICAgIHRoaXMuY2FtZXJhQ29udHJvbGxlciA9IG5ldyBDYW1lcmFDb250cm9sbGVyKHRoaXMuY2FtZXJhLCAzKTtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IG5ldyBSZW5kZXJlcihnbCwgdW5kZWZpbmVkLCB0aGlzLmNhbWVyYSk7XG4gICAgICAgIHRoaXMuZG9SZXNldENhbWVyYSA9IHRydWU7XG4gICAgICAgIC8vIEF0dGFjaCB0aGUgY2FtZXJhIGNvbnRyb2xsZXIgdXBkYXRlIHRvIHRoZSByZW5kZXJlclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZFVwZGF0ZUNhbGxiYWNrKChkZWx0YVRpbWUpID0+IHRoaXMuY2FtZXJhQ29udHJvbGxlci51cGRhdGUoZGVsdGFUaW1lKSk7XG4gICAgICAgIC8vIFVwZGF0ZSBjYW1lcmEgYXNwZWN0IHJhdGlvXG4gICAgICAgIHRoaXMucmVuZGVyZXIuYWRkVXBkYXRlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jYW1lcmEuYXNwZWN0ID0gdGhpcy5yZW5kZXJlci5nbC5jYW52YXMud2lkdGggLyB0aGlzLnJlbmRlcmVyLmdsLmNhbnZhcy5oZWlnaHQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmdyaWQgPSBuZXcgR3JpZCh0aGlzLnJlbmRlcmVyLnNjZW5lKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIgPSB0aGlzLmdyaWQuZ2V0UGxheWVyKCk7XG4gICAgICAgIHRoaXMuY2FtZXJhQ29udHJvbGxlci5tb3ZlVG8odGhpcy5wbGF5ZXIuY2FtZXJhVGFyZ2V0LmdldFdvcmxkUG9zaXRpb24oKSk7XG4gICAgICAgIHRoaXMuY2FtZXJhLnRyYW5zZm9ybS5zZXRSb3RhdGlvbkRlZygtNDUsIDE4MCwgMCk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBHYW1lU3RhdGUuV0FMS0lORztcbiAgICAgICAgdGhpcy5rZXlMaXN0ZW5lciA9IG5ldyBLZXlMaXN0ZW5lcigpO1xuICAgICAgICB0aGlzLmtleUxpc3RlbmVyLmFkZExpc3RlbmVycyhbXG4gICAgICAgICAgICAvLyBNb3ZlIHBsYXllciB3aXRoICd3JywgJ2EnLCAncycsICdkJ1xuICAgICAgICAgICAgWyd3JywgKCkgPT4gdGhpcy5tb3ZlUGxheWVyKE1vdmVEaXJlY3Rpb24uRm9yd2FyZCldLFxuICAgICAgICAgICAgWydhJywgKCkgPT4gdGhpcy5tb3ZlUGxheWVyKE1vdmVEaXJlY3Rpb24uTGVmdCldLFxuICAgICAgICAgICAgWydzJywgKCkgPT4gdGhpcy5tb3ZlUGxheWVyKE1vdmVEaXJlY3Rpb24uQmFja3dhcmQpXSxcbiAgICAgICAgICAgIFsnZCcsICgpID0+IHRoaXMubW92ZVBsYXllcihNb3ZlRGlyZWN0aW9uLlJpZ2h0KV0sXG4gICAgICAgICAgICAvLyBPcGVuL2Nsb3NlIGludmVudG9yeSB3aXRoICdpJ1xuICAgICAgICAgICAgWydpJywgKCkgPT4gdGhpcy50b2dnbGVJbnZlbnRvcnkoKV0sXG4gICAgICAgICAgICAvLyBBdHRhY2sgRW5lbXlcbiAgICAgICAgICAgIFsncScsICgpID0+IHRoaXMuYXR0YWNrKCldLFxuICAgICAgICAgICAgLy8gU2VsZWN0IGludmVudG9yeSB3ZWFwb24vaXRlbSB3aXRoICcxJy0nOSdcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBbJ0RpZ2l0MScsICdEaWdpdDInLCAnRGlnaXQzJywgJ0RpZ2l0NCcsICdEaWdpdDUnLFxuICAgICAgICAgICAgICAgICAgICAnRGlnaXQ2JywgJ0RpZ2l0NycsICdEaWdpdDgnLCAnRGlnaXQ5J10sXG4gICAgICAgICAgICAgICAgKHsga2V5IH0pID0+IHRoaXMuc2VsZWN0RnJvbUludmVudG9yeShOdW1iZXIoa2V5KSAtIDEpLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIFsnXFxcXCcsICgpID0+IHRoaXMuZ3JpZC5nZW5lcmF0ZU1hcCgpXSxcbiAgICAgICAgICAgIFsnLCcsICgpID0+IHsgdGhpcy5kb1Jlc2V0Q2FtZXJhID0gIXRoaXMuZG9SZXNldENhbWVyYTsgfV0sXG4gICAgICAgIF0pO1xuICAgICAgICB0aGlzLmNhbWVyYUNvbnRyb2xsZXIuYmluZEtleXModGhpcy5rZXlMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMua2V5TGlzdGVuZXIuc3RhcnRMaXN0ZW5pbmcoKTtcbiAgICAgICAgdGhpcy5nYW1lUGFuZWwgPSBuZXcgR2FtZVBhbmVsKHRoaXMpO1xuICAgICAgICB0aGlzLm1pbmltYXBQYW5lbCA9IG5ldyBNaW5pbWFwUGFuZWwodGhpcyk7XG4gICAgICAgIHRoaXMubWVzc2FnZSA9ICcnO1xuICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoJ0dhbWUgU3RhcnQnKTtcbiAgICAgICAgdGhpcy5wcmludEdhbWUoKTtcbiAgICAgICAgLy8gQmVnaW4gcmVuZGVyaW5nXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgodGltZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5yZW5kZXIodGltZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdG9wR2FtZSgpIHtcbiAgICAgICAgdGhpcy5rZXlMaXN0ZW5lci5zdG9wTGlzdGVuaW5nKCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc3RvcFJlbmRlcmluZygpO1xuICAgIH1cbiAgICAvLyB1cGRhdGUoaGFuZGxlcj86IEZ1bmN0aW9uKTogdm9pZCB7XG4gICAgLy8gICBpZiAoaGFuZGxlcikgaGFuZGxlcigpO1xuICAgIC8vIH1cbiAgICAvL1xuICAgIG1vdmVQbGF5ZXIoZGlyKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBHYW1lU3RhdGUuV0FMS0lORylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGRlbHRhWCA9IDA7XG4gICAgICAgIGxldCBkZWx0YVkgPSAwO1xuICAgICAgICBzd2l0Y2ggKGRpcikge1xuICAgICAgICAgICAgY2FzZSBNb3ZlRGlyZWN0aW9uLkZvcndhcmQ6XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIubW9kZWxOb2RlLmxvY2FsVHJhbnNmb3JtLnNldFJvdGF0aW9uRGVnKDAsIDAsIDApO1xuICAgICAgICAgICAgICAgIGRlbHRhWSA9IDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIE1vdmVEaXJlY3Rpb24uQmFja3dhcmQ6XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIubW9kZWxOb2RlLmxvY2FsVHJhbnNmb3JtLnNldFJvdGF0aW9uRGVnKDAsIDE4MCwgMCk7XG4gICAgICAgICAgICAgICAgZGVsdGFZID0gLTE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIE1vdmVEaXJlY3Rpb24uTGVmdDpcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5tb2RlbE5vZGUubG9jYWxUcmFuc2Zvcm0uc2V0Um90YXRpb25EZWcoMCwgOTAsIDApO1xuICAgICAgICAgICAgICAgIGRlbHRhWCA9IDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIE1vdmVEaXJlY3Rpb24uUmlnaHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIubW9kZWxOb2RlLmxvY2FsVHJhbnNmb3JtLnNldFJvdGF0aW9uRGVnKDAsIC05MCwgMCk7XG4gICAgICAgICAgICAgICAgZGVsdGFYID0gLTE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgeDogY3VycmVudFgsIHk6IGN1cnJlbnRZIH0gPSB0aGlzLmdyaWQuZ2V0UG9zaXRpb25PZih0aGlzLnBsYXllcik7XG4gICAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0ge1xuICAgICAgICAgICAgeDogY3VycmVudFggKyBkZWx0YVgsXG4gICAgICAgICAgICB5OiBjdXJyZW50WSArIGRlbHRhWSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgeyBlbnRpdHksIGNvbGxpc2lvbiB9ID0gdGhpcy5ncmlkLnF1ZXJ5KG5ld1Bvc2l0aW9uKTtcbiAgICAgICAgLy8gQ2hlY2sgZm9yIGVudGl0aWVzXG4gICAgICAgIGlmIChlbnRpdHkpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoZW50aXR5LmNvbnN0cnVjdG9yKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBFbmVteToge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmVteSA9IGVudGl0eTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKGBZb3UgYnVtcCBpbnRvICR7R2FtZS5ub3VuUGhyYXNlKGVuZW15KX0gJHtlbmVteS5zdHJpbmdSZXByZXNlbnRhdGlvbigpfWApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBXZWFwb246IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2VhcG9uID0gZW50aXR5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5waWNrVXBXZWFwb24od2VhcG9uKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkLnJlbW92ZUVudGl0eSh3ZWFwb24pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoYFlvdSBwaWNrIHVwICR7R2FtZS5ub3VuUGhyYXNlKHdlYXBvbil9YCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIEl0ZW06IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUGljayB1cCBpdGVtXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBlbnRpdHk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnBpY2tVcEl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5yZW1vdmVFbnRpdHkoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShgWW91IHBpY2sgdXAgJHtHYW1lLm5vdW5QaHJhc2UoaXRlbSl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBmb3IgY29sbGlzaW9uXG4gICAgICAgIGlmICghY29sbGlzaW9uKSB7XG4gICAgICAgICAgICB0aGlzLmdyaWQubW92ZUVudGl0eSh0aGlzLnBsYXllciwgbmV3UG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRvUmVzZXRDYW1lcmEpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0NhbWVyYVBvc2l0aW9uID0gdGhpcy5wbGF5ZXIuY2FtZXJhVGFyZ2V0LmdldFdvcmxkUG9zaXRpb24oKTtcbiAgICAgICAgICAgIHRoaXMuY2FtZXJhQ29udHJvbGxlci5tb3ZlVG8obmV3Q2FtZXJhUG9zaXRpb24pO1xuICAgICAgICAgICAgdGhpcy5jYW1lcmEudHJhbnNmb3JtLnNldFJvdGF0aW9uRGVnKC00NSwgMTgwLCAwKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBvc3RUdXJuKCk7XG4gICAgICAgIHRoaXMucHJpbnRHYW1lKCk7XG4gICAgfVxuICAgIG1vdmVDYW1lcmEodHJhbnNsYXRpb24pIHtcbiAgICAgICAgY29uc3QgeyBwb3NpdGlvbiB9ID0gdGhpcy5yZW5kZXJlci5jYW1lcmEudHJhbnNmb3JtO1xuICAgICAgICB2My5hZGQocG9zaXRpb24sIHRyYW5zbGF0aW9uLCBwb3NpdGlvbik7XG4gICAgICAgIHJldHVybiBwb3NpdGlvbjtcbiAgICB9XG4gICAgYXR0YWNrKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gR2FtZVN0YXRlLldBTEtJTkcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIFNlYXJjaCBmb3IgYW4gZW5lbXkgd2l0aGluZyB0aGUgbmVhcmVzdCBmb3VyIHRpbGVzXG4gICAgICAgIGNvbnN0IHJhbmdlID0gWzAsIC0xLCAtMSwgMCwgMCwgMSwgMSwgMF07XG4gICAgICAgIGxldCBlbmVteTtcbiAgICAgICAgY29uc3QgeyB4OiBwbGF5ZXJYLCB5OiBwbGF5ZXJZIH0gPSB0aGlzLmdyaWQuZ2V0UG9zaXRpb25PZih0aGlzLnBsYXllcik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFuZ2UubGVuZ3RoOyBpICs9IDIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrUG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgeDogcGxheWVyWCArIHJhbmdlW2ldLFxuICAgICAgICAgICAgICAgIHk6IHBsYXllclkgKyByYW5nZVtpICsgMV0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5ncmlkLmdldEVudGl0eUF0KGNoZWNrUG9zaXRpb24pO1xuICAgICAgICAgICAgaWYgKGVudGl0eSAmJiBlbnRpdHkgaW5zdGFuY2VvZiBFbmVteSkge1xuICAgICAgICAgICAgICAgIGVuZW15ID0gZW50aXR5O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghZW5lbXkpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZSgnTm8gRW5lbWllcyBpbiBSYW5nZScpO1xuICAgICAgICAgICAgdGhpcy5wcmludEdhbWUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMucGxheWVyLmVxdWlwcGVkV2VhcG9uKSB7XG4gICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoJ05vIFdlYXBvbiBFcXVpcHBlZCcpO1xuICAgICAgICAgICAgdGhpcy5wcmludEdhbWUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbmVteS5jb21iYXRUaW1lciA9IDc7XG4gICAgICAgIC8vIFBsYXllciBhdHRhY2tcbiAgICAgICAgbGV0IHJhbmQgPSAxICsgTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIDUpKTtcbiAgICAgICAgY29uc3QgU1AgPSB0aGlzLnBsYXllci5za2lsbCArIHJhbmQgKyB0aGlzLnBsYXllci5lcXVpcHBlZFdlYXBvbi5za2lsbEJvbnVzO1xuICAgICAgICBpZiAoU1AgPiBlbmVteS5za2lsbCkge1xuICAgICAgICAgICAgLy8gQXR0YWNrIGhpdFxuICAgICAgICAgICAgZW5lbXkuaGVhbHRoIC09IHRoaXMucGxheWVyLmVxdWlwcGVkV2VhcG9uLmRhbWFnZTtcbiAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShgJHtlbmVteS5uYW1lfSB0b29rICR7dGhpcy5wbGF5ZXIuZXF1aXBwZWRXZWFwb24uZGFtYWdlfSBkYW1hZ2UuICR7ZW5lbXkubmFtZX0gaGFzICR7TWF0aC5tYXgoZW5lbXkuaGVhbHRoLCAwKX0gaGVhbHRoIHJlbWFpbmluZ2ApO1xuICAgICAgICAgICAgaWYgKGVuZW15LmhlYWx0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gRW5lbXkgZGVmZWF0ZWRcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5za2lsbCArPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5yZW1vdmVFbnRpdHkoZW5lbXkpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShgJHtlbmVteS5uYW1lfSBoYXMgYmVlbiBkZWZlYXRlZGApO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyaWQuZ2V0RW50aXRpZXMoKS5lbmVtaWVzLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKCdBbGwgRW5lbWllcyBEZWZlYXRlZCcpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoJ1lvdSBXaW4nKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wR2FtZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnByaW50R2FtZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIEF0dGFjayBtaXNzXG4gICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoJ0F0dGFjayBNaXNzZWQuIE5vIGRhbWFnZSBkZWFsdCcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEVuZW15IGF0dGFja1xuICAgICAgICByYW5kID0gMSArIE1hdGguZmxvb3IoKE1hdGgucmFuZG9tKCkgKiA1KSk7XG4gICAgICAgIGNvbnN0IGVuZW15U1AgPSBlbmVteS5za2lsbCArIHJhbmQ7XG4gICAgICAgIGlmIChlbmVteVNQID4gU1ApIHtcbiAgICAgICAgICAgIC8vIEF0dGFjayBoaXRcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmhlYWx0aCAtPSBlbmVteS5kYW1hZ2U7XG4gICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoYCR7ZW5lbXkubmFtZX0gZGVhbHMgJHtlbmVteS5kYW1hZ2V9IGRhbWFnZWApO1xuICAgICAgICAgICAgaWYgKHRoaXMucGxheWVyLmhlYWx0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKCdZb3UgRGllZC5cXG5HYW1lIE92ZXIuJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5wcmludEdhbWUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BHYW1lKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gQXJyYWNrIG1pc3NcbiAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShgJHtlbmVteS5uYW1lfSBtaXNzZXMuIE5vIGRhbWFnZSBkZWFsdGApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucG9zdFR1cm4oKTtcbiAgICAgICAgdGhpcy5wcmludEdhbWUoKTtcbiAgICB9XG4gICAgdG9nZ2xlSW52ZW50b3J5KCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gR2FtZVN0YXRlLklOVkVOVE9SWSkge1xuICAgICAgICAgICAgLy8gQ2xvc2UgaW52ZW50b3J5XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gR2FtZVN0YXRlLldBTEtJTkc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBPcGVuIGludmVudG9yeVxuICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKCdZb3UgbG9vayBhdCB5b3VyIGludmVudG9yeScpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IEdhbWVTdGF0ZS5JTlZFTlRPUlk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcmludEdhbWUoKTtcbiAgICB9XG4gICAgc2VsZWN0RnJvbUludmVudG9yeShpbmRleCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gR2FtZVN0YXRlLklOVkVOVE9SWSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gaWYgKGluZGV4ID49IHRoaXMucGxheWVyLmludmVudG9yeS53ZWFwb25zLmxlbmd0aCkgcmV0dXJuO1xuICAgICAgICBpZiAoaW5kZXggPj0gdGhpcy5wbGF5ZXIuaW52ZW50b3J5LmludmVudG9yeS5sZW5ndGgpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIGNvbnN0IHdlYXBvbiA9IHRoaXMucGxheWVyLmludmVudG9yeS53ZWFwb25zW2luZGV4XTtcbiAgICAgICAgY29uc3QgaW52ZW50b3J5T2JqID0gdGhpcy5wbGF5ZXIuaW52ZW50b3J5LmludmVudG9yeVtpbmRleF07XG4gICAgICAgIGlmIChpbnZlbnRvcnlPYmogaW5zdGFuY2VvZiBXZWFwb24pIHtcbiAgICAgICAgICAgIGNvbnN0IHdlYXBvbiA9IGludmVudG9yeU9iajtcbiAgICAgICAgICAgIGlmICh0aGlzLnBsYXllci5lcXVpcHBlZFdlYXBvbiA9PT0gd2VhcG9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlICs9IGBcIllvdSBhbHJlYWR5IGhhdmUgdGhpcyAke3dlYXBvbi5uYW1lfSBlcXVpcHBlZFwiXFxuYDtcbiAgICAgICAgICAgICAgICB0aGlzLnByaW50R2FtZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucGxheWVyLmVxdWlwcGVkV2VhcG9uID0gd2VhcG9uO1xuICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKGBZb3UgZXF1aXAgJHtHYW1lLm5vdW5QaHJhc2Uod2VhcG9uKX1gKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpbnZlbnRvcnlPYmogaW5zdGFuY2VvZiBJdGVtKSB7XG4gICAgICAgICAgICBjb25zdCBpdGVtID0gaW52ZW50b3J5T2JqO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuaGVhbHRoICs9IGl0ZW0uZWZmZWN0SFA7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5za2lsbCArPSBpdGVtLmVmZmVjdFNQO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIudXNlVXBJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlICs9IGBVc2UgSXRlbTogJHtpdGVtLm5hbWV9IDogJHtpdGVtLmRlc2NyaXB0aW9ufWA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wb3N0VHVybigpO1xuICAgICAgICB0aGlzLnByaW50R2FtZSgpO1xuICAgIH1cbiAgICBhZGRNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlICs9IGBcIiR7bWVzc2FnZX1cIlxcbmA7XG4gICAgfVxuICAgIHBvc3RUdXJuKCkge1xuICAgICAgICB0aGlzLmdyaWQuZ2V0RW50aXRpZXMoKS5lbmVtaWVzLmZvckVhY2goKGVuZW15KSA9PiB7XG4gICAgICAgICAgICBlbmVteS5jb21iYXRUaW1lciAtPSAxO1xuICAgICAgICAgICAgaWYgKGVuZW15LmNvbWJhdFRpbWVyID4gMClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjb25zdCB7IHg6IGN1cnJlbnRYLCB5OiBjdXJyZW50WSB9ID0gdGhpcy5ncmlkLmdldFBvc2l0aW9uT2YoZW5lbXkpO1xuICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBbMCwgLTEsIC0xLCAwLCAwLCAxLCAxLCAwXTtcbiAgICAgICAgICAgIGNvbnN0IHJhbmRQb3MgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KSAqIDI7XG4gICAgICAgICAgICBjb25zdCBuZXdQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICB4OiBjdXJyZW50WCArIHJhbmdlW3JhbmRQb3NdLFxuICAgICAgICAgICAgICAgIHk6IGN1cnJlbnRZICsgcmFuZ2VbcmFuZFBvcyArIDFdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHsgZW50aXR5LCBjb2xsaXNpb24gfSA9IHRoaXMuZ3JpZC5xdWVyeShuZXdQb3NpdGlvbik7XG4gICAgICAgICAgICBpZiAoZW50aXR5IHx8IGNvbGxpc2lvbilcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB0aGlzLmdyaWQubW92ZUVudGl0eShlbmVteSwgbmV3UG9zaXRpb24pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcHJpbnRHYW1lKCkge1xuICAgICAgICAvLyBVcGRhdGUgdGhlIFVJXG4gICAgICAgIHRoaXMuZ2FtZVBhbmVsLnVwZGF0ZSgpO1xuICAgICAgICB0aGlzLm1pbmltYXBQYW5lbC51cGRhdGUoKTtcbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tY29uc29sZSAqL1xuICAgICAgICAvLyBHcmlkXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZ3JpZC5zdHJpbmdSZXByZXNlbnRhdGlvbigpKTtcbiAgICAgICAgLy8gUGxheWVyIHN0YXRzXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMucGxheWVyLnN0cmluZ1JlcHJlc2VudGF0aW9uKCkpO1xuICAgICAgICBpZiAodGhpcy5wbGF5ZXIuZXF1aXBwZWRXZWFwb24pIHtcbiAgICAgICAgICAgIC8vIEVxdXBwZWQgd2VhcG9uXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRXF1aXBwZWQgd2VhcG9uOicsIHRoaXMucGxheWVyLmVxdWlwcGVkV2VhcG9uLnN0cmluZ1JlcHJlc2VudGF0aW9uKCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIC8vIE1lc3NhZ2VcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMubWVzc2FnZSk7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gR2FtZVN0YXRlLklOVkVOVE9SWSkge1xuICAgICAgICAgICAgLy8gSW52ZW50b3J5XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnBsYXllci5pbnZlbnRvcnkuc3RyaW5nUmVwcmVzZW50YXRpb24oKSk7XG4gICAgICAgIH1cbiAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1jb25zb2xlICovXG4gICAgfVxuICAgIHN0YXRpYyBub3VuUGhyYXNlKG9iamVjdCkge1xuICAgICAgICBpZiAoR2FtZS5pc1Zvd2VsKG9iamVjdC5uYW1lLmNoYXJBdCgwKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBgYW4gJHtvYmplY3QubmFtZX1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgYSAke29iamVjdC5uYW1lfWA7XG4gICAgfVxuICAgIHN0YXRpYyBpc1Zvd2VsKGNoYXJhY3Rlcikge1xuICAgICAgICByZXR1cm4gJ2FlaW91Jy5zcGxpdCgnJykuaW5jbHVkZXMoY2hhcmFjdGVyLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgRmxvb3JUaWxlIGZyb20gJy4vdGlsZXMvRmxvb3JUaWxlJztcbmltcG9ydCBXYWxsVGlsZSBmcm9tICcuL3RpbGVzL1dhbGxUaWxlJztcbmltcG9ydCBQbGF5ZXIgZnJvbSAnLi9lbnRpdGllcy9QbGF5ZXInO1xuaW1wb3J0IEVuZW15IGZyb20gJy4vZW50aXRpZXMvRW5lbXknO1xuaW1wb3J0IFdlYXBvbiBmcm9tICcuL2VudGl0aWVzL1dlYXBvbic7XG5pbXBvcnQgSXRlbSBmcm9tICcuL2VudGl0aWVzL0l0ZW0nO1xuaW1wb3J0IFNjZW5lTm9kZSBmcm9tICcuLi9yZW5kZXJlci9TY2VuZU5vZGUnO1xuaW1wb3J0IFRyYW5zZm9ybSBmcm9tICcuLi9yZW5kZXJlci9UcmFuc2Zvcm0nO1xuaW1wb3J0IER1bmdlb24gZnJvbSAnLi9EdW5nZW9uJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdyaWQge1xuICAgIHRpbGVzO1xuICAgIHBsYXllcjtcbiAgICBlbnRpdGllcztcbiAgICBlbnRpdHlMb29rdXA7XG4gICAgcG9zaXRpb25Mb29rdXA7XG4gICAgc2NlbmVOb2RlO1xuICAgIHNjZW5lO1xuICAgIGNvbnN0cnVjdG9yKHNjZW5lKSB7XG4gICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcbiAgICAgICAgdGhpcy5lbnRpdGllcyA9IHtcbiAgICAgICAgICAgIGVuZW1pZXM6IG5ldyBTZXQoKSxcbiAgICAgICAgICAgIHdlYXBvbnM6IG5ldyBTZXQoKSxcbiAgICAgICAgICAgIGl0ZW1zOiBuZXcgU2V0KCksXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZW50aXR5TG9va3VwID0gW107XG4gICAgICAgIHRoaXMucG9zaXRpb25Mb29rdXAgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuZ2VuZXJhdGVNYXAoKTtcbiAgICB9XG4gICAgLy8gU2hvdWxkIG9ubHkgYmUgY2FsbGVkIG9uY2UgYWZ0ZXIgdGhlIG1hcCBoYXMgYmVlbiBzZXRcbiAgICBidWlsZER1bmdlb24oKSB7XG4gICAgICAgIC8vIFRPRE86IHVzZSBtb2RlbCBleHRlbnRzLCBub3JtYWxpemUgbW9kZWxzIHRvIGJlIHRoZSBzYW1lIHNpemUsIGFuZCB1c2VcbiAgICAgICAgLy8gdGhhdCBmb3IgdGhlIHRpbGVTaXplXG4gICAgICAgIGNvbnN0IHRpbGVTaXplID0gMS4wO1xuICAgICAgICAvLyBUT0RPOiByZW1vdmUgYWZ0ZXIgaGF2aW5nIG1vdmFibGUgY2FtZXJhXG4gICAgICAgIGNvbnN0IHpGYWN0b3IgPSAxO1xuICAgICAgICB0aGlzLnRpbGVzLmZvckVhY2goKHJvdywgeSkgPT4ge1xuICAgICAgICAgICAgcm93LmZvckVhY2goKHRpbGUsIHgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjZW5lTm9kZS5hZGRDaGlsZCh0aWxlLm1vZGVsTm9kZSk7XG4gICAgICAgICAgICAgICAgdGlsZS5zZXRUcmFuc2Zvcm0obmV3IFRyYW5zZm9ybShbeCAqIHRpbGVTaXplLCAwLCB5ICogdGlsZVNpemUgKiB6RmFjdG9yXSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRUaWxlcygpIHsgcmV0dXJuIHRoaXMudGlsZXM7IH1cbiAgICBnZXRQbGF5ZXIoKSB7IHJldHVybiB0aGlzLnBsYXllcjsgfVxuICAgIGdldEVudGl0aWVzKCkgeyByZXR1cm4gdGhpcy5lbnRpdGllczsgfVxuICAgIGdldFRpbGVBdCh7IHgsIHkgfSkgeyByZXR1cm4gdGhpcy50aWxlc1t5XVt4XTsgfVxuICAgIGdldEVudGl0eUF0KHsgeCwgeSB9KSB7IHJldHVybiB0aGlzLmVudGl0eUxvb2t1cFt5XVt4XTsgfVxuICAgIGdldFBvc2l0aW9uT2YoZW50aXR5KSB7IHJldHVybiB0aGlzLnBvc2l0aW9uTG9va3VwLmdldChlbnRpdHkpOyB9XG4gICAgZ2VuZXJhdGVNYXAoKSB7XG4gICAgICAgIGlmICh0aGlzLnNjZW5lTm9kZSkge1xuICAgICAgICAgICAgdGhpcy5lbnRpdGllcyA9IHtcbiAgICAgICAgICAgICAgICBlbmVtaWVzOiBuZXcgU2V0KCksXG4gICAgICAgICAgICAgICAgd2VhcG9uczogbmV3IFNldCgpLFxuICAgICAgICAgICAgICAgIGl0ZW1zOiBuZXcgU2V0KCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5lbnRpdHlMb29rdXAgPSBbXTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25Mb29rdXAgPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICB0aGlzLnNjZW5lTm9kZS5yZW1vdmVTZWxmKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zY2VuZU5vZGUgPSBuZXcgU2NlbmVOb2RlKCdHcmlkJyk7XG4gICAgICAgIHRoaXMuc2NlbmUuYWRkTm9kZSh0aGlzLnNjZW5lTm9kZSk7XG4gICAgICAgIHRoaXMubG9hZEdyaWRGcm9tU3RyaW5nKER1bmdlb24uZ2VuZXJhdGUoMzUsIDM1LCA3KSk7XG4gICAgICAgIHRoaXMuYnVpbGREdW5nZW9uKCk7XG4gICAgfVxuICAgIHF1ZXJ5KHBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IHRpbGUgPSB0aGlzLmdldFRpbGVBdChwb3NpdGlvbik7XG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZ2V0RW50aXR5QXQocG9zaXRpb24pO1xuICAgICAgICBjb25zdCBjb2xsaXNpb24gPSAoIXRpbGUgfHwgdGlsZS5pc0NvbGxpZGFibGUpIHx8IChlbnRpdHkgJiYgZW50aXR5LmlzQ29sbGlkYWJsZSk7XG4gICAgICAgIHJldHVybiB7IHRpbGUsIGVudGl0eSwgY29sbGlzaW9uIH07XG4gICAgfVxuICAgIC8vIElmIHRpbGVzIGlzIG51bGwsIHRoZW4gdGhlIGVudGl0aWVzIGFyZW4ndCBhZGRlZCBhIGNoaWxkcmVuIHRvIHRoZWlyXG4gICAgLy8gTW9kZWxOb2Rlcy4gSXQncyB1cCB0byB0aGUgY2FsbGVyIHRvIHJlbWVkeSB0aGF0LlxuICAgIGFkZEVudGl0eShlbnRpdHksIHsgeCwgeSB9KSB7XG4gICAgICAgIGlmIChlbnRpdHkgaW5zdGFuY2VvZiBQbGF5ZXIpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyID0gZW50aXR5O1xuICAgICAgICB9XG4gICAgICAgIC8vIEFkZCBlbnRpdHkgdG8gY29ycmVzcG9uZGluZyBlbnRpdHkgc2V0XG4gICAgICAgIHRoaXMuZm9yU3VidHlwZU9mRW50aXR5KGVudGl0eSwgKGVudGl0eVN1YnR5cGUsIHNldCkgPT4ge1xuICAgICAgICAgICAgc2V0LmFkZChlbnRpdHlTdWJ0eXBlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFJlY29yZCBlbnRpdHkncyBwb3NpdGlvbiBvbiBncmlkXG4gICAgICAgIHRoaXMuZW50aXR5TG9va3VwW3ldW3hdID0gZW50aXR5O1xuICAgICAgICB0aGlzLnBvc2l0aW9uTG9va3VwLnNldChlbnRpdHksIHsgeCwgeSB9KTtcbiAgICAgICAgaWYgKHRoaXMudGlsZXMpXG4gICAgICAgICAgICB0aGlzLnRpbGVzW3ldW3hdLm1vZGVsTm9kZS5hZGRDaGlsZChlbnRpdHkubW9kZWxOb2RlKTtcbiAgICB9XG4gICAgcmVtb3ZlRW50aXR5KGVudGl0eSkge1xuICAgICAgICAvLyBSZW1vdmUgZW50aXR5IGZyb20gY29ycmVzcG9uZGluZyBlbnRpdHkgc2V0XG4gICAgICAgIHRoaXMuZm9yU3VidHlwZU9mRW50aXR5KGVudGl0eSwgKGVudGl0eVN1YnR5cGUsIHNldCkgPT4ge1xuICAgICAgICAgICAgc2V0LmRlbGV0ZShlbnRpdHlTdWJ0eXBlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFJlbW92ZSBlbnRpdHkncyBwb3NpdGlvbiBvbiBncmlkXG4gICAgICAgIGNvbnN0IHsgeCwgeSB9ID0gdGhpcy5wb3NpdGlvbkxvb2t1cC5nZXQoZW50aXR5KTtcbiAgICAgICAgdGhpcy5lbnRpdHlMb29rdXBbeV1beF0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9zaXRpb25Mb29rdXAuZGVsZXRlKGVudGl0eSk7XG4gICAgICAgIGVudGl0eS5tb2RlbE5vZGUucmVtb3ZlU2VsZigpO1xuICAgICAgICByZXR1cm4gZW50aXR5O1xuICAgIH1cbiAgICBtb3ZlRW50aXR5KGVudGl0eSwgeyB4OiBuZXdYLCB5OiBuZXdZIH0pIHtcbiAgICAgICAgLy8gQ2hhbmdlIGVudGl0eSdzIHBvc2l0aW9uIG9uIGdyaWRcbiAgICAgICAgY29uc3QgeyB4OiBvbGRYLCB5OiBvbGRZIH0gPSB0aGlzLnBvc2l0aW9uTG9va3VwLmdldChlbnRpdHkpO1xuICAgICAgICB0aGlzLmVudGl0eUxvb2t1cFtvbGRZXVtvbGRYXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5lbnRpdHlMb29rdXBbbmV3WV1bbmV3WF0gPSBlbnRpdHk7XG4gICAgICAgIHRoaXMucG9zaXRpb25Mb29rdXAuc2V0KGVudGl0eSwgeyB4OiBuZXdYLCB5OiBuZXdZIH0pO1xuICAgICAgICB0aGlzLnRpbGVzW25ld1ldW25ld1hdLm1vZGVsTm9kZS5hZGRDaGlsZChlbnRpdHkubW9kZWxOb2RlKTtcbiAgICB9XG4gICAgc3RyaW5nUmVwcmVzZW50YXRpb24oKSB7XG4gICAgICAgIC8vIEZsb29ycyBhbmQgd2FsbHNcbiAgICAgICAgY29uc3QgdGV4dEFycmF5ID0gdGhpcy50aWxlcy5tYXAoKHRpbGVSb3cpID0+IHRpbGVSb3cubWFwKCh0aWxlKSA9PiB0aWxlLmNoYXJhY3RlcikpO1xuICAgICAgICAvLyBOb24tcGxheWVyIGVudGl0aWVzXG4gICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5lbnRpdGllcykuZm9yRWFjaCgoc2V0KSA9PiB7XG4gICAgICAgICAgICBzZXQuZm9yRWFjaCgoZW50aXR5KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyB4LCB5IH0gPSB0aGlzLmdldFBvc2l0aW9uT2YoZW50aXR5KTtcbiAgICAgICAgICAgICAgICB0ZXh0QXJyYXlbeV1beF0gPSBlbnRpdHkuY2hhcmFjdGVyO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBQbGF5ZXJcbiAgICAgICAgY29uc3QgeyB4LCB5IH0gPSB0aGlzLmdldFBvc2l0aW9uT2YodGhpcy5wbGF5ZXIpO1xuICAgICAgICB0ZXh0QXJyYXlbeV1beF0gPSBQbGF5ZXIuY2hhcmFjdGVyO1xuICAgICAgICBsZXQgdGV4dCA9ICcnO1xuICAgICAgICB0ZXh0QXJyYXkuZm9yRWFjaCgocm93KSA9PiB7XG4gICAgICAgICAgICByb3cuZm9yRWFjaCgoY2hhcmFjdGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGV4dCArPSBjaGFyYWN0ZXI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRleHQgKz0gJ1xcbic7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG4gICAgbG9hZEdyaWRGcm9tU3RyaW5nKHN0cmluZykge1xuICAgICAgICB0aGlzLnRpbGVzID0gc3RyaW5nLnNwbGl0KCdcXG4nKS5tYXAoKHN0cmluZ1JvdywgeSkgPT4gc3RyaW5nUm93LnNwbGl0KCcnKS5tYXAoKGNoYXJhY3RlciwgeCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5lbnRpdHlMb29rdXAucHVzaChbXSk7XG4gICAgICAgICAgICBzd2l0Y2ggKGNoYXJhY3Rlcikge1xuICAgICAgICAgICAgICAgIGNhc2UgRmxvb3JUaWxlLmNoYXJhY3RlcjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9vclRpbGUoKTtcbiAgICAgICAgICAgICAgICBjYXNlIFdhbGxUaWxlLmNoYXJhY3RlcjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBXYWxsVGlsZSgpO1xuICAgICAgICAgICAgICAgIGNhc2UgUGxheWVyLmNoYXJhY3RlcjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRFbnRpdHkobmV3IFBsYXllcigpLCB7IHgsIHkgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmxvb3JUaWxlKCk7XG4gICAgICAgICAgICAgICAgY2FzZSBFbmVteS5jaGFyYWN0ZXI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRW50aXR5KG5ldyBFbmVteSgpLCB7IHgsIHkgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmxvb3JUaWxlKCk7XG4gICAgICAgICAgICAgICAgY2FzZSBXZWFwb24uY2hhcmFjdGVyOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEVudGl0eShuZXcgV2VhcG9uKCksIHsgeCwgeSB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9vclRpbGUoKTtcbiAgICAgICAgICAgICAgICBjYXNlIEl0ZW0uY2hhcmFjdGVyOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEVudGl0eShuZXcgSXRlbSgpLCB7IHgsIHkgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmxvb3JUaWxlKCk7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9vclRpbGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnBvc2l0aW9uTG9va3VwLmZvckVhY2goKHsgeCwgeSB9LCBlbnRpdHkpID0+IHtcbiAgICAgICAgICAgIHRoaXMudGlsZXNbeV1beF0ubW9kZWxOb2RlLmFkZENoaWxkKGVudGl0eS5tb2RlbE5vZGUpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZm9yU3VidHlwZU9mRW50aXR5KGVudGl0eSwgY2FsbGJhY2spIHtcbiAgICAgICAgc3dpdGNoIChlbnRpdHkuY29uc3RydWN0b3IpIHtcbiAgICAgICAgICAgIGNhc2UgRW5lbXk6XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZW50aXR5LCB0aGlzLmVudGl0aWVzLmVuZW1pZXMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBXZWFwb246XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZW50aXR5LCB0aGlzLmVudGl0aWVzLndlYXBvbnMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBJdGVtOlxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVudGl0eSwgdGhpcy5lbnRpdGllcy5pdGVtcyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW52ZW50b3J5IHtcbiAgICB3ZWFwb25zO1xuICAgIGludmVudG9yeTtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy53ZWFwb25zID0gW107XG4gICAgICAgIHRoaXMuaW52ZW50b3J5ID0gW107XG4gICAgfVxuICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uKCkge1xuICAgICAgICAvLyBpZiAodGhpcy53ZWFwb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gICByZXR1cm4gYHdlYXBvbnM6ICR7XG4gICAgICAgIC8vICAgICB0aGlzLndlYXBvbnNcbiAgICAgICAgLy8gICAgICAgLm1hcCgod2VhcG9uLCBpbmRleCkgPT4gYFxcbiAgJHtpbmRleCArIDF9LiAke3dlYXBvbi5zdHJpbmdSZXByZXNlbnRhdGlvbigpfWApXG4gICAgICAgIC8vICAgICAgIC5qb2luKClcbiAgICAgICAgLy8gICB9YDtcbiAgICAgICAgLy8gfVxuICAgICAgICBpZiAodGhpcy5pbnZlbnRvcnkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGBJbnZlbnRvcnk6ICR7dGhpcy5pbnZlbnRvcnlcbiAgICAgICAgICAgICAgICAubWFwKChpdGVtLCBpbmRleCkgPT4gYFxcbiAgJHtpbmRleCArIDF9LiAke2l0ZW0uc3RyaW5nUmVwcmVzZW50YXRpb24oKX1gKVxuICAgICAgICAgICAgICAgIC5qb2luKCl9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ3dlYXBvbnM6IChubyB3ZWFwb25zKSc7XG4gICAgfVxufVxuIiwiZXhwb3J0IHZhciBLZXlQcmVzc1R5cGU7XG4oZnVuY3Rpb24gKEtleVByZXNzVHlwZSkge1xuICAgIEtleVByZXNzVHlwZVtLZXlQcmVzc1R5cGVbXCJET1dOXCJdID0gMF0gPSBcIkRPV05cIjtcbiAgICBLZXlQcmVzc1R5cGVbS2V5UHJlc3NUeXBlW1wiVVBcIl0gPSAxXSA9IFwiVVBcIjtcbn0pKEtleVByZXNzVHlwZSB8fCAoS2V5UHJlc3NUeXBlID0ge30pKTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEtleUxpc3RlbmVyIHtcbiAgICBrZXlEb3duQ2FsbGJhY2tzID0gbmV3IE1hcCgpO1xuICAgIGtleVVwQ2FsbGJhY2tzID0gbmV3IE1hcCgpO1xuICAgIGtleURvd25IYW5kbGVyO1xuICAgIGtleVVwSGFuZGxlcjtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5rZXlEb3duSGFuZGxlciA9IChrZXlFdmVudCkgPT4ge1xuICAgICAgICAgICAgLy8gSWYgY2FsbGJhY2sgZXhpc3RzIGZvciB0aGUgZ2l2ZW4ga2V5IG9yIGNvZGVcbiAgICAgICAgICAgIFtrZXlFdmVudC5rZXksIGtleUV2ZW50LmNvZGVdLmZpbmQoKGtleSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmtleURvd25DYWxsYmFja3MuaGFzKGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSW52b2tlIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgICh0aGlzLmtleURvd25DYWxsYmFja3MuZ2V0KGtleSkpKGtleUV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmtleVVwSGFuZGxlciA9IChrZXlFdmVudCkgPT4ge1xuICAgICAgICAgICAgLy8gSWYgY2FsbGJhY2sgZXhpc3RzIGZvciB0aGUgZ2l2ZW4ga2V5IG9yIGNvZGVcbiAgICAgICAgICAgIFtrZXlFdmVudC5rZXksIGtleUV2ZW50LmNvZGVdLmZpbmQoKGtleSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmtleVVwQ2FsbGJhY2tzLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEludm9rZSBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICAodGhpcy5rZXlVcENhbGxiYWNrcy5nZXQoa2V5KSkoa2V5RXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGFkZExpc3RlbmVyKGtleXMsIGNhbGxiYWNrLCBwcmVzc1R5cGUgPSBLZXlQcmVzc1R5cGUuRE9XTikge1xuICAgICAgICBjb25zdCBjYWxsYmFja3MgPSBwcmVzc1R5cGUgPT09IEtleVByZXNzVHlwZS5ET1dOXG4gICAgICAgICAgICA/IHRoaXMua2V5RG93bkNhbGxiYWNrcyA6IHRoaXMua2V5VXBDYWxsYmFja3M7XG4gICAgICAgIC8vIEFkZCBjYWxsYmFjayB0byB0aGUgZ2l2ZW4ga2V5KHMpXG4gICAgICAgIFtrZXlzXS5mbGF0KCkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICBjYWxsYmFja3Muc2V0KGtleSwgY2FsbGJhY2spO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWRkTGlzdGVuZXJzKGxpc3RlbmVycykge1xuICAgICAgICAvLyBBZGQgY2FsbGJhY2sgZm9yIGVhY2ggZ2l2ZW4ga2V5LWNhbGxiYWNrIHBhaXJcbiAgICAgICAgbGlzdGVuZXJzLmZvckVhY2goKFtrZXlzLCBjYWxsYmFjaywgcHJlc3NUeXBlXSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcihrZXlzLCBjYWxsYmFjaywgcHJlc3NUeXBlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXJ0TGlzdGVuaW5nKCkge1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMua2V5RG93bkhhbmRsZXIpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmtleVVwSGFuZGxlcik7XG4gICAgfVxuICAgIHN0b3BMaXN0ZW5pbmcoKSB7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5rZXlEb3duSGFuZGxlcik7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMua2V5VXBIYW5kbGVyKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgTW9kZWwgZnJvbSAnLi4vLi4vcmVuZGVyZXIvTW9kZWwnO1xuaW1wb3J0IEVudGl0eSBmcm9tICcuL0VudGl0eSc7XG5jb25zdCBtb2RlbHMgPSB7XG4gICAgbWFnZ290OiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL01hZ2dvdC9tb2RlbC5qc29uJyksXG4gICAgc2xpbWVNb2xkOiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL1NsaW1lTW9sZC9tb2RlbC5qc29uJyksXG4gICAgZ29ibGluOiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL0dvYmxpbi9tb2RlbC5qc29uJyksXG4gICAgb3JrOiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL09yay9tb2RlbC5qc29uJyksXG4gICAgdmFtcGlyZTogYXdhaXQgTW9kZWwubG9hZCgnL2Fzc2V0cy9WYW1waXJlL21vZGVsLmpzb24nKSxcbn07XG4vKiBlc2xpbnQgcXVvdGUtcHJvcHM6IFtcImVycm9yXCIsIFwiY29uc2lzdGVudFwiXSAqL1xuY29uc3QgZW5lbWllcyA9IG5ldyBNYXAoW1xuICAgIFsnTWFnZ290Jywge1xuICAgICAgICAgICAgaGVhbHRoOiA0LCBza2lsbDogMCwgZGFtYWdlOiA0LCBtb2RlbDogbW9kZWxzLm1hZ2dvdCxcbiAgICAgICAgfV0sXG4gICAgWydTbGltZSBNb2xkJywge1xuICAgICAgICAgICAgaGVhbHRoOiA3LCBza2lsbDogMSwgZGFtYWdlOiAzLCBtb2RlbDogbW9kZWxzLnNsaW1lTW9sZCxcbiAgICAgICAgfV0sXG4gICAgWydHb2JsaW4nLCB7XG4gICAgICAgICAgICBoZWFsdGg6IDksIHNraWxsOiA0LCBkYW1hZ2U6IDUsIG1vZGVsOiBtb2RlbHMuZ29ibGluLFxuICAgICAgICB9XSxcbiAgICBbJ09yaycsIHtcbiAgICAgICAgICAgIGhlYWx0aDogMTEsIHNraWxsOiAyLCBkYW1hZ2U6IDcsIG1vZGVsOiBtb2RlbHMub3JrLFxuICAgICAgICB9XSxcbiAgICBbJ1ZhbXBpcmUnLCB7XG4gICAgICAgICAgICBoZWFsdGg6IDIwLCBza2lsbDogOSwgZGFtYWdlOiAxMCwgbW9kZWw6IG1vZGVscy52YW1waXJlLFxuICAgICAgICB9XSxcbl0pO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRW5lbXkgZXh0ZW5kcyBFbnRpdHkge1xuICAgIHN0YXRpYyBjaGFyYWN0ZXIgPSAnZSc7XG4gICAgc3RhdGljIGlzQ29sbGlkYWJsZSA9IHRydWU7XG4gICAgLy8gbmFtZTogc3RyaW5nO1xuICAgIGhlYWx0aDtcbiAgICBza2lsbDtcbiAgICBkYW1hZ2U7XG4gICAgY29tYmF0VGltZXI7XG4gICAgY29uc3RydWN0b3IobmFtZSA9IEVuZW15LnJhbmRvbUVuZW15TmFtZSgpKSB7XG4gICAgICAgIHN1cGVyKGVuZW1pZXMuZ2V0KG5hbWUpLm1vZGVsLCBFbmVteS5jaGFyYWN0ZXIsIEVuZW15LmlzQ29sbGlkYWJsZSk7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuaGVhbHRoID0gZW5lbWllcy5nZXQobmFtZSk/LmhlYWx0aCA/PyAxO1xuICAgICAgICB0aGlzLnNraWxsID0gZW5lbWllcy5nZXQobmFtZSk/LnNraWxsID8/IDA7XG4gICAgICAgIHRoaXMuZGFtYWdlID0gZW5lbWllcy5nZXQobmFtZSk/LmRhbWFnZSA/PyAwO1xuICAgICAgICB0aGlzLmNvbWJhdFRpbWVyID0gMDtcbiAgICB9XG4gICAgc3RyaW5nUmVwcmVzZW50YXRpb24oKSB7XG4gICAgICAgIHJldHVybiBgKEhQOiAke3RoaXMuaGVhbHRofSwgU1A6ICR7dGhpcy5za2lsbH0sIGRhbWFnZTogJHt0aGlzLmRhbWFnZX0pYDtcbiAgICB9XG4gICAgc3RhdGljIHJhbmRvbUVuZW15TmFtZSgpIHtcbiAgICAgICAgY29uc3QgbmFtZXMgPSBBcnJheS5mcm9tKGVuZW1pZXMua2V5cygpKTtcbiAgICAgICAgcmV0dXJuIG5hbWVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG5hbWVzLmxlbmd0aCldO1xuICAgIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEVudGl0eSB7XG4gICAgY2hhcmFjdGVyO1xuICAgIG5hbWU7XG4gICAgaXNDb2xsaWRhYmxlO1xuICAgIG1vZGVsTm9kZTtcbiAgICBzdHJpbmdSZXByZXNlbnRhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hhcmFjdGVyO1xuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcihtb2RlbCwgY2hhcmFjdGVyLCBpc0NvbGxpZGFibGUpIHtcbiAgICAgICAgdGhpcy5jaGFyYWN0ZXIgPSBjaGFyYWN0ZXIuY2hhckF0KDApO1xuICAgICAgICB0aGlzLmlzQ29sbGlkYWJsZSA9IGlzQ29sbGlkYWJsZTtcbiAgICAgICAgdGhpcy5tb2RlbE5vZGUgPSBtb2RlbC5jcmVhdGVNb2RlbE5vZGUoKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgTW9kZWwgZnJvbSAnLi4vLi4vcmVuZGVyZXIvTW9kZWwnO1xuaW1wb3J0IEVudGl0eSBmcm9tICcuL0VudGl0eSc7XG4vLyBjb25zdCByYXRpb25Nb2RlbCA9IGF3YWl0IE1vZGVsLmxvYWQoJy9hc3NldHMvUmF0aW9uL21vZGVsLmpzb24nKTtcbmNvbnN0IG1vZGVscyA9IHtcbiAgICByYXRpb246IGF3YWl0IE1vZGVsLmxvYWQoJy9hc3NldHMvcmF0aW9uL21vZGVsLmpzb24nKSxcbiAgICBnb3VybWV0TWVhbDogYXdhaXQgTW9kZWwubG9hZCgnL2Fzc2V0cy9nb3VybWV0X21lYWwvbW9kZWwuanNvbicpLFxuICAgIHNpbHZlclJpbmc6IGF3YWl0IE1vZGVsLmxvYWQoJy9hc3NldHMvc2lsdmVyX3JpbmcvbW9kZWwuanNvbicpLFxuICAgIGZvb2xzQ2FwOiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL2Zvb2xzX2NhcC9tb2RlbC5qc29uJyksXG59O1xuLyogZXNsaW50IHF1b3RlLXByb3BzOiBbXCJlcnJvclwiLCBcImNvbnNpc3RlbnRcIl0gKi9cbmNvbnN0IGl0ZW1zID0gbmV3IE1hcChbXG4gICAgWydSYXRpb25zJywge1xuICAgICAgICAgICAgZWZmZWN0SFA6IDUsIGVmZmVjdFNQOiAwLCBkZXNjcmlwdGlvbjogJ0dpdmUgNSBIUCcsIG1vZGVsOiBtb2RlbHMucmF0aW9uLFxuICAgICAgICB9XSxcbiAgICBbJ0dvdXJtZXQgTWVhbCcsIHtcbiAgICAgICAgICAgIGVmZmVjdEhQOiAxMCwgZWZmZWN0U1A6IDAsIGRlc2NyaXB0aW9uOiAnR2l2ZSAxMCBIUCcsIG1vZGVsOiBtb2RlbHMuZ291cm1ldE1lYWwsXG4gICAgICAgIH1dLFxuICAgIFsnU2lsdmVyIFJpbmcnLCB7XG4gICAgICAgICAgICBlZmZlY3RIUDogMCwgZWZmZWN0U1A6IDUsIGRlc2NyaXB0aW9uOiAnR2l2ZSA1IFNQJywgbW9kZWw6IG1vZGVscy5zaWx2ZXJSaW5nLFxuICAgICAgICB9XSxcbiAgICBbJ0Zvb2xcXCdzIENhcCcsIHtcbiAgICAgICAgICAgIGVmZmVjdEhQOiAxMCwgZWZmZWN0U1A6IC0xMCwgZGVzY3JpcHRpb246ICdHaXZlIDEwIEhQLCBSZW1vdmUgMTAgU1AnLCBtb2RlbDogbW9kZWxzLmZvb2xzQ2FwLFxuICAgICAgICB9XSxcbl0pO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSXRlbSBleHRlbmRzIEVudGl0eSB7XG4gICAgc3RhdGljIGNoYXJhY3RlciA9ICdpJztcbiAgICBzdGF0aWMgaXNDb2xsaWRhYmxlID0gZmFsc2U7XG4gICAgLy8gbmFtZTogc3RyaW5nO1xuICAgIGVmZmVjdEhQO1xuICAgIGVmZmVjdFNQO1xuICAgIGRlc2NyaXB0aW9uO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUgPSBJdGVtLnJhbmRvbWl0ZW1OYW1lKCkpIHtcbiAgICAgICAgc3VwZXIoaXRlbXMuZ2V0KG5hbWUpLm1vZGVsLCBJdGVtLmNoYXJhY3RlciwgSXRlbS5pc0NvbGxpZGFibGUpO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLmVmZmVjdEhQID0gaXRlbXMuZ2V0KG5hbWUpPy5lZmZlY3RIUCA/PyAwO1xuICAgICAgICB0aGlzLmVmZmVjdFNQID0gaXRlbXMuZ2V0KG5hbWUpPy5lZmZlY3RTUCA/PyAwO1xuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gaXRlbXMuZ2V0KG5hbWUpPy5kZXNjcmlwdGlvbiA/PyAnJztcbiAgICB9XG4gICAgc3RyaW5nUmVwcmVzZW50YXRpb24oKSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLm5hbWV9IChFZmZlY3Q6ICR7dGhpcy5kZXNjcmlwdGlvbn0pYDtcbiAgICB9XG4gICAgc3RhdGljIHJhbmRvbWl0ZW1OYW1lKCkge1xuICAgICAgICBjb25zdCBuYW1lcyA9IEFycmF5LmZyb20oaXRlbXMua2V5cygpKTtcbiAgICAgICAgcmV0dXJuIG5hbWVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG5hbWVzLmxlbmd0aCldO1xuICAgIH1cbn1cbiIsImltcG9ydCBFbnRpdHkgZnJvbSAnLi9FbnRpdHknO1xuaW1wb3J0IEludmVudG9yeSBmcm9tICcuLi9JbnZlbnRvcnknO1xuaW1wb3J0IE1vZGVsIGZyb20gJy4uLy4uL3JlbmRlcmVyL01vZGVsJztcbmltcG9ydCBTY2VuZU5vZGUgZnJvbSAnLi4vLi4vcmVuZGVyZXIvU2NlbmVOb2RlJztcbmltcG9ydCB7IHRvUmFkaWFucyB9IGZyb20gJy4uLy4uL3V0aWwvTWF0aCc7XG5pbXBvcnQgVHJhbnNmb3JtIGZyb20gJy4uLy4uL3JlbmRlcmVyL1RyYW5zZm9ybSc7XG5jb25zdCBtb2RlbCA9IGF3YWl0IE1vZGVsLmxvYWQoJy9hc3NldHMvUGxheWVyL21vZGVsLmpzb24nKTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsYXllciBleHRlbmRzIEVudGl0eSB7XG4gICAgc3RhdGljIGNoYXJhY3RlciA9ICdAJztcbiAgICBzdGF0aWMgaXNDb2xsaWRhYmxlID0gdHJ1ZTtcbiAgICBoZWFsdGg7XG4gICAgc2tpbGw7XG4gICAgaW52ZW50b3J5O1xuICAgIGVxdWlwcGVkV2VhcG9uO1xuICAgIGNhbWVyYVRhcmdldDtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgY29uc3QgaW5pdENhbURpc3RhbmNlID0gNDtcbiAgICAgICAgY29uc3QgaW5pdENhbUFuZ2xlID0gNDU7XG4gICAgICAgIGNvbnN0IHsgeExlbiwgeUxlbiwgekxlbiB9ID0gbW9kZWwuZXh0ZW50cztcbiAgICAgICAgc3VwZXIobW9kZWwsIFBsYXllci5jaGFyYWN0ZXIsIFBsYXllci5pc0NvbGxpZGFibGUpO1xuICAgICAgICB0aGlzLmhlYWx0aCA9IDIwO1xuICAgICAgICB0aGlzLnNraWxsID0gMDtcbiAgICAgICAgdGhpcy5pbnZlbnRvcnkgPSBuZXcgSW52ZW50b3J5KCk7XG4gICAgICAgIHRoaXMuZXF1aXBwZWRXZWFwb24gPSBudWxsO1xuICAgICAgICBsZXQgbWF4TGVuID0geExlbjtcbiAgICAgICAgaWYgKG1heExlbiA8IHlMZW4pXG4gICAgICAgICAgICBtYXhMZW4gPSB5TGVuO1xuICAgICAgICBpZiAobWF4TGVuIDwgekxlbilcbiAgICAgICAgICAgIG1heExlbiA9IHpMZW47XG4gICAgICAgIHRoaXMubW9kZWxOb2RlLmxvY2FsVHJhbnNmb3JtLnNjYWxlID0gWzEgLyBtYXhMZW4sIDEgLyBtYXhMZW4sIDEgLyBtYXhMZW5dO1xuICAgICAgICB0aGlzLmNhbWVyYVRhcmdldCA9IG5ldyBTY2VuZU5vZGUoJ1BsYXllciBDYW1lcmEgVGFyZ2V0JywgbmV3IFRyYW5zZm9ybShbXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgaW5pdENhbURpc3RhbmNlICogTWF0aC5zaW4odG9SYWRpYW5zKGluaXRDYW1BbmdsZSkpLFxuICAgICAgICAgICAgLWluaXRDYW1EaXN0YW5jZSAqIE1hdGguY29zKHRvUmFkaWFucyhpbml0Q2FtQW5nbGUpKSxcbiAgICAgICAgXSkpO1xuICAgICAgICAvLyBBc3N1bWluZyBSYXltb24gaXMgaW5pdGlhbGx5IGZhY2luZyBpbiB0aGUgK3ogZGlyZWN0aW9uLiBQcmF5IHRoaXMgbmV2ZXJcbiAgICAgICAgLy8gY2hhbmdlcy5cbiAgICAgICAgdGhpcy5tb2RlbE5vZGUuYWRkQ2hpbGQodGhpcy5jYW1lcmFUYXJnZXQpO1xuICAgIH1cbiAgICBwaWNrVXBXZWFwb24od2VhcG9uKSB7XG4gICAgICAgIC8vIHRoaXMuaW52ZW50b3J5LndlYXBvbnMucHVzaCh3ZWFwb24pO1xuICAgICAgICB0aGlzLmludmVudG9yeS5pbnZlbnRvcnkucHVzaCh3ZWFwb24pO1xuICAgICAgICBpZiAoIXRoaXMuZXF1aXBwZWRXZWFwb24pIHtcbiAgICAgICAgICAgIHRoaXMuZXF1aXBwZWRXZWFwb24gPSB3ZWFwb247XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RyaW5nUmVwcmVzZW50YXRpb24oKSB7XG4gICAgICAgIGxldCBzdHJpbmcgPSBgSFA6ICR7dGhpcy5oZWFsdGh9LCBTUDogJHt0aGlzLnNraWxsfWA7XG4gICAgICAgIGlmICh0aGlzLmVxdWlwcGVkV2VhcG9uKSB7XG4gICAgICAgICAgICBzdHJpbmcgKz0gYCgke3RoaXMuZXF1aXBwZWRXZWFwb24uc2tpbGxCb251cyA+PSAwID8gJysnIDogJyd9JHt0aGlzLmVxdWlwcGVkV2VhcG9uLnNraWxsQm9udXN9KWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG4gICAgcGlja1VwSXRlbShpdGVtKSB7XG4gICAgICAgIHRoaXMuaW52ZW50b3J5LmludmVudG9yeS5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgICB1c2VVcEl0ZW0oaXRlbSkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuaW52ZW50b3J5LmludmVudG9yeS5pbmRleE9mKGl0ZW0pO1xuICAgICAgICB0aGlzLmludmVudG9yeS5pbnZlbnRvcnkuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgTW9kZWwgZnJvbSAnLi4vLi4vcmVuZGVyZXIvTW9kZWwnO1xuaW1wb3J0IEVudGl0eSBmcm9tICcuL0VudGl0eSc7XG5jb25zdCBtb2RlbHMgPSB7XG4gICAgZGFnZ2VyOiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL2RhZ2dlci9tb2RlbC5qc29uJyksXG4gICAgY2FzdElyb25QYW46IGF3YWl0IE1vZGVsLmxvYWQoJy9hc3NldHMvY2FzdF9pcm9uX3Bhbi9tb2RlbC5qc29uJyksXG4gICAgd2FySGFtbWVyOiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL3dhcl9oYW1tZXIvbW9kZWwuanNvbicpLFxuICAgIGhhdGNoZXQ6IGF3YWl0IE1vZGVsLmxvYWQoJy9hc3NldHMvaGF0Y2hldC9tb2RlbC5qc29uJyksXG4gICAgYmF0dGxlYXhlOiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL2JhdHRsZWF4ZS9tb2RlbC5qc29uJyksXG4gICAgc3dvcmQ6IGF3YWl0IE1vZGVsLmxvYWQoJy9hc3NldHMvc3dvcmQvbW9kZWwuanNvbicpLFxuICAgIGJhdG9uOiBhd2FpdCBNb2RlbC5sb2FkKCcvYXNzZXRzL2JhdG9uL21vZGVsLmpzb24nKSxcbiAgICBiYXR0bGVTdGFmZjogYXdhaXQgTW9kZWwubG9hZCgnL2Fzc2V0cy9iYXR0bGVfc3RhZmYvbW9kZWwuanNvbicpLFxufTtcbi8qIGVzbGludCBxdW90ZS1wcm9wczogW1wiZXJyb3JcIiwgXCJjb25zaXN0ZW50XCJdICovXG5jb25zdCB3ZWFwb25zID0gbmV3IE1hcChbXG4gICAgWydEYWdnZXInLCB7IGRhbWFnZTogMywgc2tpbGxCb251czogMCwgbW9kZWw6IG1vZGVscy5kYWdnZXIgfV0sXG4gICAgWydDYXN0IElyb24gUGFuJywgeyBkYW1hZ2U6IDcsIHNraWxsQm9udXM6IDEsIG1vZGVsOiBtb2RlbHMuY2FzdElyb25QYW4gfV0sXG4gICAgWydXYXIgSGFtbWVyJywgeyBkYW1hZ2U6IDEyLCBza2lsbEJvbnVzOiAtMSwgbW9kZWw6IG1vZGVscy53YXJIYW1tZXIgfV0sXG4gICAgWydIYXRjaGV0JywgeyBkYW1hZ2U6IDMsIHNraWxsQm9udXM6IDQsIG1vZGVsOiBtb2RlbHMuaGF0Y2hldCB9XSxcbiAgICBbJ0JhdHRsZWF4ZScsIHsgZGFtYWdlOiAxMCwgc2tpbGxCb251czogMiwgbW9kZWw6IG1vZGVscy5iYXR0bGVheGUgfV0sXG4gICAgWydTd29yZCcsIHsgZGFtYWdlOiA3LCBza2lsbEJvbnVzOiAzLCBtb2RlbDogbW9kZWxzLnN3b3JkIH1dLFxuICAgIFsnQmF0b24nLCB7IGRhbWFnZTogMiwgc2tpbGxCb251czogNywgbW9kZWw6IG1vZGVscy5iYXRvbiB9XSxcbiAgICBbJ0JhdHRsZSBTdGFmZicsIHsgZGFtYWdlOiA2LCBza2lsbEJvbnVzOiAzLCBtb2RlbDogbW9kZWxzLmJhdHRsZVN0YWZmIH1dLFxuXSk7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXZWFwb24gZXh0ZW5kcyBFbnRpdHkge1xuICAgIHN0YXRpYyBjaGFyYWN0ZXIgPSAndyc7XG4gICAgc3RhdGljIGlzQ29sbGlkYWJsZSA9IGZhbHNlO1xuICAgIC8vIG5hbWU6IHN0cmluZztcbiAgICBkYW1hZ2U7XG4gICAgc2tpbGxCb251cztcbiAgICBjb25zdHJ1Y3RvcihuYW1lID0gV2VhcG9uLnJhbmRvbVdlYXBvbk5hbWUoKSkge1xuICAgICAgICBzdXBlcih3ZWFwb25zLmdldChuYW1lKS5tb2RlbCwgV2VhcG9uLmNoYXJhY3RlciwgV2VhcG9uLmlzQ29sbGlkYWJsZSk7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuZGFtYWdlID0gd2VhcG9ucy5nZXQobmFtZSk/LmRhbWFnZSA/PyAwO1xuICAgICAgICB0aGlzLnNraWxsQm9udXMgPSB3ZWFwb25zLmdldChuYW1lKT8uc2tpbGxCb251cyA/PyAwO1xuICAgIH1cbiAgICBzdHJpbmdSZXByZXNlbnRhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMubmFtZX0gKGRhbWFnZTogJHt0aGlzLmRhbWFnZX0sIHNraWxsIGJvbnVzOiAke3RoaXMuc2tpbGxCb251c30pYDtcbiAgICB9XG4gICAgc3RhdGljIHJhbmRvbVdlYXBvbk5hbWUoKSB7XG4gICAgICAgIGNvbnN0IG5hbWVzID0gQXJyYXkuZnJvbSh3ZWFwb25zLmtleXMoKSk7XG4gICAgICAgIHJldHVybiBuYW1lc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBuYW1lcy5sZW5ndGgpXTtcbiAgICB9XG59XG4iLCJpbXBvcnQgTW9kZWwgZnJvbSAnLi4vLi4vcmVuZGVyZXIvTW9kZWwnO1xuaW1wb3J0IFRyYW5zZm9ybSBmcm9tICcuLi8uLi9yZW5kZXJlci9UcmFuc2Zvcm0nO1xuaW1wb3J0IHsgVGlsZSB9IGZyb20gJy4vVGlsZSc7XG5jb25zdCBtb2RlbFVybCA9ICcvYXNzZXRzL0Zsb29yL21vZGVsLmpzb24nO1xuY29uc3QgZmxvb3JNb2RlbCA9IGF3YWl0IE1vZGVsLmxvYWQobW9kZWxVcmwpO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRmxvb3JUaWxlIGV4dGVuZHMgVGlsZSB7XG4gICAgc3RhdGljIHR5cGUgPSAnRmxvb3JUaWxlJztcbiAgICBzdGF0aWMgY2hhcmFjdGVyID0gJy4nO1xuICAgIHN0YXRpYyBpc0NvbGxpZGFibGUgPSBmYWxzZTtcbiAgICBjb25zdHJ1Y3Rvcih0cmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCkpIHtcbiAgICAgICAgc3VwZXIoZmxvb3JNb2RlbCwgRmxvb3JUaWxlLmNoYXJhY3RlciwgRmxvb3JUaWxlLmlzQ29sbGlkYWJsZSwgdHJhbnNmb3JtKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgVHJhbnNmb3JtIGZyb20gJy4uLy4uL3JlbmRlcmVyL1RyYW5zZm9ybSc7XG5leHBvcnQgY2xhc3MgVGlsZSB7XG4gICAgc3RhdGljIHR5cGUgPSAnVGlsZSc7XG4gICAgY2hhcmFjdGVyO1xuICAgIGlzQ29sbGlkYWJsZTtcbiAgICBtb2RlbE5vZGU7XG4gICAgY29uc3RydWN0b3IobW9kZWwsIGNoYXJhY3RlciwgaXNDb2xsaWRhYmxlLCB0cmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCkpIHtcbiAgICAgICAgdGhpcy5jaGFyYWN0ZXIgPSBjaGFyYWN0ZXIuY2hhckF0KDApO1xuICAgICAgICB0aGlzLmlzQ29sbGlkYWJsZSA9IGlzQ29sbGlkYWJsZTtcbiAgICAgICAgdGhpcy5tb2RlbE5vZGUgPSBtb2RlbC5jcmVhdGVNb2RlbE5vZGUodHJhbnNmb3JtKTtcbiAgICB9XG4gICAgc2V0VHJhbnNmb3JtKHRyYW5zZm9ybSkge1xuICAgICAgICB0aGlzLm1vZGVsTm9kZS5sb2NhbFRyYW5zZm9ybSA9IHRyYW5zZm9ybTtcbiAgICB9XG59XG4iLCJpbXBvcnQgTW9kZWwgZnJvbSAnLi4vLi4vcmVuZGVyZXIvTW9kZWwnO1xuaW1wb3J0IFRyYW5zZm9ybSBmcm9tICcuLi8uLi9yZW5kZXJlci9UcmFuc2Zvcm0nO1xuaW1wb3J0IHsgVGlsZSB9IGZyb20gJy4vVGlsZSc7XG5jb25zdCBtb2RlbFVybCA9ICcvYXNzZXRzL1dhbGwvbW9kZWwuanNvbic7XG5jb25zdCB3YWxsTW9kZWwgPSBhd2FpdCBNb2RlbC5sb2FkKG1vZGVsVXJsKTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdhbGxUaWxlIGV4dGVuZHMgVGlsZSB7XG4gICAgc3RhdGljIHR5cGUgPSAnV2FsbFRpbGUnO1xuICAgIHN0YXRpYyBjaGFyYWN0ZXIgPSAnfCc7XG4gICAgc3RhdGljIGlzQ29sbGlkYWJsZSA9IHRydWU7XG4gICAgY29uc3RydWN0b3IodHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpKSB7XG4gICAgICAgIHN1cGVyKHdhbGxNb2RlbCwgV2FsbFRpbGUuY2hhcmFjdGVyLCBXYWxsVGlsZS5pc0NvbGxpZGFibGUsIHRyYW5zZm9ybSk7XG4gICAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FtZXJhIHtcbiAgICB0cmFuc2Zvcm07XG59XG4iLCJpbXBvcnQgeyB2MyB9IGZyb20gJ3R3Z2wuanMnO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29sb3Ige1xuICAgIHI7XG4gICAgZztcbiAgICBiO1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gUkdCIGNvbG9yIGZyb20gY29sb3IgY29tcG9uZW50cyByZXByZXNlbnRlZCBieSBkZWNpbWFsIG51bWJlcnNcbiAgICAgKiBiZXR3ZWVuIDAuMCBhbmQgMS4wXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcmVkIFJlZCBjb2xvciBjb21wb25lbnQgYmV0d2VlbiAwLjAgYW5kIDEuMFxuICAgICAqIEBwYXJhbSBncmVlbiBHcmVlbiBjb2xvciBjb21wb25lbnQgYmV0d2VlbiAwLjAgYW5kIDEuMFxuICAgICAqIEBwYXJhbSBibHVlIEJsdWUgY29sb3IgY29tcG9uZW50IGJldHdlZW4gMC4wIGFuZCAxLjBcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihyZWQsIGdyZWVuLCBibHVlKSB7XG4gICAgICAgIGlmIChyZWQgPCAwLjAgfHwgcmVkID4gMS4wXG4gICAgICAgICAgICB8fCBncmVlbiA8IDAuMCB8fCBncmVlbiA+IDEuMFxuICAgICAgICAgICAgfHwgYmx1ZSA8IDAuMCB8fCBibHVlID4gMS4wKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgQ29sb3IgY29tcG9uZW50IHJhbmdlIChvdXRzaWRlIDAuMC0xLjApJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yID0gcmVkO1xuICAgICAgICB0aGlzLmcgPSBncmVlbjtcbiAgICAgICAgdGhpcy5iID0gYmx1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYSBoZXggc3RyaW5nIHRvIGEgY29sb3IuIENhbiBiZSBwcm92aWRlZCBpbiBlaXRoZXIgc2l4IG9yIHRocmVlLWRpZ2l0XG4gICAgICogZm9ybWF0cy4gRXguICcjMDA5OUNDJyBvciAnIzA5QydcbiAgICAgKlxuICAgICAqIENhcGl0YWxpemF0aW9uIGlzIGlnbm9yZWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBoZXggSGV4IHN0cmluZyByZXByZXNlbnRpbmcgYSBjb2xvclxuICAgICAqL1xuICAgIHN0YXRpYyBmcm9tSGV4KGhleCkge1xuICAgICAgICBpZiAoaGV4Lmxlbmd0aCAhPT0gNyAmJiBoZXgubGVuZ3RoICE9PSA0KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgaGV4IHN0cmluZyBhcmd1bWVudCBpbiBDb2xvciBjcmVhdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIGxldCByZWRTdHJpbmc7XG4gICAgICAgIGxldCBncmVlblN0cmluZztcbiAgICAgICAgbGV0IGJsdWVTdHJpbmc7XG4gICAgICAgIGlmIChoZXgubGVuZ3RoID09PSA3KSB7XG4gICAgICAgICAgICByZWRTdHJpbmcgPSBoZXguc3Vic3RyaW5nKDEsIDMpO1xuICAgICAgICAgICAgZ3JlZW5TdHJpbmcgPSBoZXguc3Vic3RyaW5nKDMsIDUpO1xuICAgICAgICAgICAgYmx1ZVN0cmluZyA9IGhleC5zdWJzdHJpbmcoNSwgNyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZWRTdHJpbmcgPSBoZXhbMV0gKyBoZXhbMV07XG4gICAgICAgICAgICBncmVlblN0cmluZyA9IGhleFsyXSArIGhleFsyXTtcbiAgICAgICAgICAgIGJsdWVTdHJpbmcgPSBoZXhbM10gKyBoZXhbM107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVkID0gcGFyc2VJbnQocmVkU3RyaW5nLCAxNikgLyAyNTUuMDtcbiAgICAgICAgY29uc3QgZ3JlZW4gPSBwYXJzZUludChncmVlblN0cmluZywgMTYpIC8gMjU1LjA7XG4gICAgICAgIGNvbnN0IGJsdWUgPSBwYXJzZUludChibHVlU3RyaW5nLCAxNikgLyAyNTUuMDtcbiAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihyZWQsIGdyZWVuLCBibHVlKTtcbiAgICB9XG4gICAgdG9WZWMzKCkge1xuICAgICAgICByZXR1cm4gdjMuY3JlYXRlKHRoaXMuciwgdGhpcy5nLCB0aGlzLmIpO1xuICAgIH1cbn1cbiIsImltcG9ydCBGcmFtZVRpbWVQYW5lbCBmcm9tICcuLi91aS9GcmFtZVRpbWVQYW5lbCc7XG5pbXBvcnQgU2NlbmVQYW5lbCBmcm9tICcuLi91aS9zY2VuZS1wYW5lbC9TY2VuZVBhbmVsJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERlYnVnVUkge1xuICAgIHJlbmRlcmVyO1xuICAgIGNvbnRhaW5lcjtcbiAgICBmcmFtZVRpbWVQYW5lbDtcbiAgICBzY2VuZVBhbmVsO1xuICAgIGlzVmlzaWJsZTtcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlciwgY29udGFpbmVyLCBpc1Zpc2libGUgPSBmYWxzZSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgICB0aGlzLmlzVmlzaWJsZSA9IGlzVmlzaWJsZTtcbiAgICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7XG4gICAgICAgICAgICB0aGlzLnNob3coKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0b2dnbGVJbnB1dENhbGxiYWNrID0gKGV2KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXYua2V5ID09PSAnLicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVZpc2liaWxpdHkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0b2dnbGVJbnB1dENhbGxiYWNrKTtcbiAgICAgICAgaWYgKG1vZHVsZS5ob3QpIHtcbiAgICAgICAgICAgIG1vZHVsZS5ob3QuZGlzcG9zZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0b2dnbGVJbnB1dENhbGxiYWNrKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNob3coKSB7XG4gICAgICAgIHRoaXMuYmluZEZyYW1lVGltZVBhbmVsKCk7XG4gICAgICAgIHRoaXMuYmluZFNjZW5lUGFuZWwoKTtcbiAgICAgICAgdGhpcy5pc1Zpc2libGUgPSB0cnVlO1xuICAgIH1cbiAgICBoaWRlKCkge1xuICAgICAgICB0aGlzLnVuYmluZEZyYW1lVGltZVBhbmVsKCk7XG4gICAgICAgIHRoaXMudW5iaW5kU2NlbmVQYW5lbCgpO1xuICAgICAgICB0aGlzLmlzVmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cbiAgICB0b2dnbGVWaXNpYmlsaXR5KCkge1xuICAgICAgICBpZiAodGhpcy5pc1Zpc2libGUpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYmluZEZyYW1lVGltZVBhbmVsKCkge1xuICAgICAgICB0aGlzLmZyYW1lVGltZVBhbmVsID0gbmV3IEZyYW1lVGltZVBhbmVsKHRoaXMucmVuZGVyZXIpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuZnJhbWVUaW1lUGFuZWwuZWxlbWVudCk7XG4gICAgfVxuICAgIHVuYmluZEZyYW1lVGltZVBhbmVsKCkge1xuICAgICAgICBpZiAodGhpcy5mcmFtZVRpbWVQYW5lbCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmZyYW1lVGltZVBhbmVsLmVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVRpbWVQYW5lbC5jbGVhblVwKCk7XG4gICAgICAgICAgICB0aGlzLmZyYW1lVGltZVBhbmVsID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBiaW5kU2NlbmVQYW5lbCgpIHtcbiAgICAgICAgdGhpcy5zY2VuZVBhbmVsID0gbmV3IFNjZW5lUGFuZWwodGhpcy5yZW5kZXJlcik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuc2NlbmVQYW5lbCk7XG4gICAgfVxuICAgIHVuYmluZFNjZW5lUGFuZWwoKSB7XG4gICAgICAgIGlmICh0aGlzLnNjZW5lUGFuZWwpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuc2NlbmVQYW5lbCk7XG4gICAgICAgICAgICB0aGlzLnNjZW5lUGFuZWwgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgY3JlYXRlQnVmZmVySW5mb0Zyb21BcnJheXMsIH0gZnJvbSAndHdnbC5qcyc7XG4vKipcbiAqIEEgbGVzcy1nZW5lcmFsaXplZCBNZXNoIHJlcHJlc2VudGF0aW9uLiBGb3Igc2ltcGxpY2l0eSB3ZSBhcmUgc3RpY2tpbmcgd2l0aFxuICogaGF2aW5nIDMgYXR0cmlidXRlcyAocG9zaXRpb24sIG5vcm1hbCwgYW5kIHV2KSBhbG9uZ3NpZGUgdGhlIGluZGljZXMuXG4gKlxuICogVGhlc2UgYXR0cmlidXRlcyBhcmUgbWVhbnQgdG8gYmUgcGFzc2VkIGludG8gYSBzaGFkZXIgd2l0aCBzdGFuZGFyZCBuYW1lc1xuICogYXMgc2hvd24uXG4gKlxuICogWW91IG1heSBsZWF2ZSBvdXQgbm9ybWFsLCB1diwgb3IgaW5kaWNlcy5cbiAqXG4gKiBUaGUgbnVtYmVyIG9mIGNvbXBvbmVudHMgZm9yIHRoZXNlIG1lbWJlcnMgc2hvdWxkIGFsd2F5cyBiZTpcbiAqIC8tLS0tLS0tLS0tLS0tLVxcXG4gKiB8IHBvc2l0aW9uIHwgMyB8XG4gKiB8IG5vcm1hbCAgIHwgMyB8XG4gKiB8IHV2ICAgICAgIHwgMiB8XG4gKiB8IGluZGljZXMgIHwgMyB8XG4gKiBcXC0tLS0tLS0tLS0tLS0tL1xuICpcbiAqIFRoaXMgaXMgYSBjbGFzcyB0byBnZW5lcmFsaXplIGxhdGVyIG9uLCBhcyBpdHMgaW52YXJpYW50cyBhcmUgc3RpZmYuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lc2gge1xuICAgIHN0YXRpYyBOVU1fQ09NUE9ORU5UU19QT1NJVElPTiA9IDM7XG4gICAgc3RhdGljIE5VTV9DT01QT05FTlRTX05PUk1BTCA9IDM7XG4gICAgc3RhdGljIE5VTV9DT01QT05FTlRTX1VWID0gMjtcbiAgICBzdGF0aWMgTlVNX0NPTVBPTkVOVFNfSU5ESUNFUyA9IDM7XG4gICAgcG9zaXRpb247XG4gICAgbm9ybWFsO1xuICAgIHV2O1xuICAgIGluZGljZXM7XG4gICAgbmFtZTtcbiAgICBidWZmZXJJbmZvO1xuICAgIGFycmF5cztcbiAgICBjb25zdHJ1Y3Rvcihwb3NpdGlvbiwgbm9ybWFsLCB1diwgaW5kaWNlcywgbmFtZSkge1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIHRoaXMubm9ybWFsID0gbm9ybWFsO1xuICAgICAgICB0aGlzLnV2ID0gdXY7XG4gICAgICAgIHRoaXMuaW5kaWNlcyA9IGluZGljZXM7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxuICAgIGdldEFycmF5cygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmFycmF5cykge1xuICAgICAgICAgICAgdGhpcy5hcnJheXMgPSB0aGlzLmNyZWF0ZUFycmF5cygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmFycmF5cztcbiAgICB9XG4gICAgZ2V0QnVmZmVySW5mbyhnbCkge1xuICAgICAgICBpZiAoIXRoaXMuYnVmZmVySW5mbykge1xuICAgICAgICAgICAgdGhpcy5idWZmZXJJbmZvID0gY3JlYXRlQnVmZmVySW5mb0Zyb21BcnJheXMoZ2wsIHRoaXMuY3JlYXRlQXJyYXlzKCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlckluZm87XG4gICAgfVxuICAgIGNyZWF0ZUFycmF5cygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgbnVtQ29tcG9uZW50czogTWVzaC5OVU1fQ09NUE9ORU5UU19QT1NJVElPTixcbiAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLnBvc2l0aW9uLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC4uLih0aGlzLm5vcm1hbCAmJiB7XG4gICAgICAgICAgICAgICAgbm9ybWFsOiB7XG4gICAgICAgICAgICAgICAgICAgIG51bUNvbXBvbmVudHM6IE1lc2guTlVNX0NPTVBPTkVOVFNfTk9STUFMLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLm5vcm1hbCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAuLi4odGhpcy51diAmJiB7XG4gICAgICAgICAgICAgICAgdXY6IHtcbiAgICAgICAgICAgICAgICAgICAgbnVtQ29tcG9uZW50czogTWVzaC5OVU1fQ09NUE9ORU5UU19VVixcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy51dixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAuLi4odGhpcy5pbmRpY2VzICYmIHtcbiAgICAgICAgICAgICAgICBpbmRpY2VzOiB7XG4gICAgICAgICAgICAgICAgICAgIG51bUNvbXBvbmVudHM6IE1lc2guTlVNX0NPTVBPTkVOVFNfSU5ESUNFUyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5pbmRpY2VzLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfTtcbiAgICB9XG59XG4iLCJpbXBvcnQgU2NlbmVOb2RlIGZyb20gJy4vU2NlbmVOb2RlJztcbmltcG9ydCBUcmFuc2Zvcm0gZnJvbSAnLi9UcmFuc2Zvcm0nO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVzaE5vZGUgZXh0ZW5kcyBTY2VuZU5vZGUge1xuICAgIG1lc2g7XG4gICAgbWF0ZXJpYWw7XG4gICAgc3RhdGljIG51bU1lc2hOb2RlcyA9IDA7XG4gICAgY29uc3RydWN0b3IodHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpLCBtZXNoLCBtYXRlcmlhbCwgbmFtZSkge1xuICAgICAgICBjb25zdCBkZWZhdWx0TmFtZSA9IGBtZXNoTm9kZSMke01lc2hOb2RlLm51bU1lc2hOb2Rlc31gO1xuICAgICAgICBsZXQgY29tcHV0ZWROYW1lO1xuICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgY29tcHV0ZWROYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtZXNoLm5hbWUpIHtcbiAgICAgICAgICAgIGNvbXB1dGVkTmFtZSA9IGAke21lc2gubmFtZX0tJHtkZWZhdWx0TmFtZX1gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29tcHV0ZWROYW1lID0gZGVmYXVsdE5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIoY29tcHV0ZWROYW1lLCB0cmFuc2Zvcm0pO1xuICAgICAgICB0aGlzLm1lc2ggPSBtZXNoO1xuICAgICAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7XG4gICAgICAgIE1lc2hOb2RlLm51bU1lc2hOb2RlcyArPSAxO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IE1lc2ggYXMgVEhSRUVNZXNoIH0gZnJvbSAndGhyZWUnO1xuaW1wb3J0IHsgT0JKTG9hZGVyIH0gZnJvbSAndGhyZWUvZXhhbXBsZXMvanNtL2xvYWRlcnMvT0JKTG9hZGVyJztcbmltcG9ydCAqIGFzIFBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgTWVzaCBmcm9tICcuL01lc2gnO1xuaW1wb3J0IE1lc2hOb2RlIGZyb20gJy4vTWVzaE5vZGUnO1xuaW1wb3J0IFRyYW5zZm9ybSBmcm9tICcuL1RyYW5zZm9ybSc7XG5pbXBvcnQgeyBNYXRlcmlhbCB9IGZyb20gJy4vbWF0ZXJpYWxzL19NYXRlcmlhbEludGVybmFsJztcbmltcG9ydCBNb2RlbE5vZGUgZnJvbSAnLi9Nb2RlbE5vZGUnO1xuLyoqXG4gKiBDbGFzcyB0aGF0IGhvbGRzIG1vZGVsIGRhdGEuXG4gKlxuICogQSBNb2RlbCBpbnN0YW5jZSBpcyBhIHN0cnVjdHVyZSBjb250YWluaW5nIHRoZSBtZXNoZXMgYW5kIG1hdGVyaWFsXG4gKiB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGVhY2ggbWVzaC5cbiAqXG4gKiBUaGVyZSBzaG91bGQgb25seSBiZSBvbmUgTW9kZWwgaW5zdGFuY2UgZm9yIGVhY2ggM0QgbW9kZWwgeW91XG4gKiB3YW50IHRvIGxvYWQgaW4gdGhlIGdhbWUuIFlvdSBjYW4gdXNlIHRoZSBgY3JlYXRlTW9kZWxOb2RlYFxuICogbWV0aG9kIHRvIGdlbmVyYXRlIGEgTW9kZWxOb2RlIHdpdGggTWVzaE5vZGUgY2hpbGRyZW4gcmVhZHlcbiAqIGZvciBwbGFjZW1lbnQgaW4gYSBzY2VuZS5cbiAqXG4gKiBOT1RFOiBDdXJyZW50bHkgb25seSBzdXBwb3J0cyBPQkogbW9kZWxzLlxuICpcbiAqIFRPRE86IFN1cHBvcnQgbW9yZSB0aGFuIGp1c3QgT0JKIG1vZGVscyAocHJvYmFibHkgR0xURiAvIEdMQiBmaXJzdClcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kZWwge1xuICAgIHN0YXRpYyBjYWNoZSA9IG5ldyBNYXAoKTtcbiAgICBzdGF0aWMgbnVtTW9kZWxzID0gMDtcbiAgICBtZXNoZXM7XG4gICAgbWF0ZXJpYWw7XG4gICAgZXh0ZW50cztcbiAgICBuYW1lO1xuICAgIGNvbnN0cnVjdG9yKG1lc2hlcywgbWF0ZXJpYWwsIG5hbWUpIHtcbiAgICAgICAgdGhpcy5tZXNoZXMgPSBtZXNoZXM7XG4gICAgICAgIHRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbDtcbiAgICAgICAgdGhpcy5leHRlbnRzID0gdGhpcy5jYWxjTW9kZWxFeHRlbnRzKCk7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWUgPz8gYG1vZGVsIyR7TW9kZWwubnVtTW9kZWxzfWA7XG4gICAgICAgIE1vZGVsLm51bU1vZGVscyArPSAxO1xuICAgIH1cbiAgICBjcmVhdGVNb2RlbE5vZGUodHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpKSB7XG4gICAgICAgIGNvbnN0IG1vZGVsTm9kZSA9IG5ldyBNb2RlbE5vZGUodGhpcywgdHJhbnNmb3JtLCB0aGlzLm5hbWUpO1xuICAgICAgICB0aGlzLm1lc2hlcy5mb3JFYWNoKChtZXNoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtZXNoTm9kZSA9IG5ldyBNZXNoTm9kZShuZXcgVHJhbnNmb3JtKCksIG1lc2gsIHRoaXMubWF0ZXJpYWwpO1xuICAgICAgICAgICAgbW9kZWxOb2RlLmFkZENoaWxkKG1lc2hOb2RlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBtb2RlbE5vZGU7XG4gICAgfVxuICAgIGNhbGNNb2RlbEV4dGVudHMoKSB7XG4gICAgICAgIGlmICh0aGlzLm1lc2hlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG1pblg6IDAsXG4gICAgICAgICAgICAgICAgbWF4WDogMCxcbiAgICAgICAgICAgICAgICBtaW5ZOiAwLFxuICAgICAgICAgICAgICAgIG1heFk6IDAsXG4gICAgICAgICAgICAgICAgbWluWjogMCxcbiAgICAgICAgICAgICAgICBtYXhaOiAwLFxuICAgICAgICAgICAgICAgIHhMZW46IDAsXG4gICAgICAgICAgICAgICAgeUxlbjogMCxcbiAgICAgICAgICAgICAgICB6TGVuOiAwLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbWluWCA9IHRoaXMubWVzaGVzWzBdLnBvc2l0aW9uWzBdO1xuICAgICAgICBsZXQgbWF4WCA9IHRoaXMubWVzaGVzWzBdLnBvc2l0aW9uWzBdO1xuICAgICAgICBsZXQgbWluWSA9IHRoaXMubWVzaGVzWzBdLnBvc2l0aW9uWzFdO1xuICAgICAgICBsZXQgbWF4WSA9IHRoaXMubWVzaGVzWzBdLnBvc2l0aW9uWzFdO1xuICAgICAgICBsZXQgbWluWiA9IHRoaXMubWVzaGVzWzBdLnBvc2l0aW9uWzJdO1xuICAgICAgICBsZXQgbWF4WiA9IHRoaXMubWVzaGVzWzBdLnBvc2l0aW9uWzJdO1xuICAgICAgICB0aGlzLm1lc2hlcy5mb3JFYWNoKChtZXNoKSA9PiB7XG4gICAgICAgICAgICBtZXNoLnBvc2l0aW9uLmZvckVhY2goKHYsIGopID0+IHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGogJSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2IDwgbWluWClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5YID0gdjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHYgPiBtYXhYKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFggPSB2O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2IDwgbWluWSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5ZID0gdjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHYgPiBtYXhZKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFkgPSB2O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2IDwgbWluWilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5aID0gdjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHYgPiBtYXhaKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFogPSB2O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgc2hvdWxkbnQgaGFwcGVuIGJlY2F1c2UuLi5tYXRoJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWluWCxcbiAgICAgICAgICAgIG1heFgsXG4gICAgICAgICAgICBtaW5ZLFxuICAgICAgICAgICAgbWF4WSxcbiAgICAgICAgICAgIG1pblosXG4gICAgICAgICAgICBtYXhaLFxuICAgICAgICAgICAgeExlbjogbWF4WCAtIG1pblgsXG4gICAgICAgICAgICB5TGVuOiBtYXhZIC0gbWluWSxcbiAgICAgICAgICAgIHpMZW46IG1heFogLSBtaW5aLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBzdGF0aWMgY3JlYXRlTWVzaEFycmF5KG1vZGVsKSB7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW4gfSA9IG1vZGVsO1xuICAgICAgICAvLyBDcmVhdGUgbWVzaGVzIGZvciB0aGUgZmlyc3QgbGV2ZWwgbWVzaCBjaGlsZHJlblxuICAgICAgICAvLyBUT0RPOiAoTG93IFByaW9yaXR5KSBTdXBwb3J0IG11bHRpLWxldmVsIGhpZXJhcmNoeSBvZiBtZXNoZXM/IFdlIG1pZ2h0IG5vdCBuZWVkIHRoaXNcbiAgICAgICAgY29uc3QgbWVzaGVzID0gY2hpbGRyZW4uZmlsdGVyKChjaGlsZCkgPT4gY2hpbGQgaW5zdGFuY2VvZiBUSFJFRU1lc2gpXG4gICAgICAgICAgICAubWFwKChjaGlsZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBnZW9tZXRyeSB9ID0gY2hpbGQ7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE1lc2gobmV3IEZsb2F0MzJBcnJheShnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJykuYXJyYXkpLCBuZXcgRmxvYXQzMkFycmF5KGdlb21ldHJ5LmdldEF0dHJpYnV0ZSgnbm9ybWFsJykuYXJyYXkpLCBuZXcgRmxvYXQzMkFycmF5KGdlb21ldHJ5LmdldEF0dHJpYnV0ZSgndXYnKS5hcnJheSksIG51bGwsIGNoaWxkLm5hbWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG1lc2hlcztcbiAgICB9XG4gICAgc3RhdGljIGFzeW5jIGZyb21VUkwobW9kZWxfdXJsLCBtYXRlcmlhbCwgbmFtZSkge1xuICAgICAgICBjb25zdCBsb2FkZXIgPSBuZXcgT0JKTG9hZGVyKCk7XG4gICAgICAgIGNvbnN0IGxvYWRlZE1vZGVsID0gYXdhaXQgbG9hZGVyLmxvYWRBc3luYyhtb2RlbF91cmwpO1xuICAgICAgICBjb25zdCBtZXNoTm9kZXMgPSBNb2RlbC5jcmVhdGVNZXNoQXJyYXkobG9hZGVkTW9kZWwpO1xuICAgICAgICByZXR1cm4gbmV3IE1vZGVsKG1lc2hOb2RlcywgbWF0ZXJpYWwsIG5hbWUpO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgbG9hZCh1cmwpIHtcbiAgICAgICAgaWYgKHRoaXMuY2FjaGUuaGFzKHVybCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhY2hlLmdldCh1cmwpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbmZpZ1JlcXVlc3QgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICAgICAgICBjb25zdCBtb2RlbENvbmZpZyA9IChhd2FpdCBjb25maWdSZXF1ZXN0Lmpzb24oKSk7XG4gICAgICAgIGNvbnN0IGRpciA9IFBhdGguZGlybmFtZSh1cmwpO1xuICAgICAgICAvLyBMb2FkIHRoZSBtb2RlbCBmaWxlXG4gICAgICAgIGNvbnN0IG1vZGVsVXJsID0gUGF0aC5yZXNvbHZlKGRpciwgbW9kZWxDb25maWcubW9kZWwpO1xuICAgICAgICBjb25zdCBsb2FkZXIgPSBuZXcgT0JKTG9hZGVyKCk7XG4gICAgICAgIGNvbnN0IGxvYWRlZE1vZGVsID0gYXdhaXQgbG9hZGVyLmxvYWRBc3luYyhtb2RlbFVybCk7XG4gICAgICAgIGNvbnN0IG1lc2hlcyA9IE1vZGVsLmNyZWF0ZU1lc2hBcnJheShsb2FkZWRNb2RlbCk7XG4gICAgICAgIC8vIExvYWQgdGhlIG1hdGVyaWFsXG4gICAgICAgIGNvbnN0IG1hdGVyaWFsVXJsID0gUGF0aC5yZXNvbHZlKGRpciwgbW9kZWxDb25maWcubWF0ZXJpYWwpO1xuICAgICAgICBjb25zdCBtYXRlcmlhbCA9IGF3YWl0IE1hdGVyaWFsLmxvYWQobWF0ZXJpYWxVcmwpO1xuICAgICAgICBjb25zdCBtb2RlbCA9IG5ldyBNb2RlbChtZXNoZXMsIG1hdGVyaWFsLCBtb2RlbENvbmZpZy5uYW1lKTtcbiAgICAgICAgdGhpcy5jYWNoZS5zZXQodXJsLCBtb2RlbCk7XG4gICAgICAgIHJldHVybiBtb2RlbDtcbiAgICB9XG59XG4iLCJpbXBvcnQgU2NlbmVOb2RlIGZyb20gJy4vU2NlbmVOb2RlJztcbi8qKlxuICogQSBzaW1wbGUgbm9kZSB0eXBlIHRoYXQgcmVwcmVzZW50cyBhIHNjZW5lIGluc3RhbmNlIG9mIGEgTW9kZWwuXG4gKlxuICogVGhpcyBub2RlIHdpbGwgY29udGFpbiBNZXNoTm9kZSBjaGlsZHJlbiB0aGF0IHdlcmUgbG9hZGVkIGZyb21cbiAqIHRoZSBtZXNoZXMgb2YgdGhlIE1vZGVsLlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RlbE5vZGUgZXh0ZW5kcyBTY2VuZU5vZGUge1xuICAgIG1vZGVsO1xuICAgIHN0YXRpYyBudW1Nb2RlbE5vZGVzID0gMDtcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbCwgdHJhbnNmb3JtLCBuYW1lID0gYG1vZGVsTm9kZSMke01vZGVsTm9kZS5udW1Nb2RlbE5vZGVzfWApIHtcbiAgICAgICAgc3VwZXIobmFtZSwgdHJhbnNmb3JtKTtcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICBNb2RlbE5vZGUubnVtTW9kZWxOb2RlcyArPSAxO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IG00IH0gZnJvbSAndHdnbC5qcyc7XG5pbXBvcnQgeyB0b1JhZGlhbnMgfSBmcm9tICcuLi91dGlsL01hdGgnO1xuaW1wb3J0IENhbWVyYSBmcm9tICcuL0NhbWVyYSc7XG5pbXBvcnQgVHJhbnNmb3JtIGZyb20gJy4vVHJhbnNmb3JtJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBlcnNwZWN0aXZlQ2FtZXJhIGV4dGVuZHMgQ2FtZXJhIHtcbiAgICBmb3Y7XG4gICAgYXNwZWN0O1xuICAgIHpOZWFyO1xuICAgIHpGYXI7XG4gICAgY29uc3RydWN0b3IodHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpLCBmb3YgPSA2MCwgYXNwZWN0ID0gMSwgek5lYXIgPSAwLjEsIHpGYXIgPSAxMDAwKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMudHJhbnNmb3JtID0gdHJhbnNmb3JtO1xuICAgICAgICB0aGlzLmZvdiA9IGZvdjtcbiAgICAgICAgdGhpcy5hc3BlY3QgPSBhc3BlY3Q7XG4gICAgICAgIHRoaXMuek5lYXIgPSB6TmVhcjtcbiAgICAgICAgdGhpcy56RmFyID0gekZhcjtcbiAgICB9XG4gICAgZ2V0Vmlld1Byb2plY3Rpb25NYXRyaXgoKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3Rpb25NYXRyaXggPSB0aGlzLmdldFByb2plY3Rpb25NYXRyaXgoKTtcbiAgICAgICAgY29uc3Qgdmlld01hdHJpeCA9IHRoaXMuZ2V0Vmlld01hdHJpeCgpO1xuICAgICAgICByZXR1cm4gbTQubXVsdGlwbHkocHJvamVjdGlvbk1hdHJpeCwgdmlld01hdHJpeCk7XG4gICAgfVxuICAgIGdldFByb2plY3Rpb25NYXRyaXgoKSB7XG4gICAgICAgIHJldHVybiBtNC5wZXJzcGVjdGl2ZSh0b1JhZGlhbnModGhpcy5mb3YpLCB0aGlzLmFzcGVjdCwgdGhpcy56TmVhciwgdGhpcy56RmFyKTtcbiAgICB9XG4gICAgZ2V0Vmlld01hdHJpeCgpIHtcbiAgICAgICAgcmV0dXJuIG00LmludmVyc2UodGhpcy50cmFuc2Zvcm0uZ2V0TWF0cml4KCkpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IGNyZWF0ZUJ1ZmZlckluZm9Gcm9tQXJyYXlzLCBkcmF3QnVmZmVySW5mbywgbTQsIHJlc2l6ZUNhbnZhc1RvRGlzcGxheVNpemUsIHNldEJ1ZmZlcnNBbmRBdHRyaWJ1dGVzLCBzZXRVbmlmb3JtcywgY3JlYXRlVmVydGV4QXJyYXlJbmZvLCB9IGZyb20gJ3R3Z2wuanMnO1xuaW1wb3J0IE1lc2hOb2RlIGZyb20gJy4vTWVzaE5vZGUnO1xuaW1wb3J0IFBlcnNwZWN0aXZlQ2FtZXJhIGZyb20gJy4vUGVyc3BlY3RpdmVDYW1lcmEnO1xuaW1wb3J0IFNjZW5lIGZyb20gJy4vU2NlbmUnO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVuZGVyZXIge1xuICAgIGdsO1xuICAgIHNjZW5lO1xuICAgIGNhbWVyYTtcbiAgICByZW5kZXJlclVuaWZvcm1zO1xuICAgIHVwZGF0ZUNhbGxiYWNrcyA9IG5ldyBTZXQoKTtcbiAgICAvLyBUaW1lIGluIG1zIHRoZSBsYXN0IGZyYW1lIHRvb2sgdG8gcmVuZGVyXG4gICAgZnJhbWVUaW1lID0gMDtcbiAgICBhbmltYXRpb25SZXF1ZXN0SWQ7XG4gICAgcHJldmlvdXNUaW1lO1xuICAgIHJlbmRlck1hcDtcbiAgICBjb25zdHJ1Y3RvcihnbCwgc2NlbmUgPSBuZXcgU2NlbmUoKSwgY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCkpIHtcbiAgICAgICAgdGhpcy5nbCA9IGdsO1xuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XG4gICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhO1xuICAgICAgICB0aGlzLnJlbmRlck1hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgLy8gQ29udGVudCBpbml0aWFsaXphdGlvblxuICAgICAgICBnbC5jbGVhckNvbG9yKDAuMiwgMC4wNzUsIDAuMCwgMS4wKTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpO1xuICAgICAgICBnbC5lbmFibGUoZ2wuREVQVEhfVEVTVCk7XG4gICAgICAgIGdsLmVuYWJsZShnbC5DVUxMX0ZBQ0UpO1xuICAgIH1cbiAgICBkcmF3U2NlbmUodGltZSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyVW5pZm9ybXMgPSB7XG4gICAgICAgICAgICB1X3RpbWU6IHRpbWUgKiAwLjAwMSxcbiAgICAgICAgICAgIHVfcmVzb2x1dGlvbjogW3RoaXMuZ2wuY2FudmFzLndpZHRoLCB0aGlzLmdsLmNhbnZhcy5oZWlnaHRdLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlbmRlck1hcC5jbGVhcigpO1xuICAgICAgICB0aGlzLnByb2Nlc3NOb2RlKHRoaXMuc2NlbmUucm9vdCwgbTQuaWRlbnRpdHkoKSk7XG4gICAgICAgIC8vIFJlbmRlciBmcm9tIHJlbmRlck1hcCAoZm9yIGVhY2ggbWF0ZXJpYWwgdHlwZSlcbiAgICAgICAgdGhpcy5yZW5kZXJNYXAuZm9yRWFjaCgobWVzaE1hcCwgc2hhZGVyKSA9PiB7XG4gICAgICAgICAgICAvLyBlYWNoIHVuaXF1ZSBtZXNoXG4gICAgICAgICAgICBtZXNoTWFwLmZvckVhY2goKG1lc2hOb2RlSW5zdGFuY2VzLCBtZXNoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFtZXNoTm9kZUluc3RhbmNlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHByb2dyYW1JbmZvID0gc2hhZGVyLmdldFByb2dyYW1JbmZvKHRoaXMuZ2wpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2wudXNlUHJvZ3JhbShwcm9ncmFtSW5mby5wcm9ncmFtKTtcbiAgICAgICAgICAgICAgICAvLyBDb21wdXRlIG1hdHJpeFxuICAgICAgICAgICAgICAgIGNvbnN0IGNhbWVyYU1hdHJpeCA9IHRoaXMuY2FtZXJhLmdldFZpZXdQcm9qZWN0aW9uTWF0cml4KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZXllUG9zaXRpb24gPSBtNC5pbnZlcnNlKHRoaXMuY2FtZXJhLmdldFZpZXdNYXRyaXgoKSkuc2xpY2UoMTIsIDE1KTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZU5vZGUgPSBtZXNoTm9kZUluc3RhbmNlc1swXS5ub2RlO1xuICAgICAgICAgICAgICAgIC8vIFNldCBhbGwgdW5pZm9ybXNcbiAgICAgICAgICAgICAgICBzZXRVbmlmb3Jtcyhwcm9ncmFtSW5mbywgW1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyVW5pZm9ybXMsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlTm9kZS5tYXRlcmlhbC51bmlmb3JtcyxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdV9leWVQb3NpdGlvbjogZXllUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB1X2NhbWVyYU1hdHJpeDogY2FtZXJhTWF0cml4LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdHJpY2VzID0gbmV3IEZsb2F0MzJBcnJheSgxNiAqIG1lc2hOb2RlSW5zdGFuY2VzLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgbWVzaE5vZGVJbnN0YW5jZXMuZm9yRWFjaCgoaW5zdGFuY2UsIGkpID0+IG1hdHJpY2VzLnNldChpbnN0YW5jZS5tYXRyaXgsIGkgKiAxNikpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ubWVzaC5nZXRBcnJheXMoKSxcbiAgICAgICAgICAgICAgICAgICAgYV9tYXRyaXg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bUNvbXBvbmVudHM6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogbWF0cmljZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZpc29yOiAxLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY29uc3QgYnVmZmVySW5mbyA9IGNyZWF0ZUJ1ZmZlckluZm9Gcm9tQXJyYXlzKHRoaXMuZ2wsIGFycmF5cyk7XG4gICAgICAgICAgICAgICAgY29uc3QgdmVydGV4QXJyYXlJbmZvID0gY3JlYXRlVmVydGV4QXJyYXlJbmZvKHRoaXMuZ2wsIHByb2dyYW1JbmZvLCBidWZmZXJJbmZvKTtcbiAgICAgICAgICAgICAgICBzZXRCdWZmZXJzQW5kQXR0cmlidXRlcyh0aGlzLmdsLCBwcm9ncmFtSW5mbywgdmVydGV4QXJyYXlJbmZvKTtcbiAgICAgICAgICAgICAgICBkcmF3QnVmZmVySW5mbyh0aGlzLmdsLCB2ZXJ0ZXhBcnJheUluZm8sIHRoaXMuZ2wuVFJJQU5HTEVTLCB2ZXJ0ZXhBcnJheUluZm8ubnVtRWxlbWVudHMsIDAsIG1lc2hOb2RlSW5zdGFuY2VzLmxlbmd0aCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByb2Nlc3NOb2RlKG5vZGUsIHBhcmVudE1hdHJpeCkge1xuICAgICAgICAvLyBDb21wdXRlIHRoaXMgbm9kZSdzIG1hdHJpeFxuICAgICAgICBsZXQgbWF0cml4ID0gbm9kZS5sb2NhbFRyYW5zZm9ybS5nZXRNYXRyaXgoKTtcbiAgICAgICAgbWF0cml4ID0gbTQubXVsdGlwbHkocGFyZW50TWF0cml4LCBtYXRyaXgpO1xuICAgICAgICAvLyBQcm9jZXNzIHNlbGZcbiAgICAgICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBNZXNoTm9kZSkge1xuICAgICAgICAgICAgY29uc3QgeyBzaGFkZXIgfSA9IG5vZGUubWF0ZXJpYWw7XG4gICAgICAgICAgICBpZiAoIXRoaXMucmVuZGVyTWFwLmhhcyhzaGFkZXIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJNYXAuc2V0KHNoYWRlciwgbmV3IE1hcCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNoYWRlck1lc2hNYXAgPSB0aGlzLnJlbmRlck1hcC5nZXQoc2hhZGVyKTtcbiAgICAgICAgICAgIGlmICghc2hhZGVyTWVzaE1hcC5oYXMobm9kZS5tZXNoKSkge1xuICAgICAgICAgICAgICAgIHNoYWRlck1lc2hNYXAuc2V0KG5vZGUubWVzaCwgbmV3IEFycmF5KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbWVzaE5vZGVJbnN0YW5jZXMgPSBzaGFkZXJNZXNoTWFwLmdldChub2RlLm1lc2gpO1xuICAgICAgICAgICAgbWVzaE5vZGVJbnN0YW5jZXMucHVzaCh7IG5vZGUsIG1hdHJpeCB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiAobm9kZSBpbnN0YW5jZW9mIE1lc2hOb2RlKSB7XG4gICAgICAgIC8vICAgLy8gR2V0IHRoZSBtZXNoJ3MgYnVmZmVyIGluZm9cbiAgICAgICAgLy8gICBjb25zdCBidWZmZXJJbmZvID0gbm9kZS5tZXNoLmdldEJ1ZmZlckluZm8odGhpcy5nbCk7XG4gICAgICAgIC8vICAgY29uc3QgcHJvZ3JhbUluZm8gPSBub2RlLm1hdGVyaWFsLnNoYWRlci5nZXRQcm9ncmFtSW5mbyh0aGlzLmdsKTtcbiAgICAgICAgLy8gICB0aGlzLmdsLnVzZVByb2dyYW0ocHJvZ3JhbUluZm8ucHJvZ3JhbSk7XG4gICAgICAgIC8vICAgc2V0QnVmZmVyc0FuZEF0dHJpYnV0ZXModGhpcy5nbCwgcHJvZ3JhbUluZm8sIGJ1ZmZlckluZm8pO1xuICAgICAgICAvLyAgIC8vIENvbXB1dGUgbWF0cml4XG4gICAgICAgIC8vICAgY29uc3QgY2FtZXJhTWF0cml4ID0gdGhpcy5jYW1lcmEuZ2V0Vmlld1Byb2plY3Rpb25NYXRyaXgoKTtcbiAgICAgICAgLy8gICBjb25zdCBwcm9qZWN0ZWRNYXRyaXggPSBtNC5tdWx0aXBseSh0aGlzLmNhbWVyYS5nZXRWaWV3UHJvamVjdGlvbk1hdHJpeCgpLCBtYXRyaXgpO1xuICAgICAgICAvLyAgIGNvbnN0IGV5ZVBvc2l0aW9uID0gbTQuaW52ZXJzZSh0aGlzLmNhbWVyYS5nZXRWaWV3TWF0cml4KCkpLnNsaWNlKDEyLCAxNSk7XG4gICAgICAgIC8vICAgLy8gU2V0IGFsbCB1bmlmb3Jtc1xuICAgICAgICAvLyAgIHNldFVuaWZvcm1zKHByb2dyYW1JbmZvLCBbXG4gICAgICAgIC8vICAgICB0aGlzLnJlbmRlcmVyVW5pZm9ybXMsXG4gICAgICAgIC8vICAgICBub2RlLm1hdGVyaWFsLnVuaWZvcm1zLFxuICAgICAgICAvLyAgICAge1xuICAgICAgICAvLyAgICAgICB1X2V5ZVBvc2l0aW9uOiBleWVQb3NpdGlvbixcbiAgICAgICAgLy8gICAgICAgdV9jYW1lcmFNYXRyaXg6IGNhbWVyYU1hdHJpeCxcbiAgICAgICAgLy8gICAgIH0sXG4gICAgICAgIC8vICAgXSk7XG4gICAgICAgIC8vICAgLy8gUmVuZGVyXG4gICAgICAgIC8vICAgZHJhd0J1ZmZlckluZm8odGhpcy5nbCwgYnVmZmVySW5mbyk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgLy8gUHJvY2VzcyBhbGwgY2hpbGRyZW5cbiAgICAgICAgbm9kZS5nZXRDaGlsZHJlbigpLmZvckVhY2goKGNoaWxkKSA9PiB0aGlzLnByb2Nlc3NOb2RlKGNoaWxkLCBtYXRyaXgpKTtcbiAgICB9XG4gICAgYWRkVXBkYXRlQ2FsbGJhY2soY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy51cGRhdGVDYWxsYmFja3MuYWRkKGNhbGxiYWNrKTtcbiAgICB9XG4gICAgcmVtb3ZlVXBkYXRlQ2FsbGJhY2soY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKCF0aGlzLnVwZGF0ZUNhbGxiYWNrcy5oYXMoY2FsbGJhY2spKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVDYWxsYmFja3MuZGVsZXRlKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHByZVJlbmRlcihkZWx0YVRpbWUpIHtcbiAgICAgICAgdGhpcy51cGRhdGVDYWxsYmFja3MuZm9yRWFjaCgoY2FsbGJhY2spID0+IGNhbGxiYWNrKGRlbHRhVGltZSkpO1xuICAgIH1cbiAgICByZW5kZXIodGltZSkge1xuICAgICAgICBjb25zdCBkZWx0YVRpbWUgPSB0aGlzLnByZXZpb3VzVGltZSA/IHRpbWUgLSB0aGlzLnByZXZpb3VzVGltZSA6IDA7XG4gICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICB0aGlzLnByZVJlbmRlcihkZWx0YVRpbWUpO1xuICAgICAgICByZXNpemVDYW52YXNUb0Rpc3BsYXlTaXplKHRoaXMuZ2wuY2FudmFzKTtcbiAgICAgICAgdGhpcy5nbC52aWV3cG9ydCgwLCAwLCB0aGlzLmdsLmNhbnZhcy53aWR0aCwgdGhpcy5nbC5jYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5nbC5jbGVhcih0aGlzLmdsLkNPTE9SX0JVRkZFUl9CSVQpO1xuICAgICAgICB0aGlzLmRyYXdTY2VuZSh0aW1lKTtcbiAgICAgICAgY29uc3QgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICB0aGlzLmZyYW1lVGltZSA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG4gICAgICAgIHRoaXMucHJldmlvdXNUaW1lID0gdGltZTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25SZXF1ZXN0SWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKG5ld1RpbWUpID0+IHRoaXMucmVuZGVyKG5ld1RpbWUpKTtcbiAgICB9XG4gICAgc3RvcFJlbmRlcmluZygpIHtcbiAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5hbmltYXRpb25SZXF1ZXN0SWQpO1xuICAgIH1cbn1cbiIsImltcG9ydCBTY2VuZU5vZGUgZnJvbSAnLi9TY2VuZU5vZGUnO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2NlbmUge1xuICAgIHJvb3Q7XG4gICAgY29uc3RydWN0b3Iocm9vdCA9IG5ldyBTY2VuZU5vZGUoKSkge1xuICAgICAgICB0aGlzLnJvb3QgPSByb290O1xuICAgIH1cbiAgICAvKipcbiAgICAgICAqIEFkZHMgYSBub2RlIHRvIHRoZSByb290IG5vZGUgb2YgdGhpcyBTY2VuZS5cbiAgICAgICAqXG4gICAgICAgKiBMYXp5IHdheSBvZiBkb2luZyBgc2NlbmUucm9vdC5hZGRDaGlsZCgpYC5cbiAgICAgICAqL1xuICAgIGFkZE5vZGUobm9kZSkge1xuICAgICAgICB0aGlzLnJvb3QuYWRkQ2hpbGQobm9kZSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgdjMgfSBmcm9tICd0d2dsLmpzJztcbmltcG9ydCBUcmFuc2Zvcm0gZnJvbSAnLi9UcmFuc2Zvcm0nO1xuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBub2RlcyB0aGF0IGluaGFiaXQgYSB7QGxpbmsgU2NlbmV9XG4gKlxuICogU2NlbmVOb2RlcyBjYW4gaGF2ZSBjaGlsZHJlbiBvZiB0aGUgc2FtZSB0eXBlLCB3aGljaCBmb3JtcyB0aGUgYmFzaXMgb2YgYSBTY2VuZSBHcmFwaFxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY2VuZU5vZGUge1xuICAgIC8vIFRoaXMgbm9kZSdzIHRyYW5zZm9ybSBpcyByZWxhdGl2ZSB0byBpdHMgcGFyZW50XG4gICAgbG9jYWxUcmFuc2Zvcm07XG4gICAgbmFtZTtcbiAgICAvLyBUaGVzZSBhcmUgcHJpdmF0ZSBiZWNhdXNlIHRoZXkgc2hvdWxkbid0IGJlIG1vZGlmaWVkIGJ5IHVzZXJzLlxuICAgIC8vIFBhcmVudCBpcyBzZXQgd2hlbiBhZGRpbmcgY2hpbGRyZW4gdG8gbm9kZXMuXG4gICAgcGFyZW50O1xuICAgIGNoaWxkcmVuO1xuICAgIC8vIENvdW50ZXIgZm9yIHRoZSBudW1iZXIgb2Ygc2NlbmUgbm9kZXMgY3JlYXRlZCB0aGlzIHNlc3Npb25cbiAgICBzdGF0aWMgc2NlbmVOb2RlcyA9IDA7XG4gICAgY29uc3RydWN0b3IobmFtZSwgbG9jYWxUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCkpIHtcbiAgICAgICAgdGhpcy5sb2NhbFRyYW5zZm9ybSA9IGxvY2FsVHJhbnNmb3JtO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lID8/IGBzY2VuZU5vZGUjJHtTY2VuZU5vZGUuc2NlbmVOb2Rlc31gO1xuICAgICAgICB0aGlzLmNoaWxkcmVuID0gbmV3IFNldCgpO1xuICAgICAgICBTY2VuZU5vZGUuc2NlbmVOb2RlcyArPSAxO1xuICAgIH1cbiAgICBnZXRQYXJlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudDtcbiAgICB9XG4gICAgZ2V0Q2hpbGRyZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuO1xuICAgIH1cbiAgICBhZGRDaGlsZChub2RlKSB7XG4gICAgICAgIGlmIChub2RlLnBhcmVudCkge1xuICAgICAgICAgICAgbm9kZS5wYXJlbnQucmVtb3ZlQ2hpbGQobm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgbm9kZS5wYXJlbnQgPSB0aGlzO1xuICAgICAgICB0aGlzLmNoaWxkcmVuLmFkZChub2RlKTtcbiAgICB9XG4gICAgcmVtb3ZlQ2hpbGQobm9kZSkge1xuICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW4uaGFzKG5vZGUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbm9kZS5wYXJlbnQgPSBudWxsO1xuICAgICAgICB0aGlzLmNoaWxkcmVuLmRlbGV0ZShub2RlKTtcbiAgICB9XG4gICAgcmVtb3ZlU2VsZigpIHtcbiAgICAgICAgdGhpcy5nZXRQYXJlbnQoKS5yZW1vdmVDaGlsZCh0aGlzKTtcbiAgICB9XG4gICAgLy8gVHJhdmVyc2VzIHRvIHJvb3QgaWYgYW5jZXN0b3IgaXMgbnVsbFxuICAgIGdldEFuY2VzdG9yUG9zaXRpb24oYW5jZXN0b3IpIHtcbiAgICAgICAgY29uc3Qgbm9kZVN0YWNrID0gW107XG4gICAgICAgIGxldCBub2RlID0gdGhpcztcbiAgICAgICAgLy8gVGhlIHJvb3Qgd2lsbCBhbHdheXMgYmUgZm91bmRcbiAgICAgICAgbGV0IGFuY2VzdG9yRm91bmQgPSBhbmNlc3RvciA9PT0gbnVsbDtcbiAgICAgICAgd2hpbGUgKG5vZGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgbm9kZVN0YWNrLnB1c2gobm9kZSk7XG4gICAgICAgICAgICBpZiAobm9kZSA9PT0gYW5jZXN0b3IpIHtcbiAgICAgICAgICAgICAgICBhbmNlc3RvckZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vZGUgPSBub2RlLmdldFBhcmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghYW5jZXN0b3JGb3VuZClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAvLyBUaGUgc3RhY2sgd2lsbCBhbHdheXMgYXQgbGVhc3QgaGF2ZSAxXG4gICAgICAgIGxldCB7IHBvc2l0aW9uIH0gPSBub2RlU3RhY2sucG9wKCkubG9jYWxUcmFuc2Zvcm07XG4gICAgICAgIHdoaWxlIChub2RlU3RhY2subGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbm9kZSA9IG5vZGVTdGFjay5wb3AoKTtcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdjMuYWRkKHBvc2l0aW9uLCBub2RlLmxvY2FsVHJhbnNmb3JtLnBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgfVxuICAgIGdldFdvcmxkUG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFuY2VzdG9yUG9zaXRpb24obnVsbCk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgY3JlYXRlUHJvZ3JhbUluZm8gfSBmcm9tICd0d2dsLmpzJztcbmltcG9ydCAqIGFzIFBhdGggZnJvbSAncGF0aCc7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTaGFkZXIge1xuICAgIHN0YXRpYyBjYWNoZSA9IG5ldyBNYXAoKTtcbiAgICB2ZXJ0ZXhTaGFkZXI7XG4gICAgZnJhZ21lbnRTaGFkZXI7XG4gICAgcHJvZ3JhbUluZm87XG4gICAgY29uc3RydWN0b3IodmVydGV4U2hhZGVyLCBmcmFnbWVudFNoYWRlcikge1xuICAgICAgICB0aGlzLnZlcnRleFNoYWRlciA9IHZlcnRleFNoYWRlcjtcbiAgICAgICAgdGhpcy5mcmFnbWVudFNoYWRlciA9IGZyYWdtZW50U2hhZGVyO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgZnJvbVVSTHModmVydGV4U2hhZGVyVVJMLCBmcmFnbWVudFNoYWRlclVSTCkge1xuICAgICAgICBsZXQgcmVxdWVzdCA9IGF3YWl0IGZldGNoKHZlcnRleFNoYWRlclVSTCk7XG4gICAgICAgIGlmICghcmVxdWVzdC5vaykge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYENvdWxkbid0IGZldGNoIHZlcnRleCBzaGFkZXIgZnJvbSBVUkw6ICR7dmVydGV4U2hhZGVyVVJMfSwgU3RhdHVzOiAke3JlcXVlc3Quc3RhdHVzVGV4dH1gKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2ZXJ0ZXhTaGFkZXIgPSBhd2FpdCByZXF1ZXN0LnRleHQoKTtcbiAgICAgICAgcmVxdWVzdCA9IGF3YWl0IGZldGNoKGZyYWdtZW50U2hhZGVyVVJMKTtcbiAgICAgICAgaWYgKCFyZXF1ZXN0Lm9rKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgQ291bGRuJ3QgZmV0Y2ggZnJhZ21lbnQgc2hhZGVyIGZyb20gVVJMOiAke2ZyYWdtZW50U2hhZGVyVVJMfSwgU3RhdHVzOiAke3JlcXVlc3Quc3RhdHVzVGV4dH1gKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmcmFnbWVudFNoYWRlciA9IGF3YWl0IHJlcXVlc3QudGV4dCgpO1xuICAgICAgICByZXR1cm4gbmV3IFNoYWRlcih2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgUHJvZ3JhbUluZm8gb2JqZWN0IGNyZWF0ZWQgZnJvbSB0aGUgY29tcGlsYXRpb24gb2YgdGhpcyBTaGFkZXIuXG4gICAgICogSWYgdGhlIFByb2dyYW1JbmZvIGhhc24ndCBiZWVuIGNyZWF0ZWQgeWV0LCB0aGlzIHdpbGwgY3JlYXRlIGFuZCBjYWNoZSBpdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBnbCBXZWJHTCBjb250ZXh0XG4gICAgICogQHJldHVybnMgQ29tcGlsZWQgc2hhZGVyIGxpbmtlZCB0byBhIHByb2dyYW1cbiAgICAgKi9cbiAgICBnZXRQcm9ncmFtSW5mbyhnbCkge1xuICAgICAgICBpZiAoIXRoaXMucHJvZ3JhbUluZm8pIHtcbiAgICAgICAgICAgIHRoaXMucHJvZ3JhbUluZm8gPSBjcmVhdGVQcm9ncmFtSW5mbyhnbCwgW3RoaXMudmVydGV4U2hhZGVyLCB0aGlzLmZyYWdtZW50U2hhZGVyXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucHJvZ3JhbUluZm87XG4gICAgfVxuICAgIHN0YXRpYyBhc3luYyBsb2FkKHVybCkge1xuICAgICAgICBpZiAodGhpcy5jYWNoZS5oYXModXJsKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KHVybCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29uZmlnUmVxdWVzdCA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IChhd2FpdCBjb25maWdSZXF1ZXN0Lmpzb24oKSk7XG4gICAgICAgIGNvbnN0IGRpciA9IFBhdGguZGlybmFtZSh1cmwpO1xuICAgICAgICBjb25zdCB2ZXJ0ZXhTaGFkZXJQYXRoID0gUGF0aC5yZXNvbHZlKGRpciwgY29uZmlnLnZlcnRleFNoYWRlcik7XG4gICAgICAgIGNvbnN0IGZyYWdtZW50U2hhZGVyUGF0aCA9IFBhdGgucmVzb2x2ZShkaXIsIGNvbmZpZy5mcmFnbWVudFNoYWRlcik7XG4gICAgICAgIGNvbnN0IHNoYWRlciA9IGF3YWl0IFNoYWRlci5mcm9tVVJMcyh2ZXJ0ZXhTaGFkZXJQYXRoLCBmcmFnbWVudFNoYWRlclBhdGgpO1xuICAgICAgICB0aGlzLmNhY2hlLnNldCh1cmwsIHNoYWRlcik7XG4gICAgICAgIHJldHVybiBzaGFkZXI7XG4gICAgfVxufVxuIiwiaW1wb3J0ICogYXMgdHdnbCBmcm9tICd0d2dsLmpzJztcbi8qKlxuICogQSBjbGFzcyBmb3IgY29uc3RydWN0aW5nIGEgdGV4dXR1cmUgYW5kIGluY2x1ZGUgaXQncyBkYXRhLFxuICogaXQgdXNlcyB0aGUgVGV4dHVyZUxvYWRlciBjbGFzcyBmcm9tIFRocmVlLmpzLlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXh0dXJlIHtcbiAgICBzdGF0aWMgY2FjaGUgPSBuZXcgTWFwKCk7XG4gICAgbV90ZXh0dXJlO1xuICAgIGNvbnN0cnVjdG9yKGNvbnRleHQsIHVybCkge1xuICAgICAgICB0aGlzLm1fdGV4dHVyZSA9IHR3Z2wuY3JlYXRlVGV4dHVyZShjb250ZXh0LCB7XG4gICAgICAgICAgICBzcmM6IHVybCxcbiAgICAgICAgICAgIGZsaXBZOiAxLFxuICAgICAgICAgICAgd3JhcDogY29udGV4dC5SRVBFQVQsXG4gICAgICAgICAgICBtaW46IGNvbnRleHQuTkVBUkVTVF9NSVBNQVBfTElORUFSLFxuICAgICAgICAgICAgbWFnOiBjb250ZXh0LkxJTkVBUixcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBhc3luYyBsb2FkKHVybCkge1xuICAgICAgICBpZiAodGhpcy5jYWNoZS5oYXModXJsKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KHVybCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSGFja3kgd2F5IG9mIGdldHRpbmcgdGhlIGNvbnRleHQgc28gd2UgZG9uJ3RcbiAgICAgICAgLy8gaGF2ZSB0byBwYXNzIGl0IGluIHRvIHRoZSBsb2FkIGZ1bmN0aW9uXG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2FudmFzJylbMF0uZ2V0Q29udGV4dCgnd2ViZ2wyJyk7XG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZShjb250ZXh0LCB1cmwpO1xuICAgICAgICB0aGlzLmNhY2hlLnNldCh1cmwsIHRleHR1cmUpO1xuICAgICAgICByZXR1cm4gdGV4dHVyZTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBtNCwgdjMgfSBmcm9tICd0d2dsLmpzJztcbmltcG9ydCB7IHRvUmFkaWFucywgdG9EZWdyZWVzIH0gZnJvbSAnLi4vdXRpbC9NYXRoJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRyYW5zZm9ybSB7XG4gICAgcG9zaXRpb247XG4gICAgLy8gSW4gcmFkaWFuc1xuICAgIHJvdGF0aW9uO1xuICAgIHNjYWxlO1xuICAgIG1hdHJpeDtcbiAgICBjb25zdHJ1Y3Rvcihwb3NpdGlvbiA9IG5ldyBGbG9hdDMyQXJyYXkoWzAuMCwgMC4wLCAwLjBdKSwgcm90YXRpb24gPSBuZXcgRmxvYXQzMkFycmF5KFswLjAsIDAuMCwgMC4wXSksIHNjYWxlID0gbmV3IEZsb2F0MzJBcnJheShbMS4wLCAxLjAsIDEuMF0pKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xuICAgICAgICB0aGlzLnNjYWxlID0gc2NhbGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAgICogVXNlcyBUV0dMIG00IHRvIG11bHRpcGx5IHNjYWxlLCByb3RhdGlvbiwgYW5kIHRyYW5zbGF0aW9uIG1hdHJpY2VzXG4gICAgICAgKiB0b2dldGhlciB0byBnZXQgdGhlIG1hdHJpeCByZXByZXNlbnRpbmcgdGhpcyBtb2RlbCdzIHRyYW5zZm9ybS5cbiAgICAgICAqXG4gICAgICAgKiBUaGUgb3JkZXIgb2Ygb3BlcmF0aW9ucyBpcyBpbXBvcnRhbnQuIFdlIHdhbnQgdGhlIGZvbGxvd2luZyBmb3JtdWxhOlxuICAgICAgICogTWF0cml4ID0gVHJhbnNsYXRpb24gKiBSb3RhdGlvbiAqIFNjYWxlICogSWRlbnRpdHlcbiAgICAgICAqL1xuICAgIGdldE1hdHJpeCgpIHtcbiAgICAgICAgaWYgKHRoaXMubWF0cml4KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWF0cml4ID0gbTQuaWRlbnRpdHkoKTtcbiAgICAgICAgbTQuc2NhbGUobWF0cml4LCB0aGlzLnNjYWxlLCBtYXRyaXgpO1xuICAgICAgICBtNC50cmFuc2xhdGUobWF0cml4LCB0aGlzLnBvc2l0aW9uLCBtYXRyaXgpO1xuICAgICAgICBtNC5yb3RhdGVaKG1hdHJpeCwgdGhpcy5yb3RhdGlvblsyXSwgbWF0cml4KTtcbiAgICAgICAgbTQucm90YXRlWShtYXRyaXgsIHRoaXMucm90YXRpb25bMV0sIG1hdHJpeCk7XG4gICAgICAgIG00LnJvdGF0ZVgobWF0cml4LCB0aGlzLnJvdGF0aW9uWzBdLCBtYXRyaXgpO1xuICAgICAgICB0aGlzLm1hdHJpeCA9IG1hdHJpeDtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4O1xuICAgIH1cbiAgICBnZXRGb3J3YXJkVmVjdG9yKCkge1xuICAgICAgICBjb25zdCBmb3J3YXJkID0gdjMuY3JlYXRlKDAsIDAsIC0xKTtcbiAgICAgICAgY29uc3QgbWF0cml4ID0gbTQuaWRlbnRpdHkoKTtcbiAgICAgICAgbTQucm90YXRlWihtYXRyaXgsIHRoaXMucm90YXRpb25bMl0sIG1hdHJpeCk7XG4gICAgICAgIG00LnJvdGF0ZVkobWF0cml4LCB0aGlzLnJvdGF0aW9uWzFdLCBtYXRyaXgpO1xuICAgICAgICBtNC5yb3RhdGVYKG1hdHJpeCwgdGhpcy5yb3RhdGlvblswXSwgbWF0cml4KTtcbiAgICAgICAgcmV0dXJuIG00LnRyYW5zZm9ybURpcmVjdGlvbihtYXRyaXgsIGZvcndhcmQpO1xuICAgIH1cbiAgICBnZXRSaWdodFZlY3RvcigpIHtcbiAgICAgICAgY29uc3QgcmlnaHQgPSB2My5jcmVhdGUoMSwgMCwgMCk7XG4gICAgICAgIGNvbnN0IG1hdHJpeCA9IG00LmlkZW50aXR5KCk7XG4gICAgICAgIG00LnJvdGF0ZVoobWF0cml4LCB0aGlzLnJvdGF0aW9uWzJdLCBtYXRyaXgpO1xuICAgICAgICBtNC5yb3RhdGVZKG1hdHJpeCwgdGhpcy5yb3RhdGlvblsxXSwgbWF0cml4KTtcbiAgICAgICAgbTQucm90YXRlWChtYXRyaXgsIHRoaXMucm90YXRpb25bMF0sIG1hdHJpeCk7XG4gICAgICAgIHJldHVybiBtNC50cmFuc2Zvcm1EaXJlY3Rpb24obWF0cml4LCByaWdodCk7XG4gICAgfVxuICAgIGdldFVwVmVjdG9yKCkge1xuICAgICAgICBjb25zdCB1cCA9IHYzLmNyZWF0ZSgwLCAxLCAwKTtcbiAgICAgICAgY29uc3QgbWF0cml4ID0gbTQuaWRlbnRpdHkoKTtcbiAgICAgICAgbTQucm90YXRlWihtYXRyaXgsIHRoaXMucm90YXRpb25bMl0sIG1hdHJpeCk7XG4gICAgICAgIG00LnJvdGF0ZVkobWF0cml4LCB0aGlzLnJvdGF0aW9uWzFdLCBtYXRyaXgpO1xuICAgICAgICBtNC5yb3RhdGVYKG1hdHJpeCwgdGhpcy5yb3RhdGlvblswXSwgbWF0cml4KTtcbiAgICAgICAgcmV0dXJuIG00LnRyYW5zZm9ybURpcmVjdGlvbihtYXRyaXgsIHVwKTtcbiAgICB9XG4gICAgc2V0Um90YXRpb25EZWcoeCwgeSwgeikge1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gW3RvUmFkaWFucyh4KSwgdG9SYWRpYW5zKHkpLCB0b1JhZGlhbnMoeildO1xuICAgIH1cbiAgICBzZXRSb3RhdGlvblJhZCh4LCB5LCB6KSB7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSBbeCwgeSwgel07XG4gICAgfVxuICAgIGdldFJvdGF0aW9uUmFkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb3RhdGlvbjtcbiAgICB9XG4gICAgZ2V0Um90YXRpb25EZWcoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICB0b0RlZ3JlZXModGhpcy5yb3RhdGlvblswXSksXG4gICAgICAgICAgICB0b0RlZ3JlZXModGhpcy5yb3RhdGlvblsxXSksXG4gICAgICAgICAgICB0b0RlZ3JlZXModGhpcy5yb3RhdGlvblsyXSksXG4gICAgICAgIF07XG4gICAgfVxufVxuIiwiaW1wb3J0ICogYXMgUGF0aCBmcm9tICdwYXRoJztcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tY3ljbGVcbmltcG9ydCB7IE1hdGVyaWFsLCBtYXRlcmlhbExvYWRlck1hcCwgfSBmcm9tICcuL19NYXRlcmlhbEludGVybmFsJztcbmltcG9ydCBTaGFkZXIgZnJvbSAnLi4vU2hhZGVyJztcbmltcG9ydCBUZXh0dXJlIGZyb20gJy4uL1RleHR1cmUnO1xuY29uc3Qgc2hhZGVyVXJsID0gJy9hc3NldHMvc2hhZGVycy9hbGJlZG8vc2hhZGVyLmpzb24nO1xuY29uc3QgYWxiZWRvU2hhZGVyID0gYXdhaXQgU2hhZGVyLmxvYWQoc2hhZGVyVXJsKTtcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvcHJlZmVyLWRlZmF1bHQtZXhwb3J0XG5leHBvcnQgY2xhc3MgQWxiZWRvTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7XG4gICAgc3RhdGljIHR5cGUgPSAnQWxiZWRvTWF0ZXJpYWwnO1xuICAgIHRleHR1cmU7XG4gICAgY29uc3RydWN0b3IodGV4dHVyZSkge1xuICAgICAgICBzdXBlcihhbGJlZG9TaGFkZXIsIHsgdV90ZXh0dXJlOiB0ZXh0dXJlIH0pO1xuICAgICAgICB0aGlzLnNldFRleHR1cmUodGV4dHVyZSk7XG4gICAgfVxuICAgIHNldFRleHR1cmUodGV4dHVyZSkge1xuICAgICAgICB0aGlzLnRleHR1cmUgPSB0ZXh0dXJlO1xuICAgICAgICB0aGlzLnVuaWZvcm1zLnVfdGV4dHVyZSA9IHRleHR1cmUubV90ZXh0dXJlO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgbG9hZEZyb21Db25maWcodXJsLCBjb25maWcpIHtcbiAgICAgICAgY29uc3QgZGlyID0gUGF0aC5kaXJuYW1lKHVybCk7XG4gICAgICAgIGNvbnN0IHRleHR1cmVVcmwgPSBQYXRoLnJlc29sdmUoZGlyLCBjb25maWcudGV4dHVyZSk7XG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSBhd2FpdCBUZXh0dXJlLmxvYWQodGV4dHVyZVVybCk7XG4gICAgICAgIHJldHVybiBuZXcgQWxiZWRvTWF0ZXJpYWwodGV4dHVyZSk7XG4gICAgfVxufVxubWF0ZXJpYWxMb2FkZXJNYXAuc2V0KCdBbGJlZG9NYXRlcmlhbCcsIEFsYmVkb01hdGVyaWFsLmxvYWRGcm9tQ29uZmlnKTtcbiIsImltcG9ydCB7IHYzIH0gZnJvbSAndHdnbC5qcyc7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWN5Y2xlXG5pbXBvcnQgeyBNYXRlcmlhbCwgbWF0ZXJpYWxMb2FkZXJNYXAgfSBmcm9tICcuL19NYXRlcmlhbEludGVybmFsJztcbmltcG9ydCBTaGFkZXIgZnJvbSAnLi4vU2hhZGVyJztcbmltcG9ydCBDb2xvciBmcm9tICcuLi9Db2xvcic7XG5jb25zdCBzaGFkZXJVcmwgPSAnL2Fzc2V0cy9zaGFkZXJzL2Jhc2VDb2xvci9zaGFkZXIuanNvbic7XG5jb25zdCBiYXNlQ29sb3JTaGFkZXIgPSBhd2FpdCBTaGFkZXIubG9hZChzaGFkZXJVcmwpO1xuY29uc3QgREVGQVVMVF9VX0NPTE9SID0gdjMuY3JlYXRlKDAuMCwgMC4wLCAwLjApO1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9wcmVmZXItZGVmYXVsdC1leHBvcnRcbmV4cG9ydCBjbGFzcyBCYXNlQ29sb3JNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHtcbiAgICBjb2xvcjtcbiAgICBjb25zdHJ1Y3Rvcihjb2xvcikge1xuICAgICAgICBzdXBlcihiYXNlQ29sb3JTaGFkZXIsIHsgdV9jb2xvcjogREVGQVVMVF9VX0NPTE9SIH0pO1xuICAgICAgICB0aGlzLnNldENvbG9yKGNvbG9yKTtcbiAgICB9XG4gICAgc2V0Q29sb3IoY29sb3IpIHtcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xuICAgICAgICB0aGlzLnVuaWZvcm1zLnVfY29sb3IgPSBjb2xvci50b1ZlYzMoKTtcbiAgICB9XG4gICAgZ2V0Q29sb3IoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbG9yO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgbG9hZEZyb21Db25maWcodXJsLCBjb25maWcpIHtcbiAgICAgICAgY29uc3QgY29sb3IgPSBDb2xvci5mcm9tSGV4KGNvbmZpZy5jb2xvcik7XG4gICAgICAgIHJldHVybiBuZXcgQmFzZUNvbG9yTWF0ZXJpYWwoY29sb3IpO1xuICAgIH1cbn1cbm1hdGVyaWFsTG9hZGVyTWFwLnNldCgnQmFzZUNvbG9yTWF0ZXJpYWwnLCBCYXNlQ29sb3JNYXRlcmlhbC5sb2FkRnJvbUNvbmZpZyk7XG4iLCJpbXBvcnQgKiBhcyBQYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IFNoYWRlciBmcm9tICcuLi9TaGFkZXInO1xuZXhwb3J0IGNvbnN0IG1hdGVyaWFsTG9hZGVyTWFwID0gbmV3IE1hcCgpO1xuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBhIGN1c3RvbSBNYXRlcmlhbC4gTWVhbnQgdG8gYmUgc3ViY2xhc3NlZCB0byBjcmVhdGVcbiAqIHRhaWxvcmVkIG1hdGVyaWFscyB0aGF0IGFyZSBjdXN0b21pemVkIHZpYSBhIGZldyBleHBvc2VkIHVuaWZvcm1zLlxuICovXG5leHBvcnQgY2xhc3MgTWF0ZXJpYWwge1xuICAgIHN0YXRpYyBjYWNoZSA9IG5ldyBNYXAoKTtcbiAgICBzdGF0aWMgdHlwZSA9ICdNYXRlcmlhbCc7XG4gICAgc2hhZGVyO1xuICAgIHVuaWZvcm1zO1xuICAgIGNvbnN0cnVjdG9yKHNoYWRlciwgdW5pZm9ybXMpIHtcbiAgICAgICAgdGhpcy5zaGFkZXIgPSBzaGFkZXI7XG4gICAgICAgIHRoaXMudW5pZm9ybXMgPSB1bmlmb3JtcztcbiAgICB9XG4gICAgZ2V0VHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudHlwZTtcbiAgICB9XG4gICAgc3RhdGljIGFzeW5jIGxvYWQodXJsKSB7XG4gICAgICAgIGlmICh0aGlzLmNhY2hlLmhhcyh1cmwpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZS5nZXQodXJsKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb25maWdSZXF1ZXN0ID0gYXdhaXQgZmV0Y2godXJsKTtcbiAgICAgICAgY29uc3QgbWF0ZXJpYWxDb25maWcgPSAoYXdhaXQgY29uZmlnUmVxdWVzdC5qc29uKCkpO1xuICAgICAgICBpZiAoIW1hdGVyaWFsTG9hZGVyTWFwLmhhcyhtYXRlcmlhbENvbmZpZy50eXBlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBtYXRlcmlhbCBsb2FkZXIgZm91bmQgZm9yIGdpdmVuIG1hdGVyaWFsIHR5cGUuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9hZGVyRnVuY3Rpb24gPSBtYXRlcmlhbExvYWRlck1hcC5nZXQobWF0ZXJpYWxDb25maWcudHlwZSk7XG4gICAgICAgIGNvbnN0IG1hdGVyaWFsID0gYXdhaXQgbG9hZGVyRnVuY3Rpb24odXJsLCBtYXRlcmlhbENvbmZpZyk7XG4gICAgICAgIHRoaXMuY2FjaGUuc2V0KHVybCwgbWF0ZXJpYWwpO1xuICAgICAgICByZXR1cm4gbWF0ZXJpYWw7XG4gICAgfVxuICAgIC8vIENhbid0IHVzZSBSZXNvdXJjZVNjaGVtYSBhcyBjb25maWcgdHlwZSBoZXJlIGJlY2F1c2UgaXQgcHJldmVudHNcbiAgICAvLyBzdWJjbGFzc2VzIGZyb20gdXNpbmcgdGhlaXIgb3duIFJlc291cmNlU2NoZW1hIHR5cGUuID46KFxuICAgIHN0YXRpYyBhc3luYyBsb2FkRnJvbUNvbmZpZyh1cmwsIGNvbmZpZykge1xuICAgICAgICBjb25zdCBtYXRlcmlhbENvbmZpZyA9IGNvbmZpZztcbiAgICAgICAgY29uc3QgZGlyID0gUGF0aC5kaXJuYW1lKHVybCk7XG4gICAgICAgIGNvbnN0IHNoYWRlclVybCA9IFBhdGgucmVzb2x2ZShkaXIsIG1hdGVyaWFsQ29uZmlnLnNoYWRlcik7XG4gICAgICAgIGNvbnN0IHNoYWRlciA9IGF3YWl0IFNoYWRlci5sb2FkKHNoYWRlclVybCk7XG4gICAgICAgIGNvbnN0IHsgdW5pZm9ybXMgfSA9IG1hdGVyaWFsQ29uZmlnO1xuICAgICAgICByZXR1cm4gbmV3IE1hdGVyaWFsKHNoYWRlciwgdW5pZm9ybXMpO1xuICAgIH1cbn1cbm1hdGVyaWFsTG9hZGVyTWFwLnNldCgnTWF0ZXJpYWwnLCBNYXRlcmlhbC5sb2FkRnJvbUNvbmZpZyk7XG4iLCJpbXBvcnQgKiBhcyBQYXRoIGZyb20gJ3BhdGgnO1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9uby1jeWNsZVxuaW1wb3J0IHsgTWF0ZXJpYWwsIG1hdGVyaWFsTG9hZGVyTWFwLCB9IGZyb20gJy4vX01hdGVyaWFsSW50ZXJuYWwnO1xuaW1wb3J0IFNoYWRlciBmcm9tICcuLi9TaGFkZXInO1xuaW1wb3J0IFRleHR1cmUgZnJvbSAnLi4vVGV4dHVyZSc7XG5jb25zdCBQQlJTaGFkZXIgPSBhd2FpdCBTaGFkZXIubG9hZCgnL2Fzc2V0cy9zaGFkZXJzL3Bici9zaGFkZXIuanNvbicpO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUEJSTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7XG4gICAgc3RhdGljIHR5cGUgPSAnUEJSTWF0ZXJpYWwnO1xuICAgIGFsYmVkbztcbiAgICBub3JtYWw7XG4gICAgbXJhbztcbiAgICBsaWdodFBvc2l0aW9ucztcbiAgICBsaWd0aENvbG9ycztcbiAgICBjb25zdHJ1Y3RvcihhbGJlZG8sIG5vcm1hbCwgbXJhbywgcExpZ2h0UG9zLCBwTGlnaHRDb2xzLCBkTGlnaHREaXIsIGRMaWdodENvbCkge1xuICAgICAgICBzdXBlcihQQlJTaGFkZXIsIHtcbiAgICAgICAgICAgIHVfYWxiZWRvOiBhbGJlZG8sXG4gICAgICAgICAgICB1X25vcm1hbDogbm9ybWFsLFxuICAgICAgICAgICAgdV9tcmFvOiBtcmFvLFxuICAgICAgICAgICAgdV9kTGlnaHREaXJlY3Rpb246IGRMaWdodERpcixcbiAgICAgICAgICAgIHVfZExpZ2h0Q29sb3I6IGRMaWdodENvbCxcbiAgICAgICAgICAgIHVfcExpZ2h0UG9zaXRpb25zOiBwTGlnaHRQb3MsXG4gICAgICAgICAgICB1X3BMaWdodENvbG9yczogcExpZ2h0Q29scyxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0QWxiZWRvKGFsYmVkbyk7XG4gICAgICAgIHRoaXMuc2V0Tm9ybWFsKG5vcm1hbCk7XG4gICAgICAgIHRoaXMuc2V0TXJhbyhtcmFvKTtcbiAgICAgICAgdGhpcy5zZXRMaWdodHMocExpZ2h0UG9zLCBwTGlnaHRDb2xzKTtcbiAgICB9XG4gICAgc2V0QWxiZWRvKGFsYmVkbykge1xuICAgICAgICB0aGlzLmFsYmVkbyA9IGFsYmVkbztcbiAgICAgICAgdGhpcy51bmlmb3Jtcy51X2FsYmVkbyA9IGFsYmVkby5tX3RleHR1cmU7XG4gICAgfVxuICAgIHNldE5vcm1hbChub3JtYWwpIHtcbiAgICAgICAgdGhpcy5ub3JtYWwgPSBub3JtYWw7XG4gICAgICAgIHRoaXMudW5pZm9ybXMudV9ub3JtYWwgPSBub3JtYWwubV90ZXh0dXJlO1xuICAgIH1cbiAgICBzZXRNcmFvKG1yYW8pIHtcbiAgICAgICAgdGhpcy5tcmFvID0gbXJhbztcbiAgICAgICAgdGhpcy51bmlmb3Jtcy51X21yYW8gPSBtcmFvLm1fdGV4dHVyZTtcbiAgICB9XG4gICAgc2V0TGlnaHRzKGxpZ2h0UG9zLCBsaWdodENvbHMpIHtcbiAgICAgICAgdGhpcy5saWdodFBvc2l0aW9ucyA9IGxpZ2h0UG9zO1xuICAgICAgICB0aGlzLnVuaWZvcm1zLnVfcExpZ2h0UG9zaXRpb25zID0gbGlnaHRQb3M7XG4gICAgICAgIHRoaXMubGlndGhDb2xvcnMgPSBsaWdodENvbHM7XG4gICAgICAgIHRoaXMudW5pZm9ybXMudV9wTGlnaHRDb2xvcnMgPSBsaWdodENvbHM7XG4gICAgfVxuICAgIHN0YXRpYyBhc3luYyBsb2FkRnJvbUNvbmZpZyh1cmwsIGNvbmZpZykge1xuICAgICAgICBjb25zdCBkaXIgPSBQYXRoLmRpcm5hbWUodXJsKTtcbiAgICAgICAgY29uc3QgYWxiZWRvVXJsID0gUGF0aC5yZXNvbHZlKGRpciwgY29uZmlnLmFsYmVkbyk7XG4gICAgICAgIGNvbnN0IGFsYmVkbyA9IGF3YWl0IFRleHR1cmUubG9hZChhbGJlZG9VcmwpO1xuICAgICAgICBjb25zdCBub3JtYWxVcmwgPSBQYXRoLnJlc29sdmUoZGlyLCBjb25maWcubm9ybWFsKTtcbiAgICAgICAgY29uc3Qgbm9ybWFsID0gYXdhaXQgVGV4dHVyZS5sb2FkKG5vcm1hbFVybCk7XG4gICAgICAgIGNvbnN0IG1yYW9VcmwgPSBQYXRoLnJlc29sdmUoZGlyLCBjb25maWcubXJhbyk7XG4gICAgICAgIGNvbnN0IG1yYW8gPSBhd2FpdCBUZXh0dXJlLmxvYWQobXJhb1VybCk7XG4gICAgICAgIGNvbnN0IHNjZW5lTGlnaHRpbmdQYXRoID0gJy9hc3NldHMvbGlnaHRpbmcuanNvbic7XG4gICAgICAgIGNvbnN0IGNvbmZpZ1JlcXVlc3QgPSBhd2FpdCBmZXRjaChzY2VuZUxpZ2h0aW5nUGF0aCk7XG4gICAgICAgIGNvbnN0IHNjZW5lTGlnaHRpbmdDb25maWcgPSAoYXdhaXQgY29uZmlnUmVxdWVzdC5qc29uKCkpO1xuICAgICAgICBjb25zdCB7IHBMaWdodFBvc2l0aW9ucywgcExpZ2h0Q29sb3JzLCBkTGlnaHREaXJlY3Rpb24sIGRMaWdodENvbG9yLCB9ID0gc2NlbmVMaWdodGluZ0NvbmZpZztcbiAgICAgICAgcmV0dXJuIG5ldyBQQlJNYXRlcmlhbChhbGJlZG8sIG5vcm1hbCwgbXJhbywgcExpZ2h0UG9zaXRpb25zLCBwTGlnaHRDb2xvcnMsIGRMaWdodERpcmVjdGlvbiwgZExpZ2h0Q29sb3IpO1xuICAgIH1cbn1cbm1hdGVyaWFsTG9hZGVyTWFwLnNldCgnUEJSTWF0ZXJpYWwnLCBQQlJNYXRlcmlhbC5sb2FkRnJvbUNvbmZpZyk7XG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvbm8tY3ljbGUgKi9cbi8vIFNlZSBodHRwczovL21lZGl1bS5jb20vdmlzdWFsLWRldmVsb3BtZW50L2hvdy10by1maXgtbmFzdHktY2lyY3VsYXItZGVwZW5kZW5jeS1pc3N1ZXMtb25jZS1hbmQtZm9yLWFsbC1pbi1qYXZhc2NyaXB0LXR5cGVzY3JpcHQtYTA0Yzk4N2NmMGRlXG4vLyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHBhdHRlcm5cbmV4cG9ydCAqIGZyb20gJy4vTWF0ZXJpYWwnO1xuZXhwb3J0ICogZnJvbSAnLi9BbGJlZG9NYXRlcmlhbCc7XG5leHBvcnQgKiBmcm9tICcuL0Jhc2VDb2xvck1hdGVyaWFsJztcbmV4cG9ydCAqIGZyb20gJy4vUEJSTWF0ZXJpYWwnO1xuIiwiaW1wb3J0IEdhbWUgZnJvbSAnLi9nYW1lL0dhbWUnO1xuaW1wb3J0ICcuL3N0eWxlLmNzcyc7XG5pbXBvcnQgRGVidWdVSSBmcm9tICcuL3JlbmRlcmVyL0RlYnVnVUknO1xuKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBhcHBXcmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcCcpO1xuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcbiAgICBjb25zdCBnbCA9IGNhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbDInKTtcbiAgICAvLyBDcmVhdGUgdGhlIGdhbWUgbG9naWMgaGFuZGxlclxuICAgIGNvbnN0IGdhbWUgPSBuZXcgR2FtZShnbCk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IGRlYnVnVUkgPSBuZXcgRGVidWdVSShnYW1lLnJlbmRlcmVyLCBhcHBXcmFwcGVyKTtcbiAgICBpZiAobW9kdWxlLmhvdCkge1xuICAgICAgICBtb2R1bGUuaG90LmRpc3Bvc2UoKCkgPT4ge1xuICAgICAgICAgICAgZ2FtZS5zdG9wR2FtZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgbW9kdWxlLmhvdC5hY2NlcHQoKTtcbiAgICB9XG59KSgpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRnJhbWVUaW1lUGFuZWwge1xuICAgIHN0YXRpYyBjbGFzc05hbWUgPSAnZGVidWctcGFuZWwnO1xuICAgIHJlbmRlcmVyO1xuICAgIGVsZW1lbnQ7XG4gICAgZnJhbWVUaW1lVXBkYXRlSW50ZXJ2YWxJZDtcbiAgICBjb25zdHJ1Y3RvcihyZW5kZXJlcikge1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NOYW1lID0gRnJhbWVUaW1lUGFuZWwuY2xhc3NOYW1lO1xuICAgICAgICAvLyBVcGRhdGUgdGhlIGZyYW1lIHRpbWUgMzAgdGltZXMgcGVyIHNlY29uZFxuICAgICAgICB0aGlzLmZyYW1lVGltZVVwZGF0ZUludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0aW1lU3RyaW5nID0gdGhpcy5yZW5kZXJlci5mcmFtZVRpbWUudG9GaXhlZCgyKS5wYWRTdGFydCg2KTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC50ZXh0Q29udGVudCA9IGBGcmFtZSB0aW1lOiAke3RpbWVTdHJpbmd9IG1zYDtcbiAgICAgICAgfSwgMzAgLyAxMDAwKTtcbiAgICAgICAgaWYgKG1vZHVsZS5ob3QpIHtcbiAgICAgICAgICAgIG1vZHVsZS5ob3QuZGlzcG9zZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmZyYW1lVGltZVVwZGF0ZUludGVydmFsSWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGVhblVwKCkge1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuZnJhbWVUaW1lVXBkYXRlSW50ZXJ2YWxJZCk7XG4gICAgfVxufVxuIiwiY29uc3QgY29udHJvbHMgPSBbXG4gICAgeyBsYWJlbDogJ1cnLCBhY3Rpb246ICdNb3ZlIGZvcndhcmQnIH0sXG4gICAgeyBsYWJlbDogJ0EnLCBhY3Rpb246ICdNb3ZlIGxlZnQnIH0sXG4gICAgeyBsYWJlbDogJ1MnLCBhY3Rpb246ICdNb3ZlIGJhY2t3YXJkJyB9LFxuICAgIHsgbGFiZWw6ICdEJywgYWN0aW9uOiAnTW92ZSByaWdodCcgfSxcbiAgICB7IGxhYmVsOiAnUScsIGFjdGlvbjogJ0F0dGFjayBhZGphY2VudCB0aWxlcycgfSxcbiAgICB7IGxhYmVsOiAnSScsIGFjdGlvbjogJ1RvZ2dsZSBpbnZlbnRvcnknIH0sXG4gICAgeyBsYWJlbDogJzEtOScsIGFjdGlvbjogJ1VzZSBpbnZlbnRvcnkgc2xvdCBpdGVtJyB9LFxuICAgIHsgbGFiZWw6ICdNJywgYWN0aW9uOiAnVG9nZ2xlIE1hcCcgfSxcbiAgICB7IGxhYmVsOiAnLicsIGFjdGlvbjogJ1RvZ2dsZSBkZWJ1ZyBtb2RlJyB9LFxuICAgIHsgbGFiZWw6ICcsJywgYWN0aW9uOiAnVG9nZ2xlIGZyZWUgY2FtZXJhJyB9LFxuICAgIHsgbGFiZWw6ICdoJywgYWN0aW9uOiAnRnJlZSBjYW1lcmEgbW92ZSBsZWZ0JyB9LFxuICAgIHsgbGFiZWw6ICdqJywgYWN0aW9uOiAnRnJlZSBjYW1lcmEgbW92ZSBiYWNrd2FyZCcgfSxcbiAgICB7IGxhYmVsOiAnaycsIGFjdGlvbjogJ0ZyZWUgY2FtZXJhIG1vdmUgZm9yd2FyZCcgfSxcbiAgICB7IGxhYmVsOiAnbCcsIGFjdGlvbjogJ0ZyZWUgY2FtZXJhIG1vdmUgcmlnaHQnIH0sXG4gICAgeyBsYWJlbDogJ1snLCBhY3Rpb246ICdGcmVlIGNhbWVyYSBtb3ZlIGRvd24nIH0sXG4gICAgeyBsYWJlbDogJ10nLCBhY3Rpb246ICdGcmVlIGNhbWVyYSBtb3ZlIHVwJyB9LFxuICAgIHsgbGFiZWw6ICdcXFxcJywgYWN0aW9uOiAnUmUtZ2VuZXJhdGUgbWFwIChub3QgcmVjb21tZW5kZWQpJyB9LFxuXTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbnRyb2xzUGFuZSBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgICBnYW1lO1xuICAgIHRpdGxlRWxlbWVudDtcbiAgICBzdGF0c0VsZW1lbnQ7XG4gICAgZXF1aXBwZWRXZWFwb25FbGVtZW50O1xuICAgIGNvbnN0cnVjdG9yKGdhbWUpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgdGhpcy5jbGFzc05hbWUgPSAnZ2FtZS1wYW5lJztcbiAgICAgICAgdGhpcy50aXRsZUVsZW1lbnQgPSBDb250cm9sc1BhbmUuY3JlYXRlVGl0bGVFbGVtZW50KCk7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy50aXRsZUVsZW1lbnQpO1xuICAgICAgICBjb25zdCBjb250cm9sc0VsZW1lbnRzID0gY29udHJvbHMubWFwKCh7IGxhYmVsLCBhY3Rpb24gfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBgPHN0cm9uZz4ke2xhYmVsfTo8L3N0cm9uZz4gJHthY3Rpb259YDtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hcHBlbmQoLi4uY29udHJvbHNFbGVtZW50cyk7XG4gICAgfVxuICAgIHN0YXRpYyBjcmVhdGVUaXRsZUVsZW1lbnQoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSAncGFuZS10aXRsZSc7XG4gICAgICAgIGVsZW1lbnQuaW5uZXJUZXh0ID0gJ0NvbnRyb2xzJztcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxufVxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdjb250cm9scy1wYW5lJywgQ29udHJvbHNQYW5lKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVMb2dQYW5lIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuICAgIGdhbWU7XG4gICAgdGl0bGVFbGVtZW50O1xuICAgIG1lc3NhZ2VFbGVtZW50O1xuICAgIGNvbnN0cnVjdG9yKGdhbWUpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKCdnYW1lLXBhbmUnLCAnZ2FtZS1sb2ctcGFuZScpO1xuICAgICAgICB0aGlzLnRpdGxlRWxlbWVudCA9IEdhbWVMb2dQYW5lLmNyZWF0ZVRpdGxlRWxlbWVudCgpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMudGl0bGVFbGVtZW50KTtcbiAgICAgICAgdGhpcy5tZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMubWVzc2FnZUVsZW1lbnQpO1xuICAgIH1cbiAgICBzdGF0aWMgY3JlYXRlVGl0bGVFbGVtZW50KCkge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gJ3BhbmUtdGl0bGUnO1xuICAgICAgICBlbGVtZW50LmlubmVyVGV4dCA9ICdHYW1lIExvZyc7XG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cbiAgICB1cGRhdGUoKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZUVsZW1lbnQuaW5uZXJUZXh0ID0gdGhpcy5nYW1lLm1lc3NhZ2U7XG4gICAgfVxufVxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdnYW1lLWxvZy1wYW5lJywgR2FtZUxvZ1BhbmUpO1xuIiwiaW1wb3J0IENvbnRyb2xzUGFuZSBmcm9tICcuL0NvbnRyb2xzUGFuZSc7XG5pbXBvcnQgR2FtZUxvZ1BhbmUgZnJvbSAnLi9HYW1lTG9nUGFuZSc7XG5pbXBvcnQgSW52ZW50b3J5UGFuZSBmcm9tICcuL0ludmVudG9yeVBhbmUnO1xuaW1wb3J0IFBsYXllclBhbmUgZnJvbSAnLi9QbGF5ZXJQYW5lJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVQYW5lbCBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgICBnYW1lO1xuICAgIHBsYXllclBhbmU7XG4gICAgY29udHJvbHNQYW5lO1xuICAgIGludmVudG9yeVBhbmU7XG4gICAgZ2FtZUxvZ1BhbmU7XG4gICAgY29uc3RydWN0b3IoZ2FtZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmdhbWUgPSBnYW1lO1xuICAgICAgICB0aGlzLnBsYXllclBhbmUgPSBuZXcgUGxheWVyUGFuZShnYW1lKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLnBsYXllclBhbmUpO1xuICAgICAgICB0aGlzLmNvbnRyb2xzUGFuZSA9IG5ldyBDb250cm9sc1BhbmUoZ2FtZSk7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5jb250cm9sc1BhbmUpO1xuICAgICAgICB0aGlzLmludmVudG9yeVBhbmUgPSBuZXcgSW52ZW50b3J5UGFuZShnYW1lKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmludmVudG9yeVBhbmUpO1xuICAgICAgICB0aGlzLmdhbWVMb2dQYW5lID0gbmV3IEdhbWVMb2dQYW5lKGdhbWUpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuZ2FtZUxvZ1BhbmUpO1xuICAgICAgICAvLyBNb3VudCBzZWxmXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAnKS5hcHBlbmRDaGlsZCh0aGlzKTtcbiAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgLy8gaWYgKG1vZHVsZS5ob3QpIHtcbiAgICAgICAgLy8gICBtb2R1bGUuaG90LmRpc3Bvc2UoKCkgPT4gdGhpcy5kaXNwb3NlKCkpO1xuICAgICAgICAvLyB9XG4gICAgfVxuICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXJQYW5lLnVwZGF0ZSgpO1xuICAgICAgICB0aGlzLmludmVudG9yeVBhbmUudXBkYXRlKCk7XG4gICAgICAgIHRoaXMuZ2FtZUxvZ1BhbmUudXBkYXRlKCk7XG4gICAgfVxufVxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdnYW1lLXBhbmVsJywgR2FtZVBhbmVsKTtcbiIsIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby1jeWNsZSAqL1xuaW1wb3J0IEl0ZW0gZnJvbSAnLi4vLi4vZ2FtZS9lbnRpdGllcy9JdGVtJztcbmltcG9ydCBXZWFwb24gZnJvbSAnLi4vLi4vZ2FtZS9lbnRpdGllcy9XZWFwb24nO1xuaW1wb3J0IHsgR2FtZVN0YXRlIH0gZnJvbSAnLi4vLi4vZ2FtZS9HYW1lJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEludmVudG9yeVBhbmUgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG4gICAgZ2FtZTtcbiAgICB0aXRsZUVsZW1lbnQ7XG4gICAgaXRlbXNXcmFwcGVyO1xuICAgIGNvbnN0cnVjdG9yKGdhbWUpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgdGhpcy5jbGFzc05hbWUgPSAnZ2FtZS1wYW5lJztcbiAgICAgICAgdGhpcy50aXRsZUVsZW1lbnQgPSBJbnZlbnRvcnlQYW5lLmNyZWF0ZVRpdGxlRWxlbWVudCgpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMudGl0bGVFbGVtZW50KTtcbiAgICAgICAgdGhpcy5pdGVtc1dyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLml0ZW1zV3JhcHBlcik7XG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgfVxuICAgIHN0YXRpYyBjcmVhdGVUaXRsZUVsZW1lbnQoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSAncGFuZS10aXRsZSc7XG4gICAgICAgIGVsZW1lbnQuaW5uZXJUZXh0ID0gJ0ludmVudG9yeSc7XG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cbiAgICBjcmVhdGVJbnZlbnRvcnlFbGVtZW50cygpIHtcbiAgICAgICAgY29uc3QgaW52ZW50b3J5RWxlbWVudHMgPSB0aGlzLmdhbWUucGxheWVyLmludmVudG9yeS5pbnZlbnRvcnkubWFwKChlbnRpdHksIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB3cmFwcGVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgd3JhcHBlckVsZW1lbnQuY2xhc3NOYW1lID0gJ2ludmVudG9yeS1lbnRpdHktd3JhcHBlcic7XG4gICAgICAgICAgICBjb25zdCBsYWJlbEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHdyYXBwZXJFbGVtZW50LmFwcGVuZENoaWxkKGxhYmVsRWxlbWVudCk7XG4gICAgICAgICAgICBjb25zdCBib2R5RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgd3JhcHBlckVsZW1lbnQuYXBwZW5kQ2hpbGQoYm9keUVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKGVudGl0eSBpbnN0YW5jZW9mIFdlYXBvbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHdlYXBvbiA9IGVudGl0eTtcbiAgICAgICAgICAgICAgICBsYWJlbEVsZW1lbnQuaW5uZXJIVE1MID0gYDxzdHJvbmc+JHtpbmRleCArIDF9LiAoV2VhcG9uKSAke3dlYXBvbi5uYW1lfTwvc3Ryb25nPmA7XG4gICAgICAgICAgICAgICAgYm9keUVsZW1lbnQuaW5uZXJUZXh0ID0gYERhbWFnZTogJHt3ZWFwb24uZGFtYWdlfSwgU2tpbGwgQm9udXM6ICR7d2VhcG9uLnNraWxsQm9udXN9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGVudGl0eSBpbnN0YW5jZW9mIEl0ZW0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZW50aXR5O1xuICAgICAgICAgICAgICAgIGxhYmVsRWxlbWVudC5pbm5lckhUTUwgPSBgPHN0cm9uZz4ke2luZGV4ICsgMX0uIChJdGVtKSAke2l0ZW0ubmFtZX1gO1xuICAgICAgICAgICAgICAgIGJvZHlFbGVtZW50LmlubmVyVGV4dCA9IGAke2l0ZW0uZGVzY3JpcHRpb259YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3cmFwcGVyRWxlbWVudDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpbnZlbnRvcnlFbGVtZW50cztcbiAgICB9XG4gICAgc2V0VmlzaWJpbGl0eShpc1Zpc2libGUpIHtcbiAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gaXNWaXNpYmxlID8gJycgOiAnbm9uZSc7XG4gICAgfVxuICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KHRoaXMuZ2FtZS5zdGF0ZSA9PT0gR2FtZVN0YXRlLklOVkVOVE9SWSk7XG4gICAgICAgIHRoaXMuaXRlbXNXcmFwcGVyLnJlcGxhY2VDaGlsZHJlbiguLi50aGlzLmNyZWF0ZUludmVudG9yeUVsZW1lbnRzKCkpO1xuICAgIH1cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgnaW52ZW50b3J5LXBhbmUnLCBJbnZlbnRvcnlQYW5lKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIE1pbmltYXBQYW5lbCBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgICBnYW1lO1xuICAgIHN0YXRpYyBjbGFzc05hbWUgPSAnbWluaW1hcC1wYW5lbCc7XG4gICAgZnJhbWVUaW1lVXBkYXRlSW50ZXJ2YWxJZDtcbiAgICBpc1Zpc2libGUgPSB0cnVlO1xuICAgIGNvbnN0cnVjdG9yKGdhbWUpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgdGhpcy5jbGFzc05hbWUgPSBNaW5pbWFwUGFuZWwuY2xhc3NOYW1lO1xuICAgICAgICAvLyBtb3VudCBzZWxmXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAnKS5hcHBlbmRDaGlsZCh0aGlzKTtcbiAgICAgICAgLy8gQmluZCB0b2dnbGUga2V5YmluZFxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldikgPT4ge1xuICAgICAgICAgICAgaWYgKGV2LmtleSA9PT0gJ20nKVxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVmlzaWJpbGl0eSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG1vZHVsZS5ob3QpIHtcbiAgICAgICAgICAgIG1vZHVsZS5ob3QuZGlzcG9zZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdG9nZ2xlVmlzaWJpbGl0eSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICB0aGlzLmlzVmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgICAgICB0aGlzLmlzVmlzaWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgY29uc3QgbWFwU3RyaW5nID0gdGhpcy5nYW1lLmdyaWQuc3RyaW5nUmVwcmVzZW50YXRpb24oKTtcbiAgICAgICAgdGhpcy5pbm5lclRleHQgPSBtYXBTdHJpbmc7XG4gICAgfVxufVxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdtaW5pbWFwLXBhbmVsJywgTWluaW1hcFBhbmVsKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsYXllclBhbmUgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG4gICAgZ2FtZTtcbiAgICB0aXRsZUVsZW1lbnQ7XG4gICAgc3RhdHNFbGVtZW50O1xuICAgIGVxdWlwcGVkV2VhcG9uRWxlbWVudDtcbiAgICBjb25zdHJ1Y3RvcihnYW1lKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgICAgIHRoaXMuY2xhc3NOYW1lID0gJ2dhbWUtcGFuZSc7XG4gICAgICAgIHRoaXMudGl0bGVFbGVtZW50ID0gUGxheWVyUGFuZS5jcmVhdGVUaXRsZUVsZW1lbnQoKTtcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLnRpdGxlRWxlbWVudCk7XG4gICAgICAgIGNvbnN0IHN0YXRzTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgc3RhdHNMYWJlbC5pbm5lckhUTUwgPSAnPHN0cm9uZz5TdGF0czo8L3N0cm9uZz4nO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHN0YXRzTGFiZWwpO1xuICAgICAgICB0aGlzLnN0YXRzRWxlbWVudCA9IFBsYXllclBhbmUuY3JlYXRlU3RhdHNFbGVtZW50KCk7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5zdGF0c0VsZW1lbnQpO1xuICAgICAgICBjb25zdCBlcXVpcHBlZFdlYXBvbkxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGVxdWlwcGVkV2VhcG9uTGFiZWwuY2xhc3NOYW1lID0gJ3BsYXllci1wYW5lLWVxdWlwLWxhYmVsJztcbiAgICAgICAgZXF1aXBwZWRXZWFwb25MYWJlbC5pbm5lckhUTUwgPSAnPHN0cm9uZz5FcXVpcHBlZCBXZWFwb246PC9zdHJvbmc+JztcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZChlcXVpcHBlZFdlYXBvbkxhYmVsKTtcbiAgICAgICAgdGhpcy5lcXVpcHBlZFdlYXBvbkVsZW1lbnQgPSBQbGF5ZXJQYW5lLmNyZWF0ZUVxdWlwcGVkV2VhcG9uRWxlbWVudCgpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuZXF1aXBwZWRXZWFwb25FbGVtZW50KTtcbiAgICB9XG4gICAgc3RhdGljIGNyZWF0ZVRpdGxlRWxlbWVudCgpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9ICdwYW5lLXRpdGxlJztcbiAgICAgICAgZWxlbWVudC5pbm5lclRleHQgPSAnUGxheWVyJztcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfVxuICAgIHN0YXRpYyBjcmVhdGVTdGF0c0VsZW1lbnQoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSAncGxheWVyLXBhbmUtc3RhdHMnO1xuICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG4gICAgc3RhdGljIGNyZWF0ZUVxdWlwcGVkV2VhcG9uRWxlbWVudCgpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9ICdwbGF5ZXItcGFuZS1lcXVpcHBlZC13ZWFwb24nO1xuICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG4gICAgdXBkYXRlKCkge1xuICAgICAgICB0aGlzLnN0YXRzRWxlbWVudC5pbm5lclRleHQgPSBgJHt0aGlzLmdhbWUucGxheWVyLnN0cmluZ1JlcHJlc2VudGF0aW9uKCl9YDtcbiAgICAgICAgaWYgKHRoaXMuZ2FtZS5wbGF5ZXIuZXF1aXBwZWRXZWFwb24pIHtcbiAgICAgICAgICAgIHRoaXMuZXF1aXBwZWRXZWFwb25FbGVtZW50LmlubmVyVGV4dCA9IHRoaXMuZ2FtZS5wbGF5ZXIuZXF1aXBwZWRXZWFwb24uc3RyaW5nUmVwcmVzZW50YXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXF1aXBwZWRXZWFwb25FbGVtZW50LmlubmVyVGV4dCA9ICdOb25lJztcbiAgICAgICAgfVxuICAgIH1cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgncGxheWVyLXBhbmUnLCBQbGF5ZXJQYW5lKTtcbiIsImltcG9ydCBTY2VuZVBhbmVsSGVhZGVyIGZyb20gJy4vU2NlbmVQYW5lbEhlYWRlcic7XG5pbXBvcnQgU2NlbmVQYW5lbExpc3QgZnJvbSAnLi9TY2VuZVBhbmVsTGlzdCc7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY2VuZVBhbmVsIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuICAgIHJlbmRlcmVyO1xuICAgIGhlYWRlcjtcbiAgICBsaXN0O1xuICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICAgICAgdGhpcy5oZWFkZXIgPSBuZXcgU2NlbmVQYW5lbEhlYWRlcigpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuaGVhZGVyKTtcbiAgICAgICAgdGhpcy5saXN0ID0gbmV3IFNjZW5lUGFuZWxMaXN0KHRoaXMucmVuZGVyZXIuc2NlbmUpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMubGlzdCk7XG4gICAgfVxufVxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdzY2VuZS1wYW5lbCcsIFNjZW5lUGFuZWwpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2NlbmVQYW5lbEhlYWRlciBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5pbm5lclRleHQgPSAnU2NlbmUgSGllcmFyY2h5JztcbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ3NjZW5lLXBhbmVsLWhlYWRlcicsIFNjZW5lUGFuZWxIZWFkZXIpO1xuIiwiaW1wb3J0IFNjZW5lUGFuZWxMaXN0Tm9kZSBmcm9tICcuL1NjZW5lUGFuZWxMaXN0Tm9kZSc7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY2VuZVBhbmVsTGlzdCBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgICBzY2VuZTtcbiAgICBjb25zdHJ1Y3RvcihzY2VuZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XG4gICAgICAgIHRoaXMudXBkYXRlTGlzdCgpO1xuICAgIH1cbiAgICB1cGRhdGVMaXN0KCkge1xuICAgICAgICBjb25zdCBub2RlcyA9IEFycmF5LmZyb20odGhpcy5zY2VuZS5yb290LmdldENoaWxkcmVuKCkpO1xuICAgICAgICBub2Rlcy5mb3JFYWNoKChub2RlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFwcGVuZENoaWxkKG5ldyBTY2VuZVBhbmVsTGlzdE5vZGUobm9kZSkpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ3NjZW5lLXBhbmVsLWxpc3QnLCBTY2VuZVBhbmVsTGlzdCk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTY2VuZVBhbmVsTGlzdE5vZGUgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG4gICAgbGV2ZWw7XG4gICAgc2NlbmVOb2RlO1xuICAgIHdyYXBwZXI7XG4gICAgZXhwYW5kQnV0dG9uO1xuICAgIGNoaWxkcmVuTm9kZXM7XG4gICAgaXNPcGVuID0gZmFsc2U7XG4gICAgY29uc3RydWN0b3Ioc2NlbmVOb2RlLCBsZXZlbCA9IDApIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5zY2VuZU5vZGUgPSBzY2VuZU5vZGU7XG4gICAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICAgICAgdGhpcy5zdHlsZS5wYWRkaW5nTGVmdCA9IGAke3RoaXMubGV2ZWwgKiAwLjV9cmVtYDtcbiAgICAgICAgdGhpcy53cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMud3JhcHBlci5jbGFzc05hbWUgPSAnbm9kZS13cmFwcGVyJztcbiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLndyYXBwZXIpO1xuICAgICAgICAvLyBDcmVhdGUgY29sbGFwc2libGUgYnV0dG9uXG4gICAgICAgIHRoaXMuZXhwYW5kQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuZXhwYW5kQnV0dG9uLmNsYXNzTmFtZSA9ICdleHBhbmQtYnV0dG9uJztcbiAgICAgICAgaWYgKHNjZW5lTm9kZS5nZXRDaGlsZHJlbigpLnNpemUgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmV4cGFuZEJ1dHRvbi5pbm5lclRleHQgPSAnKyc7XG4gICAgICAgICAgICB0aGlzLmV4cGFuZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzT3BlbiA9ICF0aGlzLmlzT3BlbjtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmV4cGFuZEJ1dHRvbi5pbm5lclRleHQgPSAnICc7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53cmFwcGVyLmFwcGVuZCh0aGlzLmV4cGFuZEJ1dHRvbik7XG4gICAgICAgIC8vIENyZWF0ZSBsYWJlbFxuICAgICAgICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBsYWJlbC5pbm5lclRleHQgPSBgJHt0aGlzLnNjZW5lTm9kZS5uYW1lfSA6ICR7dGhpcy5zY2VuZU5vZGUuY29uc3RydWN0b3IubmFtZX1gO1xuICAgICAgICB0aGlzLndyYXBwZXIuYXBwZW5kKGxhYmVsKTtcbiAgICAgICAgaWYgKG1vZHVsZS5ob3QpIHtcbiAgICAgICAgICAgIG1vZHVsZS5ob3QuZGlzcG9zZSgoKSA9PiB0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcykpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5leHBhbmRCdXR0b24uaW5uZXJUZXh0ID0gdGhpcy5pc09wZW4gPyAnLScgOiAnKyc7XG4gICAgICAgIC8vIENyZWF0ZSBjaGlsZHJlbiB3cmFwcGVyXG4gICAgICAgIGlmICh0aGlzLmlzT3Blbikge1xuICAgICAgICAgICAgY29uc3Qgbm9kZXMgPSBBcnJheS5mcm9tKHRoaXMuc2NlbmVOb2RlLmdldENoaWxkcmVuKCkpO1xuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbk5vZGVzID0gbm9kZXMubWFwKChub2RlKSA9PiBuZXcgU2NlbmVQYW5lbExpc3ROb2RlKG5vZGUsIHRoaXMubGV2ZWwgKyAxKSk7XG4gICAgICAgICAgICB0aGlzLmFwcGVuZCguLi50aGlzLmNoaWxkcmVuTm9kZXMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZXBsYWNlQ2hpbGRyZW4odGhpcy53cmFwcGVyKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgnc2NlbmUtcGFuZWwtbGlzdC1ub2RlJywgU2NlbmVQYW5lbExpc3ROb2RlKTtcbiIsImV4cG9ydCBmdW5jdGlvbiB0b1JhZGlhbnMoZGVncmVlcykge1xuICAgIHJldHVybiBkZWdyZWVzICogKE1hdGguUEkgLyAxODAuMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9EZWdyZWVzKHJhZGlhbnMpIHtcbiAgICByZXR1cm4gcmFkaWFucyAqICgxODAgLyBNYXRoLlBJKTtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==